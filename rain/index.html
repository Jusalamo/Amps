<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Amps | Amplify Your Connections at Live Events</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" id="manifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Amps">
    
    <style>
        /* ===== BASE STYLES ===== */
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #161616;
            --bg-card: rgba(30, 30, 30, 0.7);
            --bg-glass: rgba(255, 255, 255, 0.05);
            
            /* Profile Card Colors */
            --card-purple: #8B5CF6;
            --card-pink: #EC4899;
            --card-blue: #3B82F6;
            --card-green: #10B981;
            --card-yellow: #F59E0B;
            --card-orange: #F97316;
            --card-red: #EF4444;
            --card-teal: #14B8A6;
            --card-indigo: #6366F1;
            --card-lavender: #C4B5FD;
            --card-pastel-pink: #FFC0D9;
            --card-pastel-blue: #BAE6FD;
            --card-mint: #BBF7D0;
            --card-peach: #FECACA;
            
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --primary-glow: rgba(139, 92, 246, 0.3);
            
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --accent-yellow: #F59E0B;
            --accent-blue: #3B82F6;
            --accent-gold: #F5DEB3;
            
            --pro-gradient: linear-gradient(135deg, #8B5CF6, #EC4899, #F59E0B);
            --pro-plus-gradient: linear-gradient(135deg, #F59E0B, #8B5CF6, #EC4899);
            
            --white: #FFFFFF;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #8E8E93;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1C1C1E;
            --gray-900: #2C2C2E;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 30px rgba(139, 92, 246, 0.4);
            --shadow-card-stack: 0 20px 60px rgba(0, 0, 0, 0.4), 0 8px 24px rgba(0, 0, 0, 0.3);
            --shadow-gold: 0 8px 24px rgba(245, 222, 179, 0.3);
            
            /* Border Radius System */
            --radius-sm: 8px;
            --radius: 12px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-xl: 24px;
            --radius-2xl: 32px;
            --radius-full: 9999px;
            
            /* Notched Corners */
            --notch-tl: 32px 32px 8px 8px;
            --notch-tr: 8px 32px 32px 8px;
            --notch-bl: 8px 8px 32px 32px;
            --notch-br: 32px 8px 8px 32px;
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            --header-height: 64px;
            --bottom-nav-height: 65px;
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--white);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
        }
        
        .app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }
        
        /* ===== SCROLLBAR STYLING ===== */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 3px;
            transition: background 0.3s;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }
        
        /* Mobile: hide scrollbar by default, show only when scrolling */
        @media (max-width: 768px) {
            ::-webkit-scrollbar {
                display: none;
            }
            
            * {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* ===== DECORATIVE BACKGROUNDS ===== */
        .hero-bg {
            position: absolute;
            inset: 0;
            opacity: 0.08;
            pointer-events: none;
            z-index: 0;
            background: radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            animation: gradientShift 20s ease infinite alternate;
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 0%;
            }
            100% {
                background-position: 100% 100%;
            }
        }
        
        .for-you-bg {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-40px);
            font-size: clamp(80px, 15vw, 180px);
            font-weight: 700;
            color: #3A3A3C;
            opacity: 0.08;
            letter-spacing: 0.05em;
            white-space: nowrap;
            pointer-events: none;
            z-index: 0;
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
        }
        
        h1 {
            font-size: 2.5rem;
            color: var(--white);
        }
        
        h2 { font-size: 1.875rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }
        
        .text-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pro-gradient {
            background: var(--pro-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pro-plus-gradient {
            background: var(--pro-plus-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* ===== NOTIFICATION SYSTEM (Instagram-style) ===== */
        .notification-container {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 300px;
            width: calc(100% - 40px);
            pointer-events: none;
        }
        
        .notification {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(-20px);
            opacity: 0;
            animation: notificationSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            pointer-events: all;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .notification.slide-out {
            animation: notificationSlideOut 0.3s ease forwards;
        }
        
        .notification::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
        }
        
        .notification.success::before {
            background: var(--accent-green);
        }
        
        .notification.error::before {
            background: var(--accent-red);
        }
        
        .notification.warning::before {
            background: var(--accent-yellow);
        }
        
        .notification.info::before {
            background: var(--accent-blue);
        }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 13px;
            color: var(--gray-400);
            line-height: 1.4;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 14px;
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
        }
        
        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }
        
        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
            transform-origin: left;
            animation: notificationProgress 3s linear forwards;
        }
        
        .notification-swipe-area {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            cursor: grab;
        }
        
        .notification-swipe-area:active {
            cursor: grabbing;
        }
        
        @keyframes notificationSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes notificationSlideOut {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        @keyframes notificationProgress {
            from {
                transform: scaleX(1);
            }
            to {
                transform: scaleX(0);
            }
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: var(--radius-xl);
            font-weight: 600;
            font-size: 14px;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
            box-shadow: var(--shadow-glow);
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow), 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        .btn-pro {
            background: var(--pro-gradient);
            color: var(--white);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            box-shadow: 0 0 30px rgba(236, 72, 153, 0.3);
        }
        
        .btn-pro:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(236, 72, 153, 0.4);
        }
        
        .btn-pro-plus {
            background: var(--pro-plus-gradient);
            color: var(--white);
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-glass {
            background: var(--bg-glass);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }
        
        .btn-glass:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .btn-large {
            padding: 16px 32px;
            font-size: 16px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: var(--radius-full);
            font-size: 20px;
        }
        
        /* ===== NOTCHED ELEMENTS ===== */
        .notched-tl {
            border-radius: var(--notch-tl);
        }
        
        .notched-tr {
            border-radius: var(--notch-tr);
        }
        
        .notched-bl {
            border-radius: var(--notch-bl);
        }
        
        .notched-br {
            border-radius: var(--notch-br);
        }
        
        /* ===== NAVIGATION ===== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: var(--header-height);
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            backdrop-filter: blur(20px);
            max-width: 480px;
            margin: 0 auto;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 24px;
            font-weight: 800;
            cursor: pointer;
        }
        
        .nav-brand .amp {
            background: var(--pro-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-brand .s {
            color: var(--white);
        }
        
        .nav-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: var(--white);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-full);
            transition: background var(--transition-fast);
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: var(--safe-area-inset-bottom);
            z-index: 999;
            max-width: 480px;
            margin: 0 auto;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 12px;
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 12px;
            transition: all var(--transition-fast);
            flex: 1;
            height: 100%;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item i {
            font-size: 20px;
        }
        
        /* ===== CONTENT CONTAINER ===== */
        .content {
            padding: calc(var(--header-height) + 20px) 20px 20px;
            min-height: 100vh;
        }
        
        /* ===== CARD COMPONENTS ===== */
        .card {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-2xl);
            padding: 24px;
            backdrop-filter: blur(20px);
            transition: all var(--transition);
        }
        
        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-glass {
            background: var(--bg-glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-2xl);
            padding: 24px;
            backdrop-filter: blur(20px);
        }
        
        /* ===== BADGES ===== */
        .pro-badge {
            background: var(--pro-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .pro-plus-badge {
            background: var(--pro-plus-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .free-badge {
            background: var(--bg-tertiary);
            color: var(--gray-400);
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .live-badge {
            background: var(--accent-green);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            animation: pulse 2s infinite;
        }
        
        /* ===== LANDING PAGE ===== */
        .hero {
            text-align: center;
            padding: 40px 0;
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.1;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 40px;
            color: var(--gray-400);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 60px 0;
        }
        
        .feature {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-2xl);
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition);
        }
        
        .feature:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow);
        }
        
        .feature-icon {
            width: 56px;
            height: 56px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 24px;
            color: var(--primary-light);
        }
        
        .cta-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 40px 0;
        }
        
        /* ===== PROFILE CARDS ===== */
        .card-stack {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .card-container {
            width: 100%;
            max-width: 280px;
            aspect-ratio: 3/4;
            position: relative;
        }
        
        .profile-card {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s;
            cursor: grab;
            z-index: 1;
            border-radius: var(--radius-xl);
            overflow: hidden;
        }
        
        .profile-card:active {
            cursor: grabbing;
        }
        
        .card-content {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-card-stack);
        }
        
        .card-frame {
            position: absolute;
            width: 110%;
            height: 110%;
            top: -8%;
            left: -5%;
            background: var(--accent-gold);
            border-radius: var(--radius-xl);
            transform: rotate(-3deg);
            z-index: -1;
            box-shadow: var(--shadow-gold);
        }
        
        .profile-image {
            width: 85%;
            aspect-ratio: 1/1;
            margin: 24px auto 0;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .profile-info {
            padding: 20px 24px;
            text-align: center;
        }
        
        .profile-info h2 {
            font-size: 1.5rem;
            margin-bottom: 4px;
            color: var(--gray-800);
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .profile-info p {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .interests {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .interest-tag {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(28, 28, 30, 0.08);
            color: var(--gray-600);
            font-weight: 600;
        }
        
        /* ===== SWIPE OVERLAYS ===== */
        .swipe-overlay {
            position: absolute;
            top: 50px;
            right: -40px;
            width: 120px;
            height: 50px;
            border: 4px solid var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 24px;
            border-radius: 12px;
            z-index: 100;
            transform: rotate(12deg);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .swipe-overlay.like {
            background: var(--accent-green);
            left: -40px;
            right: auto;
            transform: rotate(-12deg);
        }
        
        .swipe-overlay.nope {
            background: var(--accent-red);
            transform: rotate(12deg);
        }
        
        .swipe-overlay.super {
            background: var(--accent-blue);
            top: 80px;
            transform: rotate(0deg);
        }
        
        /* ===== SWIPE ACTIONS ===== */
        .swipe-actions {
            padding: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            z-index: 50;
        }
        
        .action-button {
            width: 72px;
            height: 72px;
            border-radius: var(--radius-full);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
            background: var(--gray-900);
            color: var(--white);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .action-button:hover {
            transform: scale(1.05);
        }
        
        .action-button:active {
            transform: scale(0.95);
        }
        
        .action-button.undo {
            width: 64px;
            height: 64px;
            font-size: 20px;
            background: var(--gray-400);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }
        
        .action-button.like {
            width: 80px;
            height: 80px;
            background: var(--card-pink);
            color: var(--white);
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.5);
        }
        
        .action-button.like:hover {
            transform: scale(1.1);
        }
        
        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 16px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--gray-400);
        }
        
        /* ===== QUICK ACTIONS ===== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 32px 0;
        }
        
        .action-card {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .action-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow);
        }
        
        .action-card i {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .action-card.primary i { color: var(--primary); }
        .action-card.blue i { color: var(--card-blue); }
        .action-card.pink i { color: var(--card-pink); }
        .action-card.gold i { color: var(--accent-gold); }
        
        /* ===== EVENT CARDS ===== */
        .events-grid {
            display: grid;
            gap: 16px;
            margin-top: 24px;
        }
        
        .event-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--notch-tl);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .event-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        
        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 0 0 32px 0;
            opacity: 0.1;
        }
        
        .event-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-400);
            font-size: 14px;
            margin: 8px 0;
        }
        
        /* ===== EVENT MEDIA PREVIEW ===== */
        .event-media-preview {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
            margin-bottom: 16px;
            background: var(--bg-tertiary);
        }
        
        .event-media-preview video,
        .event-media-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .event-media-preview:hover video,
        .event-media-preview:hover img {
            transform: scale(1.05);
        }
        
        .media-play-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .event-media-preview:hover .media-play-overlay {
            opacity: 1;
        }
        
        .play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--bg-primary);
            border: none;
            cursor: pointer;
        }
        
        /* ===== AUTH PAGE ===== */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 40px 0;
        }
        
        .auth-tabs {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            padding: 4px;
            margin-bottom: 32px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: none;
            border: none;
            color: var(--gray-400);
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .auth-tab.active {
            background: var(--primary);
            color: var(--white);
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray-300);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            color: var(--white);
            font-size: 16px;
            transition: all var(--transition-fast);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-glow);
        }
        
        /* ===== ATTENDEE LIST ===== */
        .attendee-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .attendee-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .attendee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--primary);
        }
        
        .attendee-info {
            flex: 1;
        }
        
        .attendee-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .status-online {
            color: var(--accent-green);
        }
        
        .status-away {
            color: var(--accent-yellow);
        }
        
        /* ===== CHAT ===== */
        .chat-container {
            height: calc(100vh - var(--header-height) - var(--bottom-nav-height));
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-secondary);
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            background-size: cover;
            background-position: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: messageAppear 0.3s ease;
        }
        
        .message.sent {
            background: var(--primary);
            color: var(--white);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            border-radius: 18px 18px 4px 18px;
        }
        
        .message.received {
            background: var(--bg-tertiary);
            color: var(--white);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            border-radius: 18px 18px 18px 4px;
        }
        
        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
            text-align: right;
        }
        
        .chat-input {
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 12px;
            background: var(--bg-secondary);
        }
        
        /* ===== PRICING CARDS ===== */
        .pricing-grid {
            display: grid;
            gap: 20px;
            margin: 32px 0;
        }
        
        .pricing-card {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 32px 24px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: all var(--transition);
        }
        
        .pricing-card.featured {
            border: 2px solid var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }
        
        .pricing-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .pricing-card.featured:hover {
            transform: scale(1.05) translateY(-4px);
        }
        
        .pricing-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 20px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
        }
        
        /* ===== SCANNER ===== */
        .scanner-container {
            text-align: center;
            padding: 20px 0;
        }
        
        .qr-scanner {
            width: 100%;
            height: 300px;
            background: var(--bg-secondary);
            border-radius: var(--radius-2xl);
            margin: 24px 0;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .scanner-overlay {
            position: absolute;
            inset: 20px;
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            animation: pulse 2s infinite;
        }
        
        .scanner-line {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
            animation: scan 3s infinite linear;
        }
        
        /* ===== CAMERA MODAL ===== */
        .camera-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .camera-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #000;
        }
        
        .camera-preview {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid white;
            border-radius: var(--radius-lg);
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.7);
        }
        
        .camera-controls {
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }
        
        .camera-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            color: black;
        }
        
        /* ===== PRO/MATCH MODALS ===== */
        .pro-modal, .match-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .pro-content, .match-content {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: var(--radius-2xl);
            padding: 48px 32px;
            text-align: center;
            max-width: 320px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .match-images {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .match-avatar {
            width: 96px;
            height: 96px;
            border-radius: var(--radius-full);
            border: 4px solid var(--primary);
            box-shadow: var(--shadow-lg);
            background-size: cover;
            background-position: center;
        }
        
        /* ===== DEMO MODE BANNER ===== */
        .demo-banner {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            background: var(--pro-gradient);
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes scan {
            0% { top: 20px; }
            50% { top: calc(100% - 22px); }
            100% { top: 20px; }
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 16px; }
        .mt-4 { margin-top: 24px; }
        .mt-5 { margin-top: 32px; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 16px; }
        .mb-4 { margin-bottom: 24px; }
        .mb-5 { margin-bottom: 32px; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-5 { gap: 20px; }
        .w-full { width: 100%; }
        .cursor-pointer { cursor: pointer; }
        .relative { position: relative; }
        
        /* ===== AVATAR ===== */
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            margin: 0 auto 16px;
            position: relative;
            overflow: hidden;
            border: 3px solid var(--bg-primary);
            background-size: cover;
            background-position: center;
        }
        
        .avatar.pro {
            border: 3px solid transparent;
            border-image: var(--pro-gradient) 1;
        }
        
        .avatar.pro-plus {
            border: 3px solid transparent;
            border-image: var(--pro-plus-gradient) 1;
        }
        
        /* ===== EVENT BADGE ===== */
        .event-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ===== CREATE EVENT ===== */
        .create-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .qr-code-display {
            width: 200px;
            height: 200px;
            background: var(--white);
            border-radius: var(--radius);
            margin: 24px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--bg-primary);
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .content {
                padding: calc(var(--header-height) + 16px) 16px 16px;
            }
            
            .navbar {
                padding: 0 16px;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @supports (padding: max(0px)) {
            .bottom-nav {
                padding-bottom: max(var(--safe-area-inset-bottom), 20px);
            }
        }
        
        /* ===== NEW FEATURES STYLES ===== */
        /* Edit Profile */
        .edit-profile-container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .profile-photo-upload {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
        }
        
        .profile-photo-upload .avatar {
            width: 100%;
            height: 100%;
        }
        
        .upload-button {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }
        
        /* Privacy Settings */
        .privacy-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .privacy-option:last-child {
            border-bottom: none;
        }
        
        .privacy-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        /* Profile Views */
        .profile-views-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .profile-view-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .view-time {
            font-size: 12px;
            color: var(--gray-400);
        }
        
        /* Filters */
        .filters-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .filters-content {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 32px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .filter-section {
            margin-bottom: 24px;
        }
        
        .filter-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .filter-option:last-child {
            border-bottom: none;
        }
        
        .range-slider {
            width: 100%;
            margin: 20px 0;
        }
        
        .range-value {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        /* Event Bookmarks */
        .bookmark-button {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all var(--transition);
        }
        
        .bookmark-button.active {
            color: var(--accent-yellow);
        }
        
        /* Event Geo-fencing */
        .geo-fencing-badge {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-blue);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* Safety Options */
        .safety-options {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }
        
        .safety-btn {
            flex: 1;
            padding: 8px 16px;
            border-radius: var(--radius);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-size: 12px;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .safety-btn:hover {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        
        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .analytics-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 16px;
            text-align: center;
        }
        
        .analytics-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .analytics-label {
            font-size: 12px;
            color: var(--gray-400);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            padding: 16px 0;
        }
        
        .page-button {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .page-button.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .page-button:hover:not(.active) {
            border-color: var(--primary);
        }
        
        /* Event Customization */
        .customization-preview {
            width: 100%;
            height: 150px;
            border-radius: var(--radius-lg);
            margin: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }
        
        .color-picker {
            display: flex;
            gap: 8px;
            margin: 16px 0;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition);
        }
        
        .color-option.active {
            border-color: white;
            transform: scale(1.1);
        }
        
        /* Event RSVP */
        .rsvp-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .rsvp-button {
            padding: 12px;
            border-radius: var(--radius-lg);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            cursor: pointer;
            transition: all var(--transition);
            text-align: center;
        }
        
        .rsvp-button.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        /* Enhanced Chat Features */
        .chat-options {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }
        
        .chat-option-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .chat-option-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        /* Pro Analytics */
        .analytics-chart {
            width: 100%;
            height: 200px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            margin: 20px 0;
            display: flex;
            align-items: flex-end;
            padding: 20px;
            gap: 4px;
        }
        
        .chart-bar {
            flex: 1;
            background: var(--primary);
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            transition: height 0.3s ease;
        }
        
        /* Notification Preferences */
        .notification-preference {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .notification-preference:last-child {
            border-bottom: none;
        }
        
        /* Location-based Events */
        .location-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-full);
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Enhanced Event Card */
        .event-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .event-actions {
            display: flex;
            gap: 8px;
        }
        
        .event-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .event-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        /* Scrollable Content Areas */
        .scrollable-content {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .scrollable-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        
        .scrollable-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        /* Spacing Optimizations */
        .compact-grid {
            display: grid;
            gap: 12px;
        }
        
        .compact-card {
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .section-spacing {
            margin-top: 32px;
            margin-bottom: 32px;
        }
        
        .no-clip {
            overflow: visible;
        }
        
        /* ===== MOBILE OPTIMIZED COMMENT SECTION ===== */
        .comment-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-radius: 24px 24px 0 0;
            z-index: 2000;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .comment-sheet-handle {
            padding: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .comment-sheet-handle:active {
            cursor: grabbing;
        }
        
        .handle-bar {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        .comment-sheet-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .comment-sheet-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .comment-item {
            display: flex;
            gap: 12px;
        }
        
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .comment-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .comment-actions {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--gray-400);
        }
        
        .comment-action {
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .comment-input-area {
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .comment-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            padding: 10px 16px;
            color: var(--white);
            font-size: 14px;
            resize: none;
            max-height: 100px;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .post-comment-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* ===== COMMUNITY PHOTO DUMP ===== */
        .photo-dump-section {
            margin-top: 24px;
        }
        
        .photo-dump-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            margin-top: 12px;
        }
        
        .photo-item {
            aspect-ratio: 1/1;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .add-photo-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            color: var(--gray-400);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .add-photo-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .add-photo-btn.locked {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .add-photo-btn.locked:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--gray-400);
        }
        
        .photo-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .photo-item:hover .photo-overlay {
            opacity: 1;
        }
        
        .photo-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ===== EVENT CAROUSEL ===== */
        .event-carousel {
            position: relative;
            overflow: hidden;
        }
        
        .event-carousel-track {
            display: flex;
            gap: 16px;
            transition: transform 0.3s ease;
        }
        
        .event-carousel-item {
            min-width: calc(100% - 32px);
        }
        
        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
        }
        
        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-400);
            border: none;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .carousel-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }
        
        /* ===== TICKET MODAL ===== */
        .ticket-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .ticket-content {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: var(--radius-2xl);
            padding: 32px;
            max-width: 400px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .ticket-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 24px 0;
        }
        
        .ticket-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .ticket-option:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .ticket-option.selected {
            border-color: var(--primary);
            background: rgba(139, 92, 246, 0.1);
        }
        
        /* ===== UPGRADE BADGE ===== */
        .upgrade-badge {
            background: var(--pro-gradient);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            animation: pulse 2s infinite;
        }
        
        /* ===== DEMO EXIT BUTTON ===== */
        .demo-exit-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 6px;
            animation: slideIn 0.3s ease;
        }
        
        /* ===== MENU DROPDOWN ===== */
        .menu-dropdown {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 12px;
            min-width: 200px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: dropdownSlide 0.2s ease;
        }
        
        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: none;
            border: none;
            color: var(--white);
            width: 100%;
            text-align: left;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* ===== SWIPE LIMIT COUNTER ===== */
        .swipe-limit-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 12px;
            color: var(--gray-400);
            margin-bottom: 8px;
        }
        
        .swipe-limit-progress {
            width: 100px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .swipe-limit-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        /* ===== FEATURED EVENT INDICATOR ===== */
        .featured-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--pro-gradient);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 1;
        }
        
        /* ===== EVENT CARD THEME ===== */
        .event-card.themed {
            position: relative;
            overflow: hidden;
        }
        
        .event-card.themed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary);
        }
        
        /* ===== EVENT SEARCH ===== */
        .event-search {
            margin-bottom: 20px;
        }
        
        .search-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .search-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: 12px 16px;
            color: var(--white);
            font-size: 14px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .search-tag {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            padding: 6px 12px;
            font-size: 12px;
            color: var(--gray-300);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .search-tag.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .search-tag:hover {
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- Navigation will be injected here -->
        <div class="content" id="content">
            <!-- Content will be dynamically loaded here -->
        </div>
        
        <!-- Bottom Navigation will be injected here -->
        <div id="bottomNav"></div>
        
        <!-- Notification Container -->
        <div class="notification-container" id="notificationContainer"></div>
        
        <!-- Demo Banner (shown when in demo mode) -->
        <div class="demo-banner hidden" id="demoBanner">
            <i class="fas fa-flask"></i>
            <span>Demo Mode Active - Using Mock Data</span>
            <button class="btn btn-glass btn-small" onclick="exitDemo()" style="margin-left: auto;">
                Exit Demo
            </button>
        </div>
        
        <!-- Demo Exit Button -->
        <button class="demo-exit-btn hidden" id="demoExitBtn" onclick="exitDemo()">
            <i class="fas fa-times"></i> Exit Demo
        </button>
    </div>

    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <div class="camera-container">
            <div class="camera-preview">
                <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                <div class="camera-overlay"></div>
                <div class="live-badge" style="position: absolute; top: 16px; right: 16px;">
                    <i class="fas fa-camera"></i>
                    <span>LIVE PHOTO</span>
                </div>
            </div>
            <div class="camera-controls">
                <button class="btn btn-outline" onclick="closeCamera()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="camera-btn" onclick="takePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
                <button class="btn btn-outline" onclick="switchCamera()">
                    <i class="fas fa-sync-alt"></i> Flip
                </button>
            </div>
        </div>
    </div>

    <!-- Pro Upgrade Modal -->
    <div class="pro-modal" id="proModal">
        <div class="pro-content">
            <div class="text-center mb-6">
                <div class="pro-badge mb-4" style="font-size: 14px; padding: 8px 16px;">
                    <i class="fas fa-crown"></i>
                    <span>UPGRADE TO PRO</span>
                </div>
                <h2 class="pro-gradient">Unlock Premium Features</h2>
                <p class="mt-2">Get unlimited swipes, create events, and more!</p>
            </div>

            <div class="flex flex-col gap-4 mb-6">
                <div class="card-glass">
                    <h4 class="mb-2">Unlimited Daily Swipes</h4>
                    <p class="text-gray-400">Free users limited to 30 swipes/day per event</p>
                </div>
                
                <div class="card-glass">
                    <h4 class="mb-2">Create Unlimited Events</h4>
                    <p class="text-gray-400">Free users can create 3 events/month</p>
                </div>
                
                <div class="card-glass">
                    <h4 class="mb-2">See Who Liked You</h4>
                    <p class="text-gray-400">Free users can't see who liked them</p>
                </div>
                
                <div class="card-glass">
                    <h4 class="mb-2">Video Calls & Read Receipts</h4>
                    <p class="text-gray-400">Pro-exclusive features</p>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="mb-4 text-center">Choose Plan</h4>
                <div class="flex flex-col gap-3">
                    <div class="pricing-card">
                        <div class="pro-badge mb-4">PRO</div>
                        <h3 class="text-center mb-2">$14.99/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $99.99/year (save 44%)</p>
                        <div class="flex flex-col gap-2 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Unlimited likes</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>5 super likes/day</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>See who liked you</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Video calls</span>
                            </div>
                        </div>
                        <button class="btn btn-pro btn-block" onclick="upgradeToPro()">
                            <i class="fas fa-crown"></i> Upgrade Now
                        </button>
                    </div>
                    
                    <div class="pricing-card featured">
                        <div class="pro-plus-badge mb-4">PRO PLUS</div>
                        <h3 class="text-center mb-2 pro-plus-gradient">$49.99/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $399.99/year (save 33%)</p>
                        <div class="flex flex-col gap-2 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>All Pro features</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Custom event branding</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Advanced analytics</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>24/7 priority support</span>
                            </div>
                        </div>
                        <button class="btn btn-pro-plus btn-block" onclick="upgradeToProPlus()">
                            <i class="fas fa-star"></i> Upgrade to Pro Plus
                        </button>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-glass btn-block mt-4" onclick="closeProModal()">
                Maybe Later
            </button>
        </div>
    </div>

    <!-- Match Modal -->
    <div class="match-modal" id="matchModal">
        <div class="match-content">
            <div class="match-images">
                <div class="match-avatar" id="userAvatar"></div>
                <div class="flex items-center">
                    <i class="fas fa-bolt" style="font-size: 32px; color: var(--primary);"></i>
                </div>
                <div class="match-avatar" id="matchAvatar"></div>
            </div>
            <h2>It's a Match!</h2>
            <p class="mt-2" id="matchMessage"></p>
            <div class="flex flex-col gap-3 mt-4">
                <button class="btn btn-primary" onclick="startChat()">
                    <i class="fas fa-comment"></i> Send Message
                </button>
                <button class="btn btn-outline" onclick="closeMatchModal()">
                    Keep Swiping
                </button>
            </div>
        </div>
    </div>

    <!-- Filters Modal -->
    <div class="filters-modal" id="filtersModal">
        <div class="filters-content">
            <h2 class="mb-6">Filters</h2>
            
            <div class="filter-section">
                <h4 class="mb-4">Distance</h4>
                <div class="range-value">
                    <span>0 km</span>
                    <span id="distanceValue">50 km</span>
                    <span>100 km</span>
                </div>
                <input type="range" class="range-slider" id="distanceSlider" min="0" max="100" value="50">
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Age Range</h4>
                <div class="range-value">
                    <span>18</span>
                    <span id="ageValue">18-35</span>
                    <span>60</span>
                </div>
                <input type="range" class="range-slider" id="ageSlider" min="18" max="60" value="35">
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Gender</h4>
                <div class="flex gap-3">
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'all')" id="genderAll">All</button>
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'male')" id="genderMale">Men</button>
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'female')" id="genderFemale">Women</button>
                </div>
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Interests</h4>
                <div class="flex flex-wrap gap-2">
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('music')">Music</span>
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('tech')">Tech</span>
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('art')">Art</span>
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('sports')">Sports</span>
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('food')">Food</span>
                    <span class="interest-tag cursor-pointer" onclick="toggleInterest('travel')">Travel</span>
                </div>
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Verification</h4>
                <div class="filter-option">
                    <span>Verified Only</span>
                    <label class="switch">
                        <input type="checkbox" id="verifiedOnly">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="flex gap-3 mt-8">
                <button class="btn btn-outline flex-1" onclick="closeFilters()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="applyFilters()">
                    Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Ticket Purchase Modal -->
    <div class="ticket-modal" id="ticketModal">
        <div class="ticket-content">
            <h2 class="text-center mb-4">Ticket Options</h2>
            <p class="text-center text-gray-400 mb-6">Choose how you'd like to get your ticket</p>
            
            <div class="ticket-options">
                <div class="ticket-option" onclick="selectTicketOption('now')">
                    <div>
                        <h4>Buy Now</h4>
                        <p class="text-gray-400 text-sm">Purchase ticket online</p>
                    </div>
                    <i class="fas fa-credit-card text-primary"></i>
                </div>
                
                <div class="ticket-option" onclick="selectTicketOption('later')">
                    <div>
                        <h4>Pay Later</h4>
                        <p class="text-gray-400 text-sm">Reserve and pay at event</p>
                    </div>
                    <i class="fas fa-clock text-primary"></i>
                </div>
                
                <div class="ticket-option" onclick="selectTicketOption('gate')">
                    <div>
                        <h4>Pay at Gate</h4>
                        <p class="text-gray-400 text-sm">Pay when you arrive</p>
                    </div>
                    <i class="fas fa-ticket text-primary"></i>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button class="btn btn-outline flex-1" onclick="closeTicketModal()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="confirmTicketPurchase()">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Comment Sheet -->
    <div class="comment-sheet hidden" id="commentSheet">
        <div class="comment-sheet-handle">
            <div class="handle-bar"></div>
        </div>
        <div class="comment-sheet-header">
            <h3>Comments</h3>
            <button class="btn btn-outline btn-small" onclick="closeCommentSheet()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="comment-sheet-content" id="commentSheetContent">
            <!-- Comments will be loaded here -->
        </div>
        <div class="comment-input-area">
            <textarea class="comment-input" placeholder="Add a comment..." id="commentInput"></textarea>
            <button class="post-comment-btn" onclick="postComment()">Post</button>
        </div>
    </div>

    <!-- Community Photo Dump Modal -->
    <div class="pro-modal" id="photoDumpModal">
        <div class="pro-content">
            <h2 class="text-center mb-4">Community Photo Dump</h2>
            <p class="text-center text-gray-400 mb-6">Share photos from the event</p>
            
            <div class="photo-dump-grid" id="photoDumpGrid">
                <!-- Photos will be loaded here -->
            </div>
            
            <div class="mt-6">
                <button class="btn btn-primary btn-block" onclick="openPhotoUpload()" id="uploadPhotoBtn">
                    <i class="fas fa-plus"></i> Add Photo
                </button>
                <button class="btn btn-outline btn-block mt-3" onclick="closePhotoDumpModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== ENHANCED MOCK DATA =====
        const MOCK_PROFILES = [
            {
                id: 1,
                name: 'Katrin',
                age: 23,
                bio: 'Live, Trained As A Dance, Teacher, Gymnast And Acrobat',
                interests: ['Dance', 'Fitness', 'Art', 'Music'],
                eventId: 1,
                location: 'Main Stage',
                online: true,
                verified: true,
                cardColor: 'var(--card-purple)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23C4B5FD"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '15m away',
                gender: 'female'
            },
            {
                id: 2,
                name: 'Alex',
                age: 25,
                bio: 'Product Designer Who Loves Coffee And Indie Music',
                interests: ['Design', 'Music', 'Coffee', 'Art'],
                eventId: 1,
                location: 'Bar Area',
                online: true,
                verified: true,
                cardColor: 'var(--card-pink)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23FFC0D9"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '25m away',
                gender: 'male'
            },
            {
                id: 3,
                name: 'Jordan',
                age: 27,
                bio: 'Startup Founder, Always Down For Deep Conversations',
                interests: ['Tech', 'Philosophy', 'Hiking', 'Sustainability'],
                eventId: 1,
                location: 'Lounge',
                online: false,
                verified: true,
                cardColor: 'var(--card-blue)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23BAE6FD"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '50m away',
                gender: 'male'
            },
            {
                id: 4,
                name: 'Sam',
                age: 26,
                bio: 'Marketing Manager Who Travels Frequently. Foodie Always Looking For The Next Great Restaurant',
                interests: ['Travel', 'Food', 'Photography', 'Wine'],
                eventId: 1,
                location: 'Food Court',
                online: true,
                verified: false,
                cardColor: 'var(--card-green)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23BBF7D0"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '100m away',
                gender: 'female'
            },
            {
                id: 5,
                name: 'Taylor',
                age: 24,
                bio: 'Software Engineer By Day, DJ By Night. Loves Electronic Music',
                interests: ['Music', 'Tech', 'Dancing', 'Festivals'],
                eventId: 1,
                location: 'DJ Booth',
                online: true,
                verified: true,
                cardColor: 'var(--card-teal)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23FECACA"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '200m away',
                gender: 'non-binary'
            },
            {
                id: 6,
                name: 'Alexandra',
                age: 24,
                bio: 'Music producer & DJ. Playing at the main stage tonight. Always looking for creative connections.',
                interests: ['Music Production', 'DJing', 'Sound Design', 'Live Performance', 'Electronic Music'],
                eventId: 1,
                location: 'Main Stage',
                online: true,
                verified: true,
                cardColor: 'var(--card-indigo)',
                livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23C4B5FD"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
                distance: '15m away',
                gender: 'female'
            }
        ];

        const MOCK_EVENTS = [
            {
                id: 1,
                name: 'Tech Mixer 2024',
                location: 'The Mill, San Francisco',
                date: 'Tonight',
                time: '7:00 PM - 11:00 PM',
                attendees: 156,
                maxAttendees: 200,
                description: 'The biggest tech networking event of the year. Connect with founders, engineers, designers, and investors in the heart of Silicon Valley.',
                category: 'Tech Networking',
                coverImage: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=300&fit=crop',
                qrCode: 'AMPS_TECH_2024_001',
                radius: 100,
                organizerId: 1,
                coordinates: { lat: 37.7749, lng: -122.4194 },
                ageRange: '18-45',
                genderPreference: 'Everyone',
                tags: ['Tech', 'Networking', 'Startups', 'AI', 'Blockchain'],
                bookmarked: false,
                rsvp: 'none',
                geoFencing: true,
                customTheme: null,
                type: 'featured', // 'featured' or 'active' or 'past'
                mediaType: 'video',
                mediaUrl: 'https://example.com/video.mp4',
                promoted: true,
                maxUserOwned: true,
                organizerType: 'max'
            },
            {
                id: 2,
                name: 'Art Gallery Opening',
                location: 'Modern Art Space, SoMa',
                date: 'Tomorrow',
                time: '6:00 PM - 10:00 PM',
                attendees: 89,
                maxAttendees: 150,
                description: 'Contemporary art exhibition featuring emerging local artists. Wine tasting and artist talks included.',
                category: 'Art & Culture',
                coverImage: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=600&h=300&fit=crop',
                qrCode: 'AMPS_ART_2024_002',
                radius: 80,
                organizerId: 2,
                coordinates: { lat: 37.7833, lng: -122.4167 },
                ageRange: '21+',
                genderPreference: 'Everyone',
                tags: ['Art', 'Culture', 'Exhibition', 'Wine Tasting'],
                bookmarked: true,
                rsvp: 'going',
                geoFencing: true,
                customTheme: '#EC4899',
                type: 'active',
                mediaType: 'image',
                mediaUrl: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=600&h=300&fit=crop',
                promoted: false,
                maxUserOwned: true,
                organizerType: 'max'
            },
            {
                id: 3,
                name: 'Music Producers Meetup',
                location: 'SoundBar Lounge',
                date: 'Friday',
                time: '9:00 PM - 2:00 AM',
                attendees: 45,
                maxAttendees: 80,
                description: 'Exclusive meetup for music producers, DJs, and sound engineers. Equipment showcase and demo sharing.',
                category: 'Music & Audio',
                coverImage: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=600&h=300&fit=crop',
                qrCode: 'AMPS_MUSIC_2024_003',
                radius: 50,
                organizerId: 3,
                coordinates: { lat: 37.7815, lng: -122.4152 },
                ageRange: '21-40',
                genderPreference: 'Everyone',
                tags: ['Music', 'Producers', 'DJs', 'Audio Engineering'],
                bookmarked: false,
                rsvp: 'maybe',
                geoFencing: false,
                customTheme: null,
                type: 'active',
                mediaType: 'video',
                mediaUrl: 'https://example.com/video2.mp4',
                promoted: false,
                maxUserOwned: false,
                organizerType: 'pro'
            },
            {
                id: 4,
                name: 'Startup Pitch Night',
                location: 'Tech Hub Arena',
                date: 'Saturday',
                time: '6:30 PM - 9:30 PM',
                attendees: 120,
                maxAttendees: 150,
                description: 'Watch emerging startups pitch to investors. Networking with founders and VCs.',
                category: 'Startups',
                coverImage: 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=600&h=300&fit=crop',
                qrCode: 'AMPS_STARTUP_2024_004',
                radius: 75,
                organizerId: 4,
                coordinates: { lat: 37.7749, lng: -122.4194 },
                ageRange: '18+',
                genderPreference: 'Everyone',
                tags: ['Startups', 'Investing', 'Pitching', 'Networking'],
                bookmarked: false,
                rsvp: 'none',
                geoFencing: true,
                customTheme: null,
                type: 'featured',
                mediaType: 'image',
                mediaUrl: 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=600&h=300&fit=crop',
                promoted: true,
                maxUserOwned: false,
                organizerType: 'free'
            },
            {
                id: 5,
                name: 'Wellness Retreat',
                location: 'Zen Garden Center',
                date: 'Sunday',
                time: '9:00 AM - 12:00 PM',
                attendees: 65,
                maxAttendees: 100,
                description: 'Morning yoga, meditation, and wellness workshops. Connect with like-minded health enthusiasts.',
                category: 'Health & Wellness',
                coverImage: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=600&h=300&fit=crop',
                qrCode: 'AMPS_WELLNESS_2024_005',
                radius: 60,
                organizerId: 5,
                coordinates: { lat: 37.7815, lng: -122.4152 },
                ageRange: '18+',
                genderPreference: 'Everyone',
                tags: ['Yoga', 'Meditation', 'Wellness', 'Health'],
                bookmarked: true,
                rsvp: 'going',
                geoFencing: false,
                customTheme: null,
                type: 'past',
                mediaType: 'image',
                mediaUrl: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=600&h=300&fit=crop',
                promoted: false,
                maxUserOwned: false,
                organizerType: 'free'
            }
        ];

        const MOCK_CHAT_MESSAGES = {
            '2': [
                {
                    id: 1,
                    sender: 'user',
                    text: 'Hey Marcus! Saw you\'re into AI startups. I\'m working on something similar.',
                    time: '8:30 PM',
                    read: true
                },
                {
                    id: 2,
                    sender: 'match',
                    text: 'Awesome! What are you building? I\'d love to hear more.',
                    time: '8:32 PM',
                    read: true
                }
            ],
            '1': [
                {
                    id: 1,
                    sender: 'match',
                    text: 'Hey! Loved your profile. Are you enjoying the event?',
                    time: '7:45 PM',
                    read: true
                },
                {
                    id: 2,
                    sender: 'user',
                    text: 'Yes, it\'s amazing! The speakers are incredible.',
                    time: '7:46 PM',
                    read: true
                }
            ]
        };

        // Community Photos Data
        const MOCK_COMMUNITY_PHOTOS = [
            { id: 1, url: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=400&h=400&fit=crop', uploadedBy: 2, eventId: 1, timestamp: '2 hours ago', likes: 24 },
            { id: 2, url: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=400&fit=crop', uploadedBy: 3, eventId: 1, timestamp: '3 hours ago', likes: 18 },
            { id: 3, url: 'https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=400&h=400&fit=crop', uploadedBy: 4, eventId: 1, timestamp: '4 hours ago', likes: 32 },
            { id: 4, url: 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop', uploadedBy: 5, eventId: 1, timestamp: '5 hours ago', likes: 45 },
            { id: 5, url: 'https://images.unsplash.com/photo-1501281668745-f6f261821e4a?w=400&h=400&fit=crop', uploadedBy: 2, eventId: 1, timestamp: '6 hours ago', likes: 29 },
        ];

        // Comments Data
        const MOCK_COMMENTS = [
            { id: 1, userId: 2, userName: 'Alex', userAvatar: MOCK_PROFILES[1].livePhoto, text: 'Amazing event! The energy was incredible!', timestamp: '2 hours ago', likes: 12, replies: [] },
            { id: 2, userId: 3, userName: 'Jordan', userAvatar: MOCK_PROFILES[2].livePhoto, text: 'Best networking event I\'ve been to this year!', timestamp: '3 hours ago', likes: 8, replies: [
                { id: 21, userId: 4, userName: 'Sam', userAvatar: MOCK_PROFILES[3].livePhoto, text: 'Agreed! The speakers were fantastic!', timestamp: '2 hours ago', likes: 3 }
            ] },
            { id: 3, userId: 5, userName: 'Taylor', userAvatar: MOCK_PROFILES[4].livePhoto, text: 'Can\'t wait for the next one!', timestamp: '4 hours ago', likes: 15, replies: [] }
        ];

        // ===== ENHANCED APP STATE =====
        let state = {
            currentUser: null,
            currentPage: 'home',
            currentEvent: null,
            swipeCount: 0,
            dailyLikes: 25, // Free users: 25 swipes per event per day
            monthlySwipes: 0, // Track monthly usage
            lastSwipeReset: new Date().toDateString(),
            isPro: false,
            isProPlus: false,
            matches: [],
            events: MOCK_EVENTS,
            attendees: MOCK_PROFILES,
            cameraStream: null,
            facingMode: 'user',
            history: ['home'],
            currentProfileIndex: 0,
            swipeHistory: [],
            lastMatch: null,
            notification: null,
            chatMessages: MOCK_CHAT_MESSAGES,
            userLivePhoto: null,
            userProfile: {
                name: 'Demo User',
                email: 'demo@amps.com',
                age: 28,
                occupation: 'Software Engineer',
                company: 'Tech Corp',
                bio: 'Passionate about technology and building meaningful connections at events.',
                interests: ['Technology', 'Music', 'Travel', 'Fitness', 'Photography'],
                profilePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%238B5CF6"/><text x="100" y="120" font-size="24" text-anchor="middle" fill="white">User</text></svg>',
                phone: '+264 81 123 4567',
                location: 'San Francisco, CA',
                gender: 'male',
                visibility: 'public',
                profileViews: [],
                profilePhotos: [],
                maxPhotos: 3
            },
            superLikes: 1,
            rewindCount: 1,
            filters: {
                distance: 50,
                ageRange: { min: 18, max: 35 },
                gender: 'all',
                interests: [],
                verifiedOnly: false
            },
            bookmarkedEvents: [2, 5],
            currentPageNumber: 1,
            eventsPerPage: 5,
            activeFilters: {},
            privacySettings: {
                showProfile: 'public',
                showOnlineStatus: true,
                showDistance: true,
                notifications: {
                    matches: true,
                    messages: true,
                    eventUpdates: true,
                    nearbyEvents: true
                }
            },
            analytics: {
                eventViews: 1245,
                profileViews: 567,
                matchRate: '24%',
                responseRate: '89%',
                monthlyGrowth: '+12%'
            },
            demoMode: false,
            currentEventComments: MOCK_COMMENTS,
            communityPhotos: MOCK_COMMUNITY_PHOTOS,
            selectedTicketOption: null,
            carouselPosition: 0,
            notificationStack: [],
            menuOpen: false
        };

        // ===== NOTIFICATION SYSTEM =====
        class NotificationSystem {
            constructor() {
                this.container = document.getElementById('notificationContainer');
                this.stack = [];
            }
            
            show(message, type = 'info', duration = 3000) {
                const id = Date.now();
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = `notification-${id}`;
                
                const icon = this.getIcon(type);
                
                notification.innerHTML = `
                    <div class="notification-swipe-area" id="swipe-${id}"></div>
                    <i class="fas ${icon}"></i>
                    <div class="notification-content">
                        <div class="notification-title">${this.getTitle(type)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="notificationSystem.dismiss(${id})">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="notification-progress"></div>
                `;
                
                this.container.appendChild(notification);
                this.stack.push(id);
                
                // Initialize swipe gesture
                this.initSwipeGesture(id);
                
                // Auto dismiss after duration
                const autoDismiss = setTimeout(() => this.dismiss(id), duration);
                
                // Store dismiss timer
                notification._dismissTimer = autoDismiss;
                
                return id;
            }
            
            getIcon(type) {
                switch(type) {
                    case 'success': return 'fa-check-circle';
                    case 'error': return 'fa-exclamation-circle';
                    case 'warning': return 'fa-exclamation-triangle';
                    default: return 'fa-info-circle';
                }
            }
            
            getTitle(type) {
                switch(type) {
                    case 'success': return 'Success';
                    case 'error': return 'Error';
                    case 'warning': return 'Warning';
                    default: return 'Info';
                }
            }
            
            initSwipeGesture(id) {
                const swipeArea = document.getElementById(`swipe-${id}`);
                const notification = document.getElementById(`notification-${id}`);
                
                if (!swipeArea || !notification) return;
                
                let startX, currentX;
                let isSwiping = false;
                
                const onTouchStart = (e) => {
                    startX = e.touches ? e.touches[0].clientX : e.clientX;
                    isSwiping = true;
                    notification.style.transition = 'none';
                    
                    // Clear auto-dismiss timer
                    if (notification._dismissTimer) {
                        clearTimeout(notification._dismissTimer);
                    }
                };
                
                const onTouchMove = (e) => {
                    if (!isSwiping) return;
                    
                    currentX = e.touches ? e.touches[0].clientX : e.clientX;
                    const diff = currentX - startX;
                    
                    // Only allow right swipe to dismiss
                    if (diff > 0) {
                        notification.style.transform = `translateX(${diff}px)`;
                        notification.style.opacity = Math.max(0.5, 1 - (diff / 200));
                    }
                };
                
                const onTouchEnd = () => {
                    if (!isSwiping) return;
                    
                    isSwiping = false;
                    const diff = currentX - startX;
                    
                    if (diff > 100) { // Swipe threshold
                        this.dismiss(id);
                    } else {
                        notification.style.transition = 'transform 0.3s, opacity 0.3s';
                        notification.style.transform = '';
                        notification.style.opacity = '';
                        
                        // Restart auto-dismiss
                        notification._dismissTimer = setTimeout(() => this.dismiss(id), 2000);
                    }
                };
                
                // Touch events
                swipeArea.addEventListener('touchstart', onTouchStart, { passive: true });
                swipeArea.addEventListener('touchmove', onTouchMove, { passive: false });
                swipeArea.addEventListener('touchend', onTouchEnd);
                
                // Mouse events for desktop
                swipeArea.addEventListener('mousedown', onTouchStart);
                document.addEventListener('mousemove', onTouchMove);
                document.addEventListener('mouseup', onTouchEnd);
            }
            
            dismiss(id) {
                const notification = document.getElementById(`notification-${id}`);
                if (!notification) return;
                
                notification.classList.add('slide-out');
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    
                    // Remove from stack
                    const index = this.stack.indexOf(id);
                    if (index > -1) {
                        this.stack.splice(index, 1);
                    }
                }, 300);
            }
            
            dismissAll() {
                this.stack.forEach(id => this.dismiss(id));
                this.stack = [];
            }
        }

        // Initialize notification system
        const notificationSystem = new NotificationSystem();

        // ===== ROUTER =====
        function navigateTo(page) {
            console.log('Navigating to:', page);
            state.history.push(state.currentPage);
            state.currentPage = page;
            renderPage();
            updateNavigation();
            window.scrollTo(0, 0);
            
            // Close menu if open
            state.menuOpen = false;
            updateMenu();
        }

        function goBack() {
            console.log('Going back');
            if (state.history.length > 1) {
                const previousPage = state.history.pop();
                state.currentPage = state.history.pop() || 'home';
                renderPage();
                updateNavigation();
                window.scrollTo(0, 0);
            }
        }

        // ===== PAGE RENDERERS =====
        function renderPage() {
            console.log('Rendering page:', state.currentPage);
            const content = document.getElementById('content');
            
            // Clear content first
            content.innerHTML = '';
            
            switch(state.currentPage) {
                case 'home':
                    renderHomePage(content);
                    break;
                case 'auth':
                    renderAuthPage(content);
                    break;
                case 'dashboard':
                    renderDashboardPage(content);
                    break;
                case 'scanner':
                    renderScannerPage(content);
                    break;
                case 'swipe':
                    renderSwipePage(content);
                    break;
                case 'chat':
                    renderChatPage(content);
                    break;
                case 'events':
                    renderEventsPage(content);
                    break;
                case 'matches':
                    renderMatchesPage(content);
                    break;
                case 'profile':
                    renderProfilePage(content);
                    break;
                case 'create-event':
                    renderCreateEventPage(content);
                    break;
                case 'manage-event':
                    renderManageEventPage(content);
                    break;
                case 'event-detail':
                    renderEventDetailPage(content);
                    break;
                case 'pricing':
                    renderPricingPage(content);
                    break;
                case 'edit-profile':
                    renderEditProfilePage(content);
                    break;
                case 'settings':
                    renderSettingsPage(content);
                    break;
                case 'privacy-settings':
                    renderPrivacySettingsPage(content);
                    break;
                case 'profile-views':
                    renderProfileViewsPage(content);
                    break;
                case 'bookmarked-events':
                    renderBookmarkedEventsPage(content);
                    break;
                case 'analytics':
                    renderAnalyticsPage(content);
                    break;
                case 'notifications':
                    renderNotificationsPage(content);
                    break;
                default:
                    renderHomePage(content);
            }
            
            // Add CSS for switches if needed
            addSwitchStyles();
        }

        function updateNavigation() {
            console.log('Updating navigation');
            let navbar = document.querySelector('.navbar');
            
            if (!navbar) {
                navbar = document.createElement('nav');
                navbar.className = 'navbar';
                document.getElementById('app').insertBefore(navbar, document.getElementById('content'));
            }
            
            let navHTML = `
                <div class="nav-brand" onclick="navigateTo('home')">
                    <i class="fas fa-bolt"></i>
                    <span class="amp">Amps</span>
                </div>
                <div class="nav-actions">
            `;
            
            if (state.currentPage === 'home') {
                if (state.currentUser) {
                    navHTML += `
                        <button class="btn btn-outline btn-small" onclick="toggleMenu()">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    `;
                } else {
                    navHTML += `
                        <button class="btn btn-outline btn-small" onclick="navigateTo('auth')">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    `;
                }
            } else {
                navHTML += `
                    <button class="back-btn" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                `;
            }
            
            navHTML += `</div>`;
            
            navbar.innerHTML = navHTML;
            
            // Update bottom nav
            const bottomNav = document.getElementById('bottomNav');
            if (state.currentUser && ['dashboard', 'events', 'swipe', 'matches', 'profile'].includes(state.currentPage)) {
                const unreadCount = state.matches.filter(m => m.unread).length;
                bottomNav.innerHTML = `
                    <div class="bottom-nav">
                        <button class="nav-item ${state.currentPage === 'dashboard' ? 'active' : ''}" onclick="navigateTo('dashboard')">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </button>
                        <button class="nav-item ${state.currentPage === 'events' ? 'active' : ''}" onclick="navigateTo('events')">
                            <i class="fas fa-calendar"></i>
                            <span>Events</span>
                        </button>
                        <button class="nav-item ${state.currentPage === 'swipe' ? 'active' : ''}" onclick="navigateTo('swipe')">
                            <i class="fas fa-users"></i>
                            <span>Connect</span>
                        </button>
                        <button class="nav-item ${state.currentPage === 'matches' ? 'active' : ''}" onclick="navigateTo('matches')">
                            <i class="fas fa-heart"></i>
                            <span>Matches${unreadCount > 0 ? ` (${unreadCount})` : ''}</span>
                        </button>
                        <button class="nav-item ${state.currentPage === 'profile' ? 'active' : ''}" onclick="navigateTo('profile')">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </button>
                    </div>
                `;
            } else {
                bottomNav.innerHTML = '';
            }
            
            // Update menu
            updateMenu();
        }

        function toggleMenu() {
            state.menuOpen = !state.menuOpen;
            updateMenu();
        }

        function updateMenu() {
            // Remove existing menu
            const existingMenu = document.querySelector('.menu-dropdown');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            if (state.menuOpen && state.currentUser) {
                const menu = document.createElement('div');
                menu.className = 'menu-dropdown';
                
                menu.innerHTML = `
                    <button class="menu-item" onclick="navigateTo('dashboard')">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </button>
                    <button class="menu-item" onclick="navigateTo('bookmarked-events')">
                        <i class="fas fa-bookmark"></i>
                        <span>Bookmarked Events</span>
                    </button>
                    <button class="menu-item" onclick="navigateTo('analytics')">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                    <button class="menu-item" onclick="navigateTo('notifications')">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                    </button>
                    <button class="menu-item" onclick="navigateTo('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    ${state.demoMode ? `
                        <button class="menu-item" onclick="exitDemo()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Exit Demo</span>
                        </button>
                    ` : ''}
                    <hr style="border-color: rgba(255,255,255,0.1); margin: 8px 0;">
                    <button class="menu-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Log Out</span>
                    </button>
                `;
                
                document.body.appendChild(menu);
                
                // Close menu when clicking outside
                setTimeout(() => {
                    const closeMenu = (e) => {
                        if (!menu.contains(e.target) && !e.target.closest('.nav-actions')) {
                            state.menuOpen = false;
                            updateMenu();
                            document.removeEventListener('click', closeMenu);
                        }
                    };
                    document.addEventListener('click', closeMenu);
                }, 100);
            }
        }

        // ===== PAGE COMPONENTS =====
        function renderHomePage(container) {
            const upcomingEvents = state.events.slice(0, 3);
            const isSignedIn = !!state.currentUser;
            
            container.innerHTML = `
                <div class="hero-bg"></div>
                
                <div class="hero">
                    <h1>Amplify Your Connections at Live Events</h1>
                    <p class="hero-subtitle">Scan the QR code at any event to see who's there and connect instantly with verified attendees.</p>
                    
                    <div class="cta-grid">
                        ${isSignedIn ? 
                            `<button class="btn btn-primary btn-large" onclick="navigateTo('scanner')">
                                <i class="fas fa-qrcode"></i> Scan Event QR Code
                            </button>
                            ${!state.isPro && !state.isProPlus ? `
                                <button class="btn btn-pro btn-large" onclick="navigateTo('pricing')">
                                    <i class="fas fa-crown"></i> Upgrade to Pro
                                </button>
                            ` : ''}` :
                            `<button class="btn btn-primary btn-large" onclick="navigateTo('auth')">
                                <i class="fas fa-user-plus"></i> Get Started Free
                            </button>
                            <button class="btn btn-glass btn-large" onclick="enterDemoMode()">
                                <i class="fas fa-play-circle"></i> Try Demo
                            </button>`
                        }
                    </div>
                </div>
                
                ${isSignedIn ? renderSignedInHomeContent() : renderSignedOutHomeContent(container)}
            `;
        }

        function renderSignedInHomeContent() {
            const featuredEvents = state.events.filter(e => e.type === 'featured' && e.promoted);
            const activeEvents = state.events.filter(e => e.type === 'active');
            const eventsAttended = 12;
            const totalMatches = state.matches.length;
            const responseRate = '89%';
            const remainingSwipes = state.isPro || state.isProPlus ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
            
            return `
                <!-- Profile Summary -->
                <div class="card mb-4">
                    <div class="flex items-center gap-4">
                        <div class="avatar ${state.isPro ? 'pro' : state.isProPlus ? 'pro-plus' : ''}" style="background-image: url('${state.userProfile.profilePhoto}'); width: 60px; height: 60px;">
                            ${state.isPro ? '<div class="pro-badge" style="position: absolute; bottom: -4px; right: -4px; font-size: 8px;"><i class="fas fa-crown"></i></div>' : ''}
                            ${state.isProPlus ? '<div class="pro-plus-badge" style="position: absolute; bottom: -4px; right: -4px; font-size: 8px;"><i class="fas fa-star"></i></div>' : ''}
                        </div>
                        <div style="flex: 1;">
                            <h3 class="mb-1">${state.userProfile.name}</h3>
                            <p class="text-gray-400 text-sm">${state.userProfile.occupation}  ${state.userProfile.company}</p>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="navigateTo('edit-profile')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div class="stats-grid mt-4">
                        <div class="stat-card">
                            <div class="stat-value">${eventsAttended}</div>
                            <div class="stat-label">Events</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalMatches}</div>
                            <div class="stat-label">Matches</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${responseRate}</div>
                            <div class="stat-label">Response</div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Grid -->
                <h3 class="mb-3">Quick Actions</h3>
                <div class="quick-actions compact-grid">
                    <div class="action-card primary" onclick="${state.isPro || state.isProPlus ? "navigateTo('create-event')" : "showUpgradeModal()"}">
                        <i class="fas fa-plus-circle"></i>
                        <h4>Create Event</h4>
                        <p class="text-gray-400">${state.isPro || state.isProPlus ? 'Set up a new event' : 'Upgrade to create events'}</p>
                        ${!state.isPro && !state.isProPlus ? '<div class="pro-badge mt-2">PRO</div>' : ''}
                    </div>
                    
                    <div class="action-card blue" onclick="navigateTo('scanner')">
                        <i class="fas fa-qrcode"></i>
                        <h4>Scan QR</h4>
                        <p class="text-gray-400">Join an event</p>
                    </div>
                    
                    <div class="action-card pink" onclick="navigateTo('matches')">
                        <i class="fas fa-heart"></i>
                        <h4>My Matches</h4>
                        <p class="text-gray-400">${state.matches.length} matches</p>
                    </div>
                    
                    <div class="action-card gold" onclick="navigateTo('dashboard')">
                        <i class="fas fa-chart-line"></i>
                        <h4>Limits</h4>
                        <p class="text-gray-400">${remainingSwipes} likes left</p>
                        ${remainingSwipes <= 5 && !state.isPro && !state.isProPlus ? '<div class="upgrade-badge">Upgrade</div>' : ''}
                    </div>
                </div>
                
                <!-- Daily Limits -->
                <div class="card mt-4">
                    <h4 class="mb-4">Daily Limits</h4>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Likes remaining</span>
                                <span class="text-sm font-semibold">${remainingSwipes}</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : ((state.dailyLikes - state.swipeCount) / state.dailyLikes * 100)}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Super Likes</span>
                                <span class="text-sm font-semibold">${state.isPro ? '5' : state.isProPlus ? '5' : state.superLikes} left</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : (state.superLikes * 100)}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Rewinds</span>
                                <span class="text-sm font-semibold">${state.isPro || state.isProPlus ? '' : state.rewindCount} left</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : (state.rewindCount * 100)}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Active Events Near You -->
                <h3 class="mt-8 mb-4">Active Events Near You</h3>
                ${activeEvents.length > 0 ? `
                    <div class="event-carousel">
                        <div class="event-carousel-track" id="eventCarouselTrack">
                            ${activeEvents.map(event => `
                                <div class="event-carousel-item">
                                    <div class="event-card notched-tl mb-4" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h4>${event.name}</h4>
                                                <p class="text-gray-400">
                                                    <i class="fas fa-map-marker-alt"></i> ${event.location}
                                                </p>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-gradient font-bold">${event.attendees} people</div>
                                                <p class="text-sm">${event.date}</p>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="w-full bg-gray-800 rounded-full h-2">
                                                <div class="bg-primary h-2 rounded-full" style="width: ${(event.attendees / event.maxAttendees * 100)}%"></div>
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-400 mt-2">
                                                <span>${event.attendees} joined</span>
                                                <span>${event.maxAttendees} capacity</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="carousel-dots" id="carouselDots">
                            ${activeEvents.map((_, index) => `
                                <button class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="moveCarousel(${index})"></button>
                            `).join('')}
                        </div>
                    </div>
                ` : `
                    <div class="card text-center py-8">
                        <i class="fas fa-calendar-times text-gray-600 text-4xl mb-4"></i>
                        <p class="text-gray-400 mb-4">No active events near you</p>
                        <button class="btn btn-primary" onclick="navigateTo('events')">
                            <i class="fas fa-search"></i> Browse Events
                        </button>
                    </div>
                `}
            `;
        }

        function renderSignedOutHomeContent(container) {
            const features = [
                {
                    icon: 'fa-qrcode',
                    title: 'Scan & Connect',
                    description: 'Scan QR codes at events to instantly see who\'s there'
                },
                {
                    icon: 'fa-users',
                    title: 'Verified Attendees',
                    description: 'Connect with real people actually at the event'
                },
                {
                    icon: 'fa-calendar',
                    title: 'Find Events',
                    description: 'Discover events happening near you'
                },
                {
                    icon: 'fa-heart',
                    title: 'Smart Matches',
                    description: 'Get matched based on shared interests'
                }
            ];
            
            const upcomingEvents = state.events.slice(0, 3);
            
            return `
                <!-- How It Works -->
                <div class="section-spacing">
                    <h2 class="text-center mb-6">How It Works</h2>
                    <div class="features-grid">
                        ${features.map(feature => `
                            <div class="feature">
                                <div class="feature-icon">
                                    <i class="fas ${feature.icon}"></i>
                                </div>
                                <h3 class="mb-2">${feature.title}</h3>
                                <p class="text-gray-400">${feature.description}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Featured Events with Carousel -->
                <div class="section-spacing">
                    <h2 class="mb-4">Featured Events</h2>
                    <p class="text-gray-400 mb-4">Join trending events near you</p>
                    
                    <div class="event-carousel">
                        <div class="event-carousel-track" id="featuredCarouselTrack">
                            ${upcomingEvents.map(event => `
                                <div class="event-carousel-item">
                                    <div class="event-card compact-card no-clip" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                        ${event.maxUserOwned ? '<div class="featured-badge"><i class="fas fa-crown"></i> Featured</div>' : ''}
                                        <div class="event-card-header">
                                            <div>
                                                <h3 class="mb-2">${event.name}</h3>
                                                <p class="text-gray-400 text-sm">
                                                    <i class="fas fa-map-marker-alt"></i> ${event.location}
                                                </p>
                                            </div>
                                            <button class="bookmark-button ${event.bookmarked ? 'active' : ''}" onclick="toggleBookmark(${event.id}); event.stopPropagation()">
                                                <i class="fas fa-bookmark"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="event-media-preview">
                                            ${event.mediaType === 'video' ? `
                                                <video muted loop playsinline>
                                                    <source src="${event.mediaUrl}" type="video/mp4">
                                                </video>
                                                <div class="media-play-overlay">
                                                    <button class="play-button" onclick="playEventVideo(${event.id}); event.stopPropagation()">
                                                        <i class="fas fa-play"></i>
                                                    </button>
                                                </div>
                                            ` : `
                                                <img src="${event.coverImage}" alt="${event.name}">
                                            `}
                                        </div>
                                        
                                        <p class="text-gray-300 mb-4">${event.description.substring(0, 80)}...</p>
                                        
                                        <div class="event-info">
                                            <i class="fas fa-calendar"></i>
                                            <span>${event.date}  ${event.time}</span>
                                        </div>
                                        <div class="event-info">
                                            <i class="fas fa-users"></i>
                                            <span>${event.attendees} attending</span>
                                        </div>
                                        ${event.geoFencing ? `
                                            <div class="event-info">
                                                <i class="fas fa-location-dot"></i>
                                                <span class="location-badge">Geo-fenced</span>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="mt-4">
                                            <div class="flex gap-2">
                                                ${event.tags.slice(0, 3).map(tag => `
                                                    <span class="text-xs px-3 py-1 bg-gray-800 rounded-full">${tag}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="carousel-dots" id="featuredCarouselDots">
                            ${upcomingEvents.map((_, index) => `
                                <button class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="moveFeaturedCarousel(${index})"></button>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- Call to Action -->
                <div class="card mt-8 text-center compact-card">
                    <h3 class="mb-4">Ready to Amplify Your Connections?</h3>
                    <p class="text-gray-400 mb-6">Join thousands who are making meaningful connections at events</p>
                    <button class="btn btn-primary btn-large" onclick="navigateTo('auth')">
                        <i class="fas fa-rocket"></i> Start Free
                    </button>
                </div>
            `;
        }

        function renderAuthPage(container) {
            container.innerHTML = `
                <div class="auth-container">
                    <h2 class="text-center mb-5">Welcome to Amps</h2>
                    
                    <div class="card">
                        <div class="auth-tabs">
                            <button class="auth-tab active" id="loginTab" onclick="switchAuthTab('login')">Sign In</button>
                            <button class="auth-tab" id="signupTab" onclick="switchAuthTab('signup')">Sign Up</button>
                        </div>
                        
                        <form id="authForm" onsubmit="handleAuth(event)">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="authEmail" placeholder="you@example.com" value="demo@amps.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" id="authPassword" placeholder="" value="password" required minlength="6">
                            </div>
                            
                            <div id="signupFields" class="hidden">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="authName" placeholder="Alex Johnson" value="Demo User">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Age</label>
                                    <input type="number" class="form-control" id="authAge" placeholder="24" min="18" max="100" value="28">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="authPhone" placeholder="+264 81 123 4567" value="+264 81 123 4567">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-block mt-4" id="authSubmit">
                                <i class="fas fa-sign-in-alt"></i> Continue
                            </button>
                        </form>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-outline btn-block" onclick="enterDemoMode()">
                                <i class="fas fa-rocket"></i> Continue as Demo User
                            </button>
                        </div>
                        
                        <div class="text-xs text-gray-400 text-center mt-4 p-3 bg-gray-900/50 rounded-lg">
                            Demo credentials pre-filled. Just click "Continue"!
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDashboardPage(container) {
            const eventsAttended = 12;
            const totalMatches = state.matches.length;
            const responseRate = '89%';
            const remainingSwipes = state.isPro || state.isProPlus ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
            const featuredEvents = state.events.filter(e => e.type === 'featured' && e.promoted);
            const activeEvents = state.events.filter(e => e.type === 'active');
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="avatar ${state.isPro ? 'pro' : state.isProPlus ? 'pro-plus' : ''}" style="background-image: url('${state.userProfile.profilePhoto}');">
                        ${state.isPro ? '<div class="pro-badge" style="position: absolute; bottom: -8px; right: -8px; font-size: 10px;"><i class="fas fa-crown"></i></div>' : ''}
                        ${state.isProPlus ? '<div class="pro-plus-badge" style="position: absolute; bottom: -8px; right: -8px; font-size: 10px;"><i class="fas fa-star"></i></div>' : ''}
                    </div>
                    <h2>${state.userProfile.name}</h2>
                    <p class="text-gradient">${state.userProfile.occupation} at ${state.userProfile.company}</p>
                    ${state.isPro ? 
                        '<div class="pro-badge mt-2"><i class="fas fa-crown"></i> PRO MEMBER</div>' : 
                        state.isProPlus ?
                        '<div class="pro-plus-badge mt-2"><i class="fas fa-star"></i> PRO PLUS</div>' :
                        '<div class="free-badge mt-2"><i class="fas fa-user"></i> FREE MEMBER</div>'
                    }
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${eventsAttended}</div>
                        <div class="stat-label">Events Attended</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalMatches}</div>
                        <div class="stat-label">Total Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${responseRate}</div>
                        <div class="stat-label">Response Rate</div>
                    </div>
                </div>
                
                <h3 class="mt-6 mb-4">Quick Actions</h3>
                <div class="quick-actions">
                    <div class="action-card primary" onclick="${state.isPro || state.isProPlus ? "navigateTo('create-event')" : "showUpgradeModal()"}">
                        <i class="fas fa-plus-circle"></i>
                        <h4>Create Event</h4>
                        <p class="text-gray-400">${state.isPro || state.isProPlus ? 'Set up a new event' : 'Upgrade to create events'}</p>
                        ${!state.isPro && !state.isProPlus ? '<div class="pro-badge mt-2">PRO</div>' : ''}
                    </div>
                    
                    <div class="action-card blue" onclick="navigateTo('scanner')">
                        <i class="fas fa-qrcode"></i>
                        <h4>Scan QR</h4>
                        <p class="text-gray-400">Join an event</p>
                    </div>
                    
                    <div class="action-card pink" onclick="navigateTo('matches')">
                        <i class="fas fa-heart"></i>
                        <h4>My Matches</h4>
                        <p class="text-gray-400">${state.matches.length} matches</p>
                    </div>
                    
                    <div class="action-card gold" onclick="${state.isPro || state.isProPlus ? "navigateTo('profile-views')" : "showUpgradeModal()"}">
                        <i class="fas fa-eye"></i>
                        <h4>Profile Views</h4>
                        <p class="text-gray-400">${state.isPro || state.isProPlus ? 'See who viewed you' : 'Pro feature'}</p>
                        ${!state.isPro && !state.isProPlus ? '<div class="pro-badge mt-2">PRO</div>' : ''}
                    </div>
                </div>
                
                <!-- Daily Limits -->
                <div class="card mt-6">
                    <h4 class="mb-4">Daily Limits</h4>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Likes remaining</span>
                                <span class="text-sm font-semibold">${remainingSwipes}</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : ((state.dailyLikes - state.swipeCount) / state.dailyLikes * 100)}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Super Likes</span>
                                <span class="text-sm font-semibold">${state.isPro ? '5' : state.isProPlus ? '5' : state.superLikes} left</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : (state.superLikes * 100)}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Rewinds</span>
                                <span class="text-sm font-semibold">${state.isPro || state.isProPlus ? '' : state.rewindCount} left</span>
                            </div>
                            <div class="w-full bg-gray-800 rounded-full h-2">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: ${state.isPro || state.isProPlus ? '100' : (state.rewindCount * 100)}%"></div>
                            </div>
                        </div>
                    </div>
                    ${remainingSwipes <= 5 && !state.isPro && !state.isProPlus ? `
                        <button class="btn btn-pro btn-block mt-4" onclick="navigateTo('pricing')">
                            <i class="fas fa-crown"></i> Upgrade for Unlimited
                        </button>
                    ` : ''}
                </div>
                
                <!-- Active Events Near You -->
                <h3 class="mt-8 mb-4">Active Events Near You</h3>
                ${activeEvents.length > 0 ? `
                    <div id="activeEvents">
                        ${activeEvents.slice(0, 2).map(event => `
                            <div class="event-card notched-tl mb-4" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4>${event.name}</h4>
                                        <p class="text-gray-400">
                                            <i class="fas fa-map-marker-alt"></i> ${event.location}
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-gradient font-bold">${event.attendees} people</div>
                                        <p class="text-sm">${event.date}</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="w-full bg-gray-800 rounded-full h-2">
                                        <div class="bg-primary h-2 rounded-full" style="width: ${(event.attendees / event.maxAttendees * 100)}%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                                        <span>${event.attendees} joined</span>
                                        <span>${event.maxAttendees} capacity</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div class="card text-center py-8">
                        <i class="fas fa-calendar-times text-gray-600 text-4xl mb-4"></i>
                        <p class="text-gray-400 mb-4">No active events near you</p>
                        <button class="btn btn-primary" onclick="navigateTo('events')">
                            <i class="fas fa-search"></i> Browse Events
                        </button>
                    </div>
                `}
            `;
        }

        function renderScannerPage(container) {
            container.innerHTML = `
                <div class="scanner-container">
                    <h2 class="text-center">Scan Event QR Code</h2>
                    <p class="text-center mt-2">Point your camera at the event QR code to join</p>
                    
                    <div class="qr-scanner" id="qrScanner">
                        <div class="scanner-overlay"></div>
                        <div class="scanner-line"></div>
                    </div>
                    
                    <button class="btn btn-primary btn-block mt-4" onclick="startCameraScanning()">
                        <i class="fas fa-camera"></i> Start Scanner
                    </button>
                    
                    <button class="btn btn-outline btn-block mt-2" onclick="enterCodeManually()">
                        <i class="fas fa-keyboard"></i> Enter Code Manually
                    </button>
                    
                    <div class="card-glass mt-4">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-info-circle text-gradient"></i>
                            <p>Camera and location access required. You must be at the event location to join.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSwipePage(container) {
            if (!state.currentEvent) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-calendar-times" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No Active Event</h3>
                        <p class="text-gray-400 mb-6">Join an event first to start connecting with people</p>
                        <button class="btn btn-primary" onclick="navigateTo('events')">
                            <i class="fas fa-calendar"></i> Browse Events
                        </button>
                    </div>
                `;
                return;
            }
            
            // Apply filters
            let filteredProfiles = MOCK_PROFILES.filter(profile => {
                // Distance filter
                const distance = parseInt(profile.distance);
                if (distance > state.filters.distance) return false;
                
                // Age filter
                if (profile.age < state.filters.ageRange.min || profile.age > state.filters.ageRange.max) return false;
                
                // Gender filter
                if (state.filters.gender !== 'all' && profile.gender !== state.filters.gender) return false;
                
                // Verified filter
                if (state.filters.verifiedOnly && !profile.verified) return false;
                
                // Interests filter
                if (state.filters.interests.length > 0) {
                    const hasInterest = state.filters.interests.some(interest => 
                        profile.interests.some(pInterest => 
                            pInterest.toLowerCase().includes(interest.toLowerCase())
                        )
                    );
                    if (!hasInterest) return false;
                }
                
                return true;
            });
            
            filteredProfiles = filteredProfiles.filter(p => 
                !state.swipeHistory.some(s => s.profile.id === p.id)
            );
            
            if (filteredProfiles.length === 0) {
                container.innerHTML = `
                    <div class="swipe-interface">
                        <div class="swipe-header">
                            <div class="event-badge">
                                ${state.currentEvent.name}  No more profiles
                            </div>
                        </div>
                        
                        <div class="card-stack">
                            <div class="text-center text-white">
                                <i class="fas fa-users" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                                <h3 class="text-2xl font-bold mb-2">No profiles match your filters</h3>
                                <p class="text-gray-400 mb-6">Try adjusting your filters or check back soon!</p>
                                <div class="flex gap-3">
                                    <button class="btn btn-outline" onclick="clearFilters()">
                                        <i class="fas fa-filter"></i> Clear Filters
                                    </button>
                                    <button class="btn btn-primary" onclick="resetSwipes()">
                                        <i class="fas fa-redo"></i> Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            const currentProfile = filteredProfiles[0];
            const nextProfile = filteredProfiles[1] || null;
            const thirdProfile = filteredProfiles[2] || null;
            
            // Calculate remaining swipes based on plan
            let remainingSwipes;
            if (state.isProPlus) {
                remainingSwipes = '';
            } else if (state.isPro) {
                remainingSwipes = Math.max(0, 30 - state.swipeCount);
            } else {
                remainingSwipes = Math.max(0, 25 - state.swipeCount);
            }
            
            container.innerHTML = `
                <div class="swipe-interface">
                    <div class="for-you-bg">FOR YOU</div>
                    
                    <div class="swipe-header">
                        <div class="flex justify-between items-center mb-4">
                            <div class="event-badge notched-tl">
                                <i class="fas fa-calendar"></i>
                                <span>${state.currentEvent.name}</span>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-glass btn-small" onclick="showFiltersModal()">
                                    <i class="fas fa-filter"></i>
                                    ${Object.keys(state.activeFilters).length > 0 ? '<span class="ml-1"></span>' : ''}
                                </button>
                                <button class="btn btn-glass btn-small" onclick="viewFullProfile(${currentProfile.id})">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Swipe Limit Counter -->
                        <div class="swipe-limit-counter">
                            <span>Swipes left today:</span>
                            <div class="swipe-limit-progress">
                                <div class="swipe-limit-fill" style="width: ${state.isPro || state.isProPlus ? '100' : (remainingSwipes / 25 * 100)}%"></div>
                            </div>
                            <span>${remainingSwipes}</span>
                        </div>
                        
                        <div class="text-center text-gray-400 text-sm mb-4">
                            <i class="fas fa-user-friends"></i>
                            <span>${filteredProfiles.length} profiles available  ${Object.keys(state.activeFilters).length > 0 ? 'Filters active' : 'No filters'}</span>
                        </div>
                    </div>
                    
                    <div class="card-stack">
                        <div class="card-container">
                            ${thirdProfile ? `
                                <div class="profile-card" style="z-index: 1; scale: 0.90; translate: -8px -24px; rotate: -2deg; opacity: 0.4;">
                                    <div class="card-content" style="background: ${thirdProfile.cardColor};">
                                        <div class="profile-image" style="background-image: url('${thirdProfile.livePhoto}');"></div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${nextProfile ? `
                                <div class="profile-card" style="z-index: 2; scale: 0.95; translate: 8px -12px; rotate: 2deg; opacity: 0.7;">
                                    <div class="card-content" style="background: ${nextProfile.cardColor};">
                                        <div class="profile-image" style="background-image: url('${nextProfile.livePhoto}');"></div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="profile-card" id="profileCard${currentProfile.id}" style="z-index: 3;">
                                <div class="card-frame"></div>
                                <div class="card-content" style="background: ${currentProfile.cardColor};">
                                    <div class="profile-image" style="background-image: url('${currentProfile.livePhoto}');">
                                        <div class="live-badge" style="position: absolute; top: 16px; right: 16px;">
                                            <i class="fas fa-camera"></i>
                                            <span>LIVE</span>
                                        </div>
                                    </div>
                                    <div class="profile-info">
                                        <h2>${currentProfile.name}, ${currentProfile.age}</h2>
                                        <p class="text-gray-600 mb-4">
                                            <i class="fas fa-map-marker-alt"></i> ${currentProfile.location}
                                            ${state.privacySettings.showDistance ? `  ${currentProfile.distance}` : ''}
                                        </p>
                                        
                                        <p class="mb-4">${currentProfile.bio}</p>
                                        
                                        <div class="interests mb-6">
                                            ${currentProfile.interests.slice(0, 4).map(interest => `
                                                <span class="interest-tag">${interest}</span>
                                            `).join('')}
                                        </div>
                                        
                                        <div class="text-center text-gray-600 text-sm">
                                            <i class="fas fa-shield-alt"></i>
                                            <span>Verified attendee at ${state.currentEvent.name}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="swipe-overlay like">LIKE</div>
                                <div class="swipe-overlay nope">NOPE</div>
                                <div class="swipe-overlay super">SUPER</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="swipe-actions">
                        <button class="action-button" onclick="swipeLeft()" ${(remainingSwipes === 0 && !state.isPro && !state.isProPlus) ? 'disabled' : ''}>
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <button class="action-button undo" onclick="undoSwipe()" ${state.swipeHistory.length === 0 || (!state.isPro && !state.isProPlus && state.rewindCount <= 0) ? 'disabled' : ''}>
                            <i class="fas fa-redo"></i>
                        </button>
                        
                        <button class="action-button like" onclick="swipeRight()" ${(remainingSwipes === 0 && !state.isPro && !state.isProPlus) ? 'disabled' : ''}>
                            <i class="fas fa-heart"></i>
                        </button>
                        
                        <button class="action-button" onclick="superLike()" ${(!state.isPro && !state.isProPlus && state.superLikes <= 0) ? 'disabled' : ''}>
                            <i class="fas fa-star"></i>
                        </button>
                    </div>
                    
                    <div class="text-center text-gray-400 px-4 pb-4">
                        <div class="flex justify-center gap-6 mb-2">
                            <div class="text-sm">
                                <i class="fas fa-heart"></i>
                                <span>Like</span>
                            </div>
                            <div class="text-sm">
                                <i class="fas fa-times"></i>
                                <span>Pass</span>
                            </div>
                            <div class="text-sm">
                                <i class="fas fa-star"></i>
                                <span>Super Like</span>
                            </div>
                        </div>
                        ${(remainingSwipes <= 5 && !state.isPro && !state.isProPlus) ? `
                            <button class="btn btn-pro btn-small mt-2" onclick="navigateTo('pricing')">
                                <i class="fas fa-crown"></i> Upgrade for unlimited
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Initialize swipe gestures
            setTimeout(() => initializeSwipeGestures(), 100);
        }

        function renderEventsPage(container) {
            const userEvents = state.events.filter(e => e.organizerId === 1 || state.bookmarkedEvents.includes(e.id) || e.rsvp === 'going');
            const featuredEvents = state.events.filter(e => e.type === 'featured');
            const activeEvents = state.events.filter(e => e.type === 'active');
            const pastEvents = state.events.filter(e => e.type === 'past');
            
            container.innerHTML = `
                <div class="event-search">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search events..." id="eventSearch">
                        <button class="btn btn-primary" onclick="searchEvents()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <div class="search-tags">
                        <span class="search-tag active" onclick="filterEventsByTag('all')">All</span>
                        <span class="search-tag" onclick="filterEventsByTag('tech')">Tech</span>
                        <span class="search-tag" onclick="filterEventsByTag('art')">Art</span>
                        <span class="search-tag" onclick="filterEventsByTag('music')">Music</span>
                        <span class="search-tag" onclick="filterEventsByTag('networking')">Networking</span>
                        <span class="search-tag" onclick="filterEventsByTag('wellness')">Wellness</span>
                    </div>
                </div>
                
                <!-- Create Event Button -->
                <div class="card mb-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3>Create Your Own Event</h3>
                            <p class="text-gray-400">Host your own gathering and connect with people</p>
                        </div>
                        <button class="btn ${state.isPro || state.isProPlus ? 'btn-primary' : 'btn-pro'}" onclick="${state.isPro || state.isProPlus ? "navigateTo('create-event')" : "showUpgradeModal()"}">
                            <i class="fas fa-plus"></i> Create Event
                        </button>
                    </div>
                </div>
                
                <!-- My Events -->
                <h3 class="mb-3">My Events</h3>
                ${userEvents.length > 0 ? `
                    <div class="events-grid">
                        ${userEvents.map(event => `
                            <div class="event-card notched-tl" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                <div class="event-card-header">
                                    <div>
                                        <h4>${event.name}</h4>
                                        <p class="text-gray-400">
                                            <i class="fas fa-map-marker-alt"></i> ${event.location}
                                        </p>
                                    </div>
                                    <div class="flex gap-2">
                                        ${event.bookmarked ? '<i class="fas fa-bookmark text-yellow-500"></i>' : ''}
                                        ${event.rsvp === 'going' ? '<i class="fas fa-check-circle text-green-500"></i>' : ''}
                                    </div>
                                </div>
                                <p class="text-gray-300 mb-4">${event.description.substring(0, 100)}...</p>
                                <div class="event-info">
                                    <i class="fas fa-calendar"></i>
                                    <span>${event.date}  ${event.time}</span>
                                </div>
                                <div class="event-info">
                                    <i class="fas fa-users"></i>
                                    <span>${event.attendees} attending</span>
                                </div>
                                <button class="btn btn-primary btn-block mt-4">
                                    <i class="fas fa-eye"></i> View Details
                                </button>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div class="card text-center py-8">
                        <i class="fas fa-calendar-plus text-gray-600 text-4xl mb-4"></i>
                        <p class="text-gray-400 mb-4">You haven't joined or created any events yet</p>
                        <button class="btn btn-primary" onclick="navigateTo('scanner')">
                            <i class="fas fa-qrcode"></i> Join an Event
                        </button>
                    </div>
                `}
                
                <!-- Active Events -->
                <h3 class="mt-8 mb-3">Active Events</h3>
                ${activeEvents.length > 0 ? `
                    <div class="events-grid">
                        ${activeEvents.map(event => `
                            <div class="event-card notched-tl" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                ${event.maxUserOwned && event.customTheme ? '<div class="featured-badge"><i class="fas fa-palette"></i> Custom Theme</div>' : ''}
                                <div class="event-media-preview">
                                    ${event.mediaType === 'video' ? `
                                        <video muted loop playsinline>
                                            <source src="${event.mediaUrl}" type="video/mp4">
                                        </video>
                                        <div class="media-play-overlay">
                                            <button class="play-button" onclick="playEventVideo(${event.id}); event.stopPropagation()">
                                                <i class="fas fa-play"></i>
                                            </button>
                                        </div>
                                    ` : `
                                        <img src="${event.coverImage}" alt="${event.name}">
                                    `}
                                </div>
                                <div class="event-card-header">
                                    <div>
                                        <h4>${event.name}</h4>
                                        <p class="text-gray-400">
                                            <i class="fas fa-map-marker-alt"></i> ${event.location}
                                        </p>
                                    </div>
                                    <button class="bookmark-button ${event.bookmarked ? 'active' : ''}" onclick="toggleBookmark(${event.id}); event.stopPropagation()">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                </div>
                                <div class="event-info">
                                    <i class="fas fa-calendar"></i>
                                    <span>${event.date}  ${event.time}</span>
                                </div>
                                <div class="event-info">
                                    <i class="fas fa-users"></i>
                                    <span>${event.attendees} / ${event.maxAttendees} attending</span>
                                </div>
                                <div class="mt-4">
                                    <div class="flex gap-2">
                                        ${event.tags.slice(0, 3).map(tag => `
                                            <span class="text-xs px-3 py-1 bg-gray-800 rounded-full">${tag}</span>
                                        `).join('')}
                                    </div>
                                </div>
                                <button class="btn btn-primary btn-block mt-4">
                                    <i class="fas fa-eye"></i> View Details
                                </button>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <p class="text-gray-400 text-center py-4">No active events at the moment.</p>
                `}
                
                <!-- Past Events -->
                ${pastEvents.length > 0 ? `
                    <h3 class="mt-8 mb-3">Past Events</h3>
                    <div class="events-grid">
                        ${pastEvents.map(event => `
                            <div class="event-card notched-tl" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                <div class="event-card-header">
                                    <div>
                                        <h4>${event.name}</h4>
                                        <p class="text-gray-400">
                                            <i class="fas fa-map-marker-alt"></i> ${event.location}
                                        </p>
                                    </div>
                                    <div class="text-gray-400 text-sm">${event.date}</div>
                                </div>
                                <p class="text-gray-300 mb-4">${event.description.substring(0, 100)}...</p>
                                <div class="event-info">
                                    <i class="fas fa-users"></i>
                                    <span>${event.attendees} attended</span>
                                </div>
                                <button class="btn btn-outline btn-block mt-4">
                                    <i class="fas fa-eye"></i> View Recap
                                </button>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
        }

        function renderMatchesPage(container) {
            container.innerHTML = `
                <h2 class="mb-4">Your Matches</h2>
                
                ${state.matches.length > 0 ? `
                    <div class="attendee-list">
                        ${state.matches.map(match => {
                            const profile = MOCK_PROFILES.find(p => p.id === match.matchId) || match.user;
                            return `
                                <div class="attendee-item" onclick="openChat(${match.matchId})" style="cursor: pointer;">
                                    <div class="attendee-avatar" style="background-image: url('${profile?.livePhoto || ''}');"></div>
                                    <div class="attendee-info">
                                        <div class="flex items-center gap-2">
                                            <h4>${profile?.name || 'Unknown'}, ${profile?.age || ''}</h4>
                                            ${match.unread ? '<span class="w-2 h-2 bg-primary rounded-full"></span>' : ''}
                                        </div>
                                        <p class="text-gray-400 text-sm">${match.lastMessage || 'New match!'}</p>
                                        <div class="text-xs text-gray-500 mt-1">${match.lastMessageTime || 'Just now'}  ${state.currentEvent?.name || 'Event'}</div>
                                    </div>
                                    <div class="attendee-status ${(profile?.online) ? 'status-online' : 'status-away'}">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        <span>${(profile?.online) ? 'Online' : 'Away'}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : `
                    <div class="text-center py-12">
                        <i class="fas fa-heart" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No Matches Yet</h3>
                        <p class="text-gray-400 mb-6">Start swiping at events to make connections!</p>
                        <button class="btn btn-primary" onclick="navigateTo('events')">
                            <i class="fas fa-calendar"></i> Find Events
                        </button>
                    </div>
                `}
                
                <div class="card mt-6">
                    <h4 class="mb-4">Match Statistics</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold mb-1">${state.matches.length}</div>
                            <div class="text-sm text-gray-400">Total Matches</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold mb-1">${state.matches.filter(m => m.unread).length}</div>
                            <div class="text-sm text-gray-400">Unread</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold mb-1">${state.isPro || state.isProPlus ? '89%' : 'Pro+'}</div>
                            <div class="text-sm text-gray-400">Response Rate</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold mb-1">${state.isPro || state.isProPlus ? '24h' : 'Pro+'}</div>
                            <div class="text-sm text-gray-400">Avg. Reply Time</div>
                        </div>
                    </div>
                </div>
                
                ${!state.isPro && !state.isProPlus ? `
                    <div class="card mt-6">
                        <div class="flex items-center gap-4">
                            <div>
                                <h4 class="mb-2">Upgrade for Better Matches</h4>
                                <p class="text-gray-400 text-sm">Get read receipts, video calls, and see who liked you</p>
                            </div>
                            <button class="btn btn-pro" onclick="navigateTo('pricing')">
                                <i class="fas fa-crown"></i> Upgrade
                            </button>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function renderProfilePage(container) {
            const remainingSwipes = state.isPro || state.isProPlus ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
            const availablePhotos = state.userProfile.maxPhotos - state.userProfile.profilePhotos.length;
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="avatar ${state.isPro ? 'pro' : state.isProPlus ? 'pro-plus' : ''}" style="background-image: url('${state.userProfile.profilePhoto}');">
                        <button class="absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full" onclick="changeProfilePhoto()">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <h2>${state.userProfile.name}, ${state.userProfile.age}</h2>
                    <p class="text-gradient">${state.userProfile.occupation}  ${state.userProfile.company}</p>
                    
                    <div class="flex gap-3 mt-4">
                        ${state.isPro ? 
                            '<div class="pro-badge"><i class="fas fa-crown"></i> PRO MEMBER</div>' : 
                            state.isProPlus ?
                            '<div class="pro-plus-badge"><i class="fas fa-star"></i> PRO PLUS</div>' :
                            '<div class="free-badge"><i class="fas fa-user"></i> FREE MEMBER</div>'
                        }
                        <div class="pro-badge" style="background: var(--bg-tertiary); color: var(--gray-300);">
                            <i class="fas fa-heart"></i>
                            <span>${remainingSwipes} likes today</span>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <h3 class="mb-4">About</h3>
                    <p class="text-gray-300 mb-4">${state.userProfile.bio}</p>
                    <div class="flex flex-wrap gap-2">
                        ${state.userProfile.interests.map(interest => `
                            <span class="px-3 py-1 bg-gray-800 rounded-full text-sm">${interest}</span>
                        `).join('')}
                    </div>
                    <button class="btn btn-outline btn-block mt-4" onclick="navigateTo('edit-profile')">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
                
                <!-- Profile Photos -->
                <div class="card mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3>Profile Photos</h3>
                        <span class="text-gray-400 text-sm">${state.userProfile.profilePhotos.length}/${state.userProfile.maxPhotos}</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        ${state.userProfile.profilePhotos.map((photo, index) => `
                            <div class="photo-item">
                                <img src="${photo}" alt="Profile photo ${index + 1}">
                                <div class="photo-overlay">
                                    <div class="photo-actions">
                                        <button class="btn btn-outline btn-small" onclick="removeProfilePhoto(${index})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        ${Array(availablePhotos).fill().map((_, i) => `
                            <div class="photo-item add-photo-btn" onclick="addProfilePhoto()">
                                <i class="fas fa-plus text-2xl"></i>
                                <span class="text-sm">Add Photo</span>
                            </div>
                        `).join('')}
                    </div>
                    ${availablePhotos === 0 && !state.isPro && !state.isProPlus ? `
                        <button class="btn btn-pro btn-block mt-4" onclick="navigateTo('pricing')">
                            <i class="fas fa-crown"></i> Upgrade for More Photos
                        </button>
                    ` : ''}
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${state.matches.length}</div>
                        <div class="stat-label">Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">89%</div>
                        <div class="stat-label">Response</div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <h3 class="mb-4">Account</h3>
                    <div class="flex flex-col gap-3">
                        <button class="btn btn-outline" onclick="navigateTo('settings')">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        ${!state.isPro && !state.isProPlus ? `
                            <button class="btn btn-pro" onclick="navigateTo('pricing')">
                                <i class="fas fa-crown"></i> Upgrade to Pro
                            </button>
                        ` : ''}
                        <button class="btn btn-outline" onclick="navigateTo('privacy-settings')">
                            <i class="fas fa-shield-alt"></i> Privacy & Safety
                        </button>
                        <button class="btn btn-outline" onclick="showHelp()">
                            <i class="fas fa-question-circle"></i> Help & Support
                        </button>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <button class="btn btn-outline btn-block text-red-400" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            `;
        }

        function renderEditProfilePage(container) {
            container.innerHTML = `
                <div class="edit-profile-container">
                    <h2 class="mb-6">Edit Profile</h2>
                    
                    <div class="card compact-card">
                        <div class="profile-photo-upload">
                            <div class="avatar" style="background-image: url('${state.userProfile.profilePhoto}');"></div>
                            <button class="upload-button" onclick="uploadProfilePhoto()">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        
                        <form id="editProfileForm" onsubmit="saveProfile(event)">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" value="${state.userProfile.name}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Age</label>
                                <input type="number" class="form-control" value="${state.userProfile.age}" min="18" max="100" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Occupation</label>
                                <input type="text" class="form-control" value="${state.userProfile.occupation}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Company</label>
                                <input type="text" class="form-control" value="${state.userProfile.company}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-control" rows="3" maxlength="200" id="bioTextarea">${state.userProfile.bio}</textarea>
                                <div class="text-right text-xs text-gray-400 mt-1" id="bioCounter">${state.userProfile.bio.length}/200</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Interests (add up to 5)</label>
                                <div class="flex flex-wrap gap-2 mb-3" id="interestsContainer">
                                    ${state.userProfile.interests.map(interest => `
                                        <span class="interest-tag">
                                            ${interest}
                                            <i class="fas fa-times ml-1 cursor-pointer" onclick="removeInterest('${interest}')"></i>
                                        </span>
                                    `).join('')}
                                </div>
                                <div class="flex gap-2">
                                    <input type="text" class="form-control flex-1" id="newInterest" placeholder="Add interest">
                                    <button type="button" class="btn btn-outline" onclick="addInterest()">Add</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Gender</label>
                                <select class="form-control" id="genderSelect">
                                    <option value="male" ${state.userProfile.gender === 'male' ? 'selected' : ''}>Male</option>
                                    <option value="female" ${state.userProfile.gender === 'female' ? 'selected' : ''}>Female</option>
                                    <option value="non-binary" ${state.userProfile.gender === 'non-binary' ? 'selected' : ''}>Non-binary</option>
                                    <option value="prefer-not-to-say" ${state.userProfile.gender === 'prefer-not-to-say' ? 'selected' : ''}>Prefer not to say</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" value="${state.userProfile.location}" placeholder="City, Country">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" value="${state.userProfile.phone}">
                            </div>
                            
                            <div class="card-glass mt-4 mb-6">
                                <h4 class="mb-3">Profile Visibility</h4>
                                <div class="privacy-option">
                                    <div class="privacy-info">
                                        <span>Who can see my profile</span>
                                        <small class="text-gray-400">Control who can view your profile</small>
                                    </div>
                                    <select class="form-control" style="width: auto;" id="visibilitySelect">
                                        <option value="public" ${state.userProfile.visibility === 'public' ? 'selected' : ''}>Public</option>
                                        <option value="event-only" ${state.userProfile.visibility === 'event-only' ? 'selected' : ''}>Event attendees only</option>
                                        <option value="matches-only" ${state.userProfile.visibility === 'matches-only' ? 'selected' : ''}>Matches only</option>
                                        <option value="private" ${state.userProfile.visibility === 'private' ? 'selected' : ''}>Private</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button type="button" class="btn btn-outline flex-1" onclick="goBack()">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary flex-1">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            // Add bio counter functionality
            const bioTextarea = document.getElementById('bioTextarea');
            if (bioTextarea) {
                bioTextarea.addEventListener('input', function(e) {
                    document.getElementById('bioCounter').textContent = e.target.value.length + '/200';
                });
            }
        }

        function renderCreateEventPage(container) {
            if (!state.isPro && !state.isProPlus) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-crown" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">Pro Feature Required</h3>
                        <p class="text-gray-400 mb-6">Upgrade to Pro to create events</p>
                        <button class="btn btn-pro" onclick="navigateTo('pricing')">
                            <i class="fas fa-crown"></i> Upgrade to Pro
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="create-form">
                    <h2 class="text-center mb-4">Create New Event</h2>
                    
                    <div class="card">
                        <form id="createEventForm" onsubmit="createEvent(event)">
                            <div class="form-group">
                                <label class="form-label">Event Name</label>
                                <input type="text" class="form-control" placeholder="Tech Meetup Afterparty" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" rows="3" placeholder="Describe your event..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location Name</label>
                                <input type="text" class="form-control" placeholder="Downtown Bar & Grill" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Event Date & Time</label>
                                <div class="flex gap-3">
                                    <input type="date" class="form-control flex-1" required>
                                    <input type="time" class="form-control flex-1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Event Duration (hours)</label>
                                <input type="number" class="form-control" min="1" max="24" value="4" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Max Attendees</label>
                                <input type="number" class="form-control" min="10" max="1000" value="50" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Age Range</label>
                                <div class="flex gap-3">
                                    <input type="number" class="form-control" placeholder="Min" min="18" max="100" value="18" required>
                                    <input type="number" class="form-control" placeholder="Max" min="18" max="100" value="45" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tags (comma separated)</label>
                                <input type="text" class="form-control" placeholder="Tech, Networking, Startup, AI">
                            </div>
                            
                            <div class="card-glass mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-location-dot text-gradient"></i>
                                    <div>
                                        <h4>Geo-fencing</h4>
                                        <p class="text-gray-400 text-sm">Enable location verification for check-ins</p>
                                    </div>
                                </div>
                                <label class="switch mt-3">
                                    <input type="checkbox" id="geoFencing" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            ${state.isProPlus ? `
                                <div class="card-glass mb-4">
                                    <h4 class="mb-3">Custom Event Branding (Pro Plus)</h4>
                                    <div class="customization-preview" id="themePreview" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED);">
                                        Your Event
                                    </div>
                                    <div class="color-picker">
                                        ${['#8B5CF6', '#EC4899', '#3B82F6', '#10B981', '#F59E0B'].map(color => `
                                            <div class="color-option" style="background: ${color};" onclick="selectThemeColor('${color}')"></div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-plus"></i> Create Event
                            </button>
                        </form>
                    </div>
                    
                    <div class="card mt-4" id="qrDisplay" style="display: none;">
                        <h3 class="text-center mb-3">Your Event QR Code</h3>
                        <div class="qr-code-display" id="qrCodeDisplay">
                            Loading QR...
                        </div>
                        <p class="text-center mt-3">Print and display this QR code at your event venue</p>
                        <div class="flex gap-3 mt-4">
                            <button class="btn btn-outline flex-1" onclick="printQR()">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="btn btn-primary flex-1" onclick="shareQR()">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPricingPage(container) {
            container.innerHTML = `
                <h2 class="text-center mb-2">Upgrade Your Experience</h2>
                <p class="text-center text-gray-400 mb-6">Choose the plan that's right for you</p>
                
                <div class="pricing-grid">
                    <div class="pricing-card">
                        <div class="free-badge mb-4">FREE</div>
                        <h3 class="text-center mb-2">$0/month</h3>
                        <p class="text-center text-gray-400 mb-4">Basic features to get started</p>
                        <div class="flex flex-col gap-3 mb-6">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Join unlimited events</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>25 likes/event/day</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>1 super like/week</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>3 profile photos</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-times text-gray-500"></i>
                                <span class="text-gray-400">Create events</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-times text-gray-500"></i>
                                <span class="text-gray-400">See who liked you</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-times text-gray-500"></i>
                                <span class="text-gray-400">Video calls</span>
                            </div>
                        </div>
                        <button class="btn btn-outline btn-block" onclick="notificationSystem.show('You\\'re already on Free plan', 'info')">
                            Current Plan
                        </button>
                    </div>
                    
                    <div class="pricing-card featured">
                        <div class="pro-badge mb-4">PRO</div>
                        <h3 class="text-center mb-2 pro-gradient">$14.99/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $99.99/year (save 44%)</p>
                        <div class="flex flex-col gap-3 mb-6">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Everything in Free</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>30 likes/event/day</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>5 super likes/day</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Create unlimited events</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>See who liked you</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>10 profile photos</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Video calls & read receipts</span>
                            </div>
                        </div>
                        <button class="btn btn-pro btn-block" onclick="upgradeToPro()">
                            <i class="fas fa-crown"></i> Upgrade to Pro
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="pro-plus-badge mb-4">PRO PLUS</div>
                        <h3 class="text-center mb-2 pro-plus-gradient">$49.99/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $399.99/year (save 33%)</p>
                        <div class="flex flex-col gap-3 mb-6">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Everything in Pro</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Unlimited likes</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Unlimited super likes</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Custom event branding</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Advanced analytics</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Unlimited profile photos</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>24/7 priority support</span>
                            </div>
                        </div>
                        <button class="btn btn-pro-plus btn-block" onclick="upgradeToProPlus()">
                            <i class="fas fa-star"></i> Upgrade to Pro Plus
                        </button>
                    </div>
                </div>
                
                <div class="card mt-6">
                    <h4 class="mb-4">Payment Methods</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="btn btn-outline" onclick="showPayment('paypal')">
                            <i class="fab fa-paypal"></i> PayPal
                        </button>
                        <button class="btn btn-outline" onclick="showPayment('card')">
                            <i class="fas fa-credit-card"></i> Card
                        </button>
                        <button class="btn btn-outline" onclick="showPayment('mobile')">
                            <i class="fas fa-mobile-alt"></i> Mobile Money
                        </button>
                        <button class="btn btn-outline" onclick="showPayment('bank')">
                            <i class="fas fa-university"></i> Bank Transfer
                        </button>
                    </div>
                    <p class="text-center text-xs text-gray-400 mt-4">
                        <i class="fas fa-lock"></i> All payments are secure and encrypted
                    </p>
                </div>
            `;
        }

        function renderChatPage(container) {
            const matchId = state.currentPage.split('-')[1];
            const match = state.matches.find(m => m.matchId === parseInt(matchId)) || MOCK_PROFILES.find(p => p.id === parseInt(matchId));
            
            if (!match) {
                navigateTo('matches');
                return;
            }
            
            const messages = state.chatMessages[matchId] || [];
            
            container.innerHTML = `
                <div class="chat-container">
                    <div class="chat-header">
                        <button class="back-btn" onclick="navigateTo('matches')">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="chat-avatar" style="background-image: url('${match.livePhoto || ''}');"></div>
                        <div style="flex: 1;">
                            <h3>${match.name || 'Unknown'}</h3>
                            <p class="text-sm text-gradient">Active now at ${state.currentEvent?.name || 'Event'}</p>
                        </div>
                        <div class="chat-options">
                            <button class="chat-option-btn" onclick="showChatOptions('${matchId}')">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <button class="chat-option-btn" onclick="startVideoCall('${matchId}')" ${!state.isPro && !state.isProPlus ? 'disabled' : ''}>
                                <i class="fas fa-video"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-messages scrollable-content" id="chatMessages">
                        ${messages.length > 0 ? messages.map(msg => `
                            <div class="message ${msg.sender === 'user' ? 'sent' : 'received'}">
                                ${msg.text}
                                <div class="message-time">
                                    ${msg.time}
                                    ${msg.sender === 'user' && state.isPro ? '<i class="fas fa-check ml-1"></i>' : ''}
                                    ${msg.sender === 'user' && state.isPro && msg.read ? '<i class="fas fa-check-double ml-1 text-primary"></i>' : ''}
                                </div>
                            </div>
                        `).join('') : `
                            <div class="message received">
                                Hey there! Saw you at the event 
                                <div class="message-time">2:30 PM</div>
                            </div>
                            <div class="message sent">
                                Hi! Yeah, it's been great so far!
                                <div class="message-time">2:31 PM</div>
                            </div>
                        `}
                    </div>
                    
                    <div class="chat-input">
                        <button class="btn btn-outline btn-icon" onclick="attachFile()">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <input type="text" id="messageInput" placeholder="Type a message..." class="form-control">
                        <button class="btn btn-primary btn-icon" onclick="sendMessage('${matchId}')">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add enter key support
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage(matchId);
                    }
                });
            }
            
            // Scroll to bottom
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }
        }

        function renderEventDetailPage(container) {
            const event = state.currentEvent;
            if (!event) {
                navigateTo('events');
                return;
            }
            
            const userPhotos = state.communityPhotos.filter(photo => photo.eventId === event.id);
            const canUpload = state.isPro || state.isProPlus;
            
            container.innerHTML = `
                <div class="event-detail">
                    <!-- Event Media Header -->
                    <div class="event-media-preview" style="height: 250px; border-radius: 0 0 24px 24px;">
                        ${event.mediaType === 'video' ? `
                            <video muted loop playsinline id="eventVideo">
                                <source src="${event.mediaUrl}" type="video/mp4">
                            </video>
                            <div class="media-play-overlay">
                                <button class="play-button" onclick="playEventVideo(${event.id})">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        ` : `
                            <img src="${event.coverImage}" alt="${event.name}">
                        `}
                    </div>
                    
                    <div class="card compact-card mb-4">
                        <div class="event-card-header">
                            <div>
                                <h2 class="mb-2">${event.name}</h2>
                                <p class="text-gradient">${event.category}</p>
                            </div>
                            <button class="bookmark-button ${event.bookmarked ? 'active' : ''}" onclick="toggleBookmark(${event.id})">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                        
                        <p class="text-gray-300 mb-6">${event.description}</p>
                        
                        <div class="compact-grid mb-6">
                            <div class="event-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${event.location}</span>
                            </div>
                            <div class="event-info">
                                <i class="fas fa-calendar"></i>
                                <span>${event.date}  ${event.time}</span>
                            </div>
                            <div class="event-info">
                                <i class="fas fa-users"></i>
                                <span>${event.attendees} / ${event.maxAttendees} attending</span>
                            </div>
                            ${event.geoFencing ? `
                                <div class="event-info">
                                    <i class="fas fa-location-dot"></i>
                                    <span class="location-badge">Geo-fenced event</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="mb-3">Tags</h4>
                            <div class="flex flex-wrap gap-2">
                                ${event.tags.map(tag => `
                                    <span class="px-3 py-1 bg-gray-800 rounded-full">${tag}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="rsvp-buttons">
                            <button class="rsvp-button ${event.rsvp === 'going' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'going')">
                                <i class="fas fa-check-circle"></i> Going
                            </button>
                            <button class="rsvp-button ${event.rsvp === 'maybe' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'maybe')">
                                <i class="fas fa-question-circle"></i> Maybe
                            </button>
                            <button class="rsvp-button ${event.rsvp === 'not-going' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'not-going')">
                                <i class="fas fa-times-circle"></i> Not Going
                            </button>
                        </div>
                    </div>
                    
                    <!-- Community Photo Dump -->
                    <div class="card compact-card mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3>Community Photos</h3>
                            <button class="btn btn-outline btn-small" onclick="openPhotoDumpModal(${event.id})">
                                View All
                            </button>
                        </div>
                        
                        <div class="photo-dump-grid">
                            ${userPhotos.slice(0, 4).map(photo => `
                                <div class="photo-item">
                                    <img src="${photo.url}" alt="Community photo">
                                    <div class="photo-overlay">
                                        <div class="photo-actions">
                                            <button class="btn btn-outline btn-small">
                                                <i class="fas fa-heart"></i> ${photo.likes}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${userPhotos.length < 4 ? `
                                <div class="photo-item add-photo-btn ${canUpload ? '' : 'locked'}" onclick="${canUpload ? 'uploadCommunityPhoto()' : 'showUpgradeModal()'}">
                                    <i class="fas fa-plus text-2xl"></i>
                                    <span class="text-sm">${canUpload ? 'Add Photo' : 'Upgrade to Add'}</span>
                                </div>
                            ` : ''}
                        </div>
                        ${!canUpload ? `
                            <p class="text-center text-gray-400 text-sm mt-3">Upgrade to Pro to add photos to the community dump</p>
                        ` : ''}
                    </div>
                    
                    <!-- Comments -->
                    <div class="card compact-card mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3>Comments (${state.currentEventComments.length})</h3>
                            <button class="btn btn-outline btn-small" onclick="openCommentSheet()">
                                <i class="fas fa-comment"></i> View All
                            </button>
                        </div>
                        
                        <div class="comment-list">
                            ${state.currentEventComments.slice(0, 2).map(comment => `
                                <div class="comment-item">
                                    <div class="comment-avatar" style="background-image: url('${comment.userAvatar}');"></div>
                                    <div class="comment-content">
                                        <div class="comment-author">${comment.userName}</div>
                                        <div class="comment-text">${comment.text}</div>
                                        <div class="comment-actions">
                                            <button class="comment-action">
                                                <i class="fas fa-heart"></i> ${comment.likes}
                                            </button>
                                            <button class="comment-action">
                                                <i class="fas fa-reply"></i> Reply
                                            </button>
                                            <span class="text-gray-400">${comment.timestamp}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="comment-input-area mt-4">
                            <textarea class="comment-input" placeholder="Add a comment..." id="quickCommentInput"></textarea>
                            <button class="post-comment-btn" onclick="postQuickComment()">Post</button>
                        </div>
                    </div>
                    
                    <!-- Event QR Code -->
                    <div class="card compact-card mb-4">
                        <h3 class="mb-4">Event QR Code</h3>
                        <p class="text-gray-400 mb-4">Scan this QR code to check in at the event</p>
                        <div class="qr-code-display">
                            ${event.qrCode}
                        </div>
                        ${event.geoFencing ? `
                            <div class="card-glass mt-4">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-location-dot text-gradient"></i>
                                    <p>This event uses geo-fencing. You must be at the event location to check in.</p>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Event Actions -->
                    <div class="card compact-card">
                        <h3 class="mb-4">Event Actions</h3>
                        <div class="flex flex-col gap-3">
                            <button class="btn btn-primary" onclick="checkInToEvent(${event.id})">
                                <i class="fas fa-qrcode"></i> Check In Now
                            </button>
                            <button class="btn btn-outline" onclick="shareEvent(${event.id})">
                                <i class="fas fa-share-alt"></i> Share Event
                            </button>
                            ${state.currentUser && state.currentUser.id === event.organizerId ? `
                                <button class="btn btn-outline" onclick="navigateTo('manage-event')">
                                    <i class="fas fa-chart-line"></i> Manage Event
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPrivacySettingsPage(container) {
            container.innerHTML = `
                <h2 class="mb-6">Privacy & Safety</h2>
                
                <div class="card compact-card">
                    <h3 class="mb-4">Profile Visibility</h3>
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Show my profile to</span>
                            <small class="text-gray-400">Control who can see your profile</small>
                        </div>
                        <select class="form-control" style="width: auto;" onchange="updatePrivacySetting('showProfile', this.value)">
                            <option value="public" ${state.privacySettings.showProfile === 'public' ? 'selected' : ''}>Everyone</option>
                            <option value="event-only" ${state.privacySettings.showProfile === 'event-only' ? 'selected' : ''}>Event attendees only</option>
                            <option value="matches-only" ${state.privacySettings.showProfile === 'matches-only' ? 'selected' : ''}>Matches only</option>
                            <option value="private" ${state.privacySettings.showProfile === 'private' ? 'selected' : ''}>Private</option>
                        </select>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Show online status</span>
                            <small class="text-gray-400">Display when you're active</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.showOnlineStatus ? 'checked' : ''} onchange="updatePrivacySetting('showOnlineStatus', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Show distance</span>
                            <small class="text-gray-400">Display approximate distance</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.showDistance ? 'checked' : ''} onchange="updatePrivacySetting('showDistance', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="card compact-card mt-4">
                    <h3 class="mb-4">Safety Features</h3>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Blocked Users</span>
                            <small class="text-gray-400">Manage blocked accounts</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="showBlockedUsers()">
                            Manage
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Report History</span>
                            <small class="text-gray-400">View your reports</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="showReportHistory()">
                            View
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Emergency Contacts</span>
                            <small class="text-gray-400">Set up emergency contacts</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="setupEmergencyContacts()">
                            Setup
                        </button>
                    </div>
                </div>
                
                <div class="card compact-card mt-4">
                    <h3 class="mb-4">Data & Privacy</h3>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Download My Data</span>
                            <small class="text-gray-400">Get a copy of your data</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="downloadData()">
                            Request
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Delete Account</span>
                            <small class="text-gray-400">Permanently delete your account</small>
                        </div>
                        <button class="btn btn-outline btn-small text-red-400" onclick="deleteAccount()">
                            Delete
                        </button>
                    </div>
                </div>
            `;
        }

        function renderProfileViewsPage(container) {
            if (!state.isPro && !state.isProPlus) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-crown" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">Pro Feature Required</h3>
                        <p class="text-gray-400 mb-6">Upgrade to Pro to see who viewed your profile</p>
                        <button class="btn btn-pro" onclick="navigateTo('pricing')">
                            <i class="fas fa-crown"></i> Upgrade to Pro
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h2 class="mb-4">Profile Views</h2>
                <p class="text-gray-400 mb-6">${state.userProfile.profileViews.length} people viewed your profile</p>
                
                ${state.userProfile.profileViews.length > 0 ? `
                    <div class="scrollable-content">
                        <div class="profile-views-list">
                            ${state.userProfile.profileViews.slice().reverse().map(view => `
                                <div class="profile-view-item">
                                    <div class="attendee-avatar" style="background-image: url('${view.photo}');"></div>
                                    <div class="attendee-info">
                                        <h4>${view.name}, ${view.age}</h4>
                                        <p class="text-gray-400 text-sm">${view.eventName}</p>
                                        <div class="view-time">${view.time}</div>
                                    </div>
                                    <div class="attendee-status ${view.online ? 'status-online' : 'status-away'}">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        <span>${view.online ? 'Online' : 'Away'}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : `
                    <div class="text-center py-12">
                        <i class="fas fa-eye" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No Views Yet</h3>
                        <p class="text-gray-400 mb-6">Start connecting at events to get more profile views</p>
                    </div>
                `}
                
                <div class="card mt-6">
                    <h4 class="mb-4">View Statistics</h4>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${state.userProfile.profileViews.length}</div>
                            <div class="stat-label">Total Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(state.userProfile.profileViews.length / 7)}</div>
                            <div class="stat-label">Weekly Avg</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${state.isProPlus ? '24%' : 'Pro+'}</div>
                            <div class="stat-label">Engagement Rate</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBookmarkedEventsPage(container) {
            const bookmarkedEvents = state.events.filter(event => state.bookmarkedEvents.includes(event.id));
            
            container.innerHTML = `
                <h2 class="mb-4">Bookmarked Events</h2>
                <p class="text-gray-400 mb-6">${bookmarkedEvents.length} events saved</p>
                
                ${bookmarkedEvents.length > 0 ? `
                    <div class="events-grid">
                        ${bookmarkedEvents.map(event => `
                            <div class="event-card compact-card no-clip" onclick="viewEvent(${event.id})" style="cursor: pointer;">
                                <div class="event-card-header">
                                    <div>
                                        <h3 class="mb-2">${event.name}</h3>
                                        <p class="text-gray-400 text-sm">
                                            <i class="fas fa-map-marker-alt"></i> ${event.location}
                                        </p>
                                    </div>
                                    <button class="bookmark-button active" onclick="toggleBookmark(${event.id}); event.stopPropagation()">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                </div>
                                
                                <p class="text-gray-300 mb-4">${event.description.substring(0, 100)}...</p>
                                
                                <div class="event-info">
                                    <i class="fas fa-calendar"></i>
                                    <span>${event.date}  ${event.time}</span>
                                </div>
                                <div class="event-info">
                                    <i class="fas fa-users"></i>
                                    <span>${event.attendees} attending</span>
                                </div>
                                
                                <div class="rsvp-buttons mt-4">
                                    <button class="rsvp-button ${event.rsvp === 'going' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'going'); event.stopPropagation()">
                                        Going
                                    </button>
                                    <button class="rsvp-button ${event.rsvp === 'maybe' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'maybe'); event.stopPropagation()">
                                        Maybe
                                    </button>
                                    <button class="rsvp-button ${event.rsvp === 'not-going' ? 'active' : ''}" onclick="updateRSVP(${event.id}, 'not-going'); event.stopPropagation()">
                                        Not Going
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div class="text-center py-12">
                        <i class="fas fa-bookmark" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No Bookmarked Events</h3>
                        <p class="text-gray-400 mb-6">Bookmark events to save them for later</p>
                        <button class="btn btn-primary" onclick="navigateTo('events')">
                            <i class="fas fa-calendar"></i> Browse Events
                        </button>
                    </div>
                `}
            `;
        }

        function renderAnalyticsPage(container) {
            if (!state.isPro && !state.isProPlus) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-chart-line" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">Pro Feature Required</h3>
                        <p class="text-gray-400 mb-6">Upgrade to Pro for detailed analytics</p>
                        <button class="btn btn-pro" onclick="navigateTo('pricing')">
                            <i class="fas fa-crown"></i> Upgrade to Pro
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h2 class="mb-4">Analytics Dashboard</h2>
                <p class="text-gray-400 mb-6">Your event and connection insights</p>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-value">${state.analytics.eventViews}</div>
                        <div class="analytics-label">Event Views</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">${state.analytics.profileViews}</div>
                        <div class="analytics-label">Profile Views</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">${state.analytics.matchRate}</div>
                        <div class="analytics-label">Match Rate</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">${state.analytics.responseRate}</div>
                        <div class="analytics-label">Response Rate</div>
                    </div>
                </div>
                
                <div class="card compact-card mt-6">
                    <h3 class="mb-4">Monthly Growth</h3>
                    <div class="analytics-chart">
                        ${[65, 80, 75, 90, 85, 95, 100].map(height => `
                            <div class="chart-bar" style="height: ${height}%"></div>
                        `).join('')}
                    </div>
                    <p class="text-center text-gray-400 mt-2">${state.analytics.monthlyGrowth} growth this month</p>
                </div>
                
                ${state.isProPlus ? `
                    <div class="card compact-card mt-6">
                        <h3 class="mb-4">Advanced Analytics</h3>
                        <div class="flex flex-col gap-4">
                            <div class="flex justify-between items-center">
                                <span>Peak Activity Hours</span>
                                <span class="text-gradient font-semibold">7-10 PM</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Top Event Category</span>
                                <span class="text-gradient font-semibold">Tech Networking</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Most Active Day</span>
                                <span class="text-gradient font-semibold">Friday</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Connection Quality Score</span>
                                <span class="pro-plus-gradient font-semibold">8.7/10</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card compact-card mt-6">
                        <h3 class="mb-4">Export Data</h3>
                        <div class="flex gap-3">
                            <button class="btn btn-outline flex-1" onclick="exportData('csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                            <button class="btn btn-outline flex-1" onclick="exportData('pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline flex-1" onclick="exportData('excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function renderNotificationsPage(container) {
            container.innerHTML = `
                <h2 class="mb-6">Notifications</h2>
                
                <div class="card compact-card">
                    <h3 class="mb-4">Notification Preferences</h3>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>New Matches</span>
                            <small class="text-gray-400">When someone likes you back</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.notifications.matches ? 'checked' : ''} onchange="updateNotificationSetting('matches', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Messages</span>
                            <small class="text-gray-400">When you receive new messages</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.notifications.messages ? 'checked' : ''} onchange="updateNotificationSetting('messages', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Event Updates</span>
                            <small class="text-gray-400">Updates from events you're attending</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.notifications.eventUpdates ? 'checked' : ''} onchange="updateNotificationSetting('eventUpdates', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Nearby Events</span>
                            <small class="text-gray-400">Events happening near you</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${state.privacySettings.notifications.nearbyEvents ? 'checked' : ''} onchange="updateNotificationSetting('nearbyEvents', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="card compact-card mt-6">
                    <h3 class="mb-4">Push Notifications</h3>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Enable Push Notifications</span>
                            <small class="text-gray-400">Receive notifications even when app is closed</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked onchange="togglePushNotifications(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Sound</span>
                            <small class="text-gray-400">Play sound for notifications</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked onchange="toggleNotificationSound(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-preference">
                        <div class="privacy-info">
                            <span>Vibration</span>
                            <small class="text-gray-400">Vibrate for notifications</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked onchange="toggleNotificationVibration(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="card compact-card mt-6">
                    <h3 class="mb-4">Quiet Hours</h3>
                    <p class="text-gray-400 mb-4">Mute notifications during specific hours</p>
                    
                    <div class="flex gap-3">
                        <div class="form-group flex-1">
                            <label class="form-label">From</label>
                            <input type="time" class="form-control" value="22:00">
                        </div>
                        <div class="form-group flex-1">
                            <label class="form-label">To</label>
                            <input type="time" class="form-control" value="08:00">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-block mt-4" onclick="saveQuietHours()">
                        Save Quiet Hours
                    </button>
                </div>
            `;
        }

        function renderSettingsPage(container) {
            container.innerHTML = `
                <h2 class="mb-6">Settings</h2>
                
                <div class="card compact-card">
                    <h3 class="mb-4">Account</h3>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Email</span>
                            <small class="text-gray-400">${state.userProfile.email}</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="changeEmail()">
                            Change
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Password</span>
                            <small class="text-gray-400"></small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="changePassword()">
                            Change
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Phone Number</span>
                            <small class="text-gray-400">${state.userProfile.phone}</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="changePhone()">
                            Edit
                        </button>
                    </div>
                </div>
                
                <div class="card compact-card mt-4">
                    <h3 class="mb-4">App Preferences</h3>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Language</span>
                            <small class="text-gray-400">English (US)</small>
                        </div>
                        <select class="form-control" style="width: auto;">
                            <option>English (US)</option>
                            <option>Spanish</option>
                            <option>French</option>
                            <option>German</option>
                        </select>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Theme</span>
                            <small class="text-gray-400">Dark mode</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked onchange="toggleTheme(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Auto-play videos</span>
                            <small class="text-gray-400">Play videos automatically</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked onchange="toggleAutoplay(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="card compact-card mt-4">
                    <h3 class="mb-4">About</h3>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Version</span>
                            <small class="text-gray-400">2.4.1</small>
                        </div>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Terms of Service</span>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="showTerms()">
                            View
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Privacy Policy</span>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="showPrivacyPolicy()">
                            View
                        </button>
                    </div>
                    
                    <div class="privacy-option">
                        <div class="privacy-info">
                            <span>Clear Cache</span>
                            <small class="text-gray-400">Clear app cache and data</small>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="clearCache()">
                            Clear
                        </button>
                    </div>
                </div>
            `;
        }

        function renderManageEventPage(container) {
            const event = state.events.find(e => e.organizerId === 1); // Demo user's event
            
            if (!event) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-calendar" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No Events to Manage</h3>
                        <p class="text-gray-400 mb-6">Create an event first to manage it</p>
                        <button class="btn btn-primary" onclick="navigateTo('create-event')">
                            <i class="fas fa-plus"></i> Create Event
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h2 class="mb-4">Manage Event</h2>
                
                <div class="card compact-card mb-4">
                    <h3 class="mb-4">${event.name}</h3>
                    
                    <div class="analytics-grid mb-6">
                        <div class="analytics-card">
                            <div class="analytics-value">${event.attendees}</div>
                            <div class="analytics-label">Attendees</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value">${Math.round((event.attendees / event.maxAttendees) * 100)}%</div>
                            <div class="analytics-label">Capacity</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value">24</div>
                            <div class="analytics-label">Check-ins</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value">8</div>
                            <div class="analytics-label">Matches</div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="mb-3">Event QR Code</h4>
                        <div class="qr-code-display" style="width: 150px; height: 150px; margin: 0 auto;">
                            ${event.qrCode}
                        </div>
                    </div>
                    
                    <div class="flex flex-col gap-3">
                        <button class="btn btn-primary" onclick="downloadAttendeeList()">
                            <i class="fas fa-download"></i> Download Attendee List
                        </button>
                        <button class="btn btn-outline" onclick="editEvent(${event.id})">
                            <i class="fas fa-edit"></i> Edit Event Details
                        </button>
                        ${state.isProPlus ? `
                            <button class="btn btn-outline" onclick="sendEventUpdate()">
                                <i class="fas fa-bell"></i> Send Update to Attendees
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                ${state.isProPlus ? `
                    <div class="card compact-card">
                        <h3 class="mb-4">Advanced Analytics (Pro Plus)</h3>
                        <div class="analytics-chart">
                            ${[30, 45, 60, 75, 90, 65, 80].map(height => `
                                <div class="chart-bar" style="height: ${height}%"></div>
                            `).join('')}
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <span>Peak Hour</span>
                                <span class="text-gradient font-semibold">8:00 PM</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span>Average Stay Duration</span>
                                <span class="text-gradient font-semibold">2.5 hours</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Engagement Score</span>
                                <span class="pro-plus-gradient font-semibold">8.2/10</span>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                <div class="card compact-card">
                    <h3 class="mb-4">Recent Check-ins</h3>
                    <div class="attendee-list">
                        ${MOCK_PROFILES.slice(0, 3).map(profile => `
                            <div class="attendee-item">
                                <div class="attendee-avatar" style="background-image: url('${profile.livePhoto}');"></div>
                                <div class="attendee-info">
                                    <h4>${profile.name}, ${profile.age}</h4>
                                    <p class="text-gray-400 text-sm">Checked in 30 mins ago</p>
                                </div>
                                <div class="attendee-status status-online">
                                    <i class="fas fa-circle" style="font-size: 8px;"></i>
                                    <span>Checked in</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ===== EVENT HANDLERS =====
        function switchAuthTab(tab) {
            console.log('Switching auth tab to:', tab);
            const loginTab = document.getElementById('loginTab');
            const signupTab = document.getElementById('signupTab');
            const signupFields = document.getElementById('signupFields');
            const authSubmit = document.getElementById('authSubmit');
            
            if (loginTab && signupTab) {
                loginTab.classList.toggle('active', tab === 'login');
                signupTab.classList.toggle('active', tab === 'signup');
            }
            
            if (signupFields) {
                signupFields.classList.toggle('hidden', tab === 'login');
            }
            
            if (authSubmit) {
                authSubmit.innerHTML = tab === 'login' ? 
                    '<i class="fas fa-sign-in-alt"></i> Sign In' : 
                    '<i class="fas fa-user-plus"></i> Create Account';
            }
        }

        function handleAuth(event) {
            event.preventDefault();
            console.log('Handling auth');
            
            const form = event.target;
            const email = form.querySelector('#authEmail').value;
            const password = form.querySelector('#authPassword').value;
            
            const isSignup = document.getElementById('signupFields')?.classList.contains('hidden') === false;
            
            // Create user object
            state.currentUser = {
                id: 'user_' + Date.now(),
                name: isSignup ? document.getElementById('authName')?.value || email.split('@')[0] : email.split('@')[0],
                email: email,
                isPro: false,
                isProPlus: false
            };
            
            // Update user profile if signing up
            if (isSignup) {
                const age = document.getElementById('authAge')?.value;
                const phone = document.getElementById('authPhone')?.value;
                const name = document.getElementById('authName')?.value;
                
                if (age) state.userProfile.age = parseInt(age);
                if (phone) state.userProfile.phone = phone;
                if (name) state.userProfile.name = name;
                if (email) state.userProfile.email = email;
            }
            
            // Save to localStorage
            localStorage.setItem('amps_user', JSON.stringify(state.currentUser));
            localStorage.setItem('amps_isPro', state.isPro);
            localStorage.setItem('amps_isProPlus', state.isProPlus);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            notificationSystem.show('Welcome to Amps! ', 'success');
            setTimeout(() => navigateTo('dashboard'), 1000);
        }

        function enterDemoMode() {
            console.log('Entering demo mode');
            state.currentUser = {
                id: 'demo_user',
                name: 'Demo User',
                email: 'demo@amps.com',
                isPro: false,
                isProPlus: false
            };
            
            state.isPro = false;
            state.isProPlus = false;
            state.demoMode = true;
            
            // Save to localStorage
            localStorage.setItem('amps_user', JSON.stringify(state.currentUser));
            localStorage.setItem('amps_isPro', state.isPro);
            localStorage.setItem('amps_isProPlus', state.isProPlus);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            localStorage.setItem('amps_demoMode', true);
            
            // Show demo banner
            document.getElementById('demoBanner').classList.remove('hidden');
            document.getElementById('demoExitBtn').classList.remove('hidden');
            
            notificationSystem.show('Welcome to Amps Demo! ', 'success');
            navigateTo('dashboard');
        }

        function exitDemo() {
            console.log('Exiting demo');
            state.currentUser = null;
            state.isPro = false;
            state.isProPlus = false;
            state.demoMode = false;
            state.swipeCount = 0;
            state.matches = [];
            state.chatMessages = MOCK_CHAT_MESSAGES;
            
            // Clear localStorage
            localStorage.removeItem('amps_user');
            localStorage.removeItem('amps_isPro');
            localStorage.removeItem('amps_isProPlus');
            localStorage.removeItem('amps_swipeCount');
            localStorage.removeItem('amps_matches');
            localStorage.removeItem('amps_chatMessages');
            localStorage.removeItem('amps_demoMode');
            
            // Hide demo banner
            document.getElementById('demoBanner').classList.add('hidden');
            document.getElementById('demoExitBtn').classList.add('hidden');
            
            notificationSystem.show('Demo mode exited', 'info');
            navigateTo('home');
        }

        function logout() {
            console.log('Logging out');
            state.currentUser = null;
            state.isPro = false;
            state.isProPlus = false;
            state.swipeCount = 0;
            state.matches = [];
            state.chatMessages = MOCK_CHAT_MESSAGES;
            state.demoMode = false;
            
            // Clear localStorage
            localStorage.removeItem('amps_user');
            localStorage.removeItem('amps_isPro');
            localStorage.removeItem('amps_isProPlus');
            localStorage.removeItem('amps_swipeCount');
            localStorage.removeItem('amps_matches');
            localStorage.removeItem('amps_chatMessages');
            localStorage.removeItem('amps_demoMode');
            
            // Hide demo banner
            document.getElementById('demoBanner').classList.add('hidden');
            document.getElementById('demoExitBtn').classList.add('hidden');
            
            notificationSystem.show('Successfully signed out', 'info');
            navigateTo('home');
        }

        function joinEvent(eventId) {
            if (!state.currentUser) {
                navigateTo('auth');
                return;
            }
            
            const event = eventId ? state.events.find(e => e.id === eventId) : state.currentEvent;
            if (event) {
                state.currentEvent = event;
                notificationSystem.show(`Joining ${event.name}... `, 'success');
                
                state.currentProfileIndex = 0;
                state.swipeHistory = [];
                
                setTimeout(() => {
                    navigateTo('swipe');
                }, 1000);
            }
        }

        function viewEvent(eventId) {
            console.log('Viewing event:', eventId);
            const event = state.events.find(e => e.id === eventId);
            if (event) {
                state.currentEvent = event;
                navigateTo('event-detail');
            }
        }

        async function startCameraScanning() {
            console.log('Starting camera scanning');
            notificationSystem.show('Starting camera... Please allow camera access', 'info');
            
            try {
                // Check if browser supports mediaDevices
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Camera not supported');
                }
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                state.cameraStream = stream;
                const scannerView = document.getElementById('qrScanner');
                if (scannerView) {
                    scannerView.innerHTML = `
                        <video style="width: 100%; height: 100%; object-fit: cover;" autoplay playsinline></video>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; border: 2px solid var(--primary); border-radius: var(--radius);"></div>
                    `;
                    
                    const video = scannerView.querySelector('video');
                    video.srcObject = stream;
                    
                    // Simulate QR scan after 2 seconds
                    setTimeout(() => {
                        notificationSystem.show('QR Code scanned successfully!', 'success');
                        stopCamera();
                        
                        setTimeout(() => openCameraForSelfie(), 1000);
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Camera error:', error);
                notificationSystem.show('Camera access denied. Please enable camera permissions.', 'error');
                setTimeout(() => {
                    notificationSystem.show('Simulating QR scan for demo...', 'info');
                    setTimeout(() => openCameraForSelfie(), 1000);
                }, 2000);
            }
        }

        function stopCamera() {
            if (state.cameraStream) {
                state.cameraStream.getTracks().forEach(track => track.stop());
                state.cameraStream = null;
            }
        }

        async function openCameraForSelfie() {
            console.log('Opening camera for selfie');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: state.facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                state.cameraStream = stream;
                const cameraModal = document.getElementById('cameraModal');
                const video = document.getElementById('cameraVideo');
                
                if (video) {
                    video.srcObject = stream;
                }
                
                if (cameraModal) {
                    cameraModal.style.display = 'flex';
                }
                
                // Request location for verification
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            console.log('Location captured:', position.coords);
                        },
                        error => {
                            notificationSystem.show('Location access required for verification', 'warning');
                        }
                    );
                }
                
            } catch (error) {
                console.error('Camera error:', error);
                notificationSystem.show('Camera access denied. Please enable camera permissions.', 'error');
            }
        }

        function closeCamera() {
            console.log('Closing camera');
            stopCamera();
            const cameraModal = document.getElementById('cameraModal');
            if (cameraModal) {
                cameraModal.style.display = 'none';
            }
        }

        function switchCamera() {
            console.log('Switching camera');
            state.facingMode = state.facingMode === 'user' ? 'environment' : 'user';
            closeCamera();
            setTimeout(() => openCameraForSelfie(), 100);
        }

        function takePhoto() {
            console.log('Taking photo');
            const video = document.getElementById('cameraVideo');
            if (!video) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const photoData = canvas.toDataURL('image/jpeg', 0.8);
            state.userLivePhoto = photoData;
            
            verifyLocationAndProceed(photoData);
        }

        function verifyLocationAndProceed(photoData) {
            console.log('Verifying location');
            notificationSystem.show('Verifying your location...', 'info');
            
            setTimeout(() => {
                closeCamera();
                
                // Ask for public/private preference
                const modal = document.createElement('div');
                modal.className = 'pro-modal';
                modal.style.cssText = `
                    position: fixed;
                    inset: 0;
                    background: rgba(0, 0, 0, 0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                    backdrop-filter: blur(10px);
                `;
                
                modal.innerHTML = `
                    <div class="pro-content">
                        <h2 class="text-center mb-4">Make Your Profile Public?</h2>
                        <p class="text-center text-gray-400 mb-6">Choose how you want to appear to others at the event</p>
                        
                        <div class="flex flex-col gap-3 mb-6">
                            <button class="btn btn-primary" onclick="setProfileVisibility('public', ${JSON.stringify(photoData).replace(/"/g, '&quot;')}); this.closest('.pro-modal').remove()">
                                <i class="fas fa-globe"></i> Public - Show my photo
                            </button>
                            <button class="btn btn-outline" onclick="setProfileVisibility('private', ${JSON.stringify(photoData).replace(/"/g, '&quot;')}); this.closest('.pro-modal').remove()">
                                <i class="fas fa-lock"></i> Private - Hide my photo
                            </button>
                        </div>
                        
                        <p class="text-xs text-gray-400 text-center">
                            Public profiles get more matches. Private profiles are only visible to event organizers.
                        </p>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            }, 1500);
        }

        function setProfileVisibility(visibility, photoData) {
            console.log('Setting profile visibility:', visibility);
            
            if (visibility === 'public') {
                notificationSystem.show('Your profile is now public!', 'success');
            } else {
                notificationSystem.show('Your profile is private. Organizers can still see you checked in.', 'info');
            }
            
            setTimeout(() => {
                notificationSystem.show('Verified! Welcome to the event.', 'success');
                
                setTimeout(() => navigateTo('swipe'), 1000);
            }, 1000);
        }

        // ===== SWIPE FUNCTIONALITY =====
        function initializeSwipeGestures() {
            console.log('Initializing swipe gestures');
            const availableProfiles = MOCK_PROFILES.filter(p => 
                !state.swipeHistory.some(s => s.profile.id === p.id)
            );
            
            if (availableProfiles.length === 0) return;
            
            const currentProfile = availableProfiles[0];
            const card = document.getElementById(`profileCard${currentProfile.id}`);
            if (!card) return;
            
            let startX, startY, moveX, moveY;
            
            // Touch events
            card.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            }, { passive: true });
            
            card.addEventListener('touchmove', e => {
                if (!startX || !startY) return;
                
                moveX = e.touches[0].clientX;
                moveY = e.touches[0].clientY;
                
                const diffX = moveX - startX;
                const diffY = moveY - startY;
                
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    e.preventDefault();
                    card.style.transform = `translateX(${diffX}px) rotate(${diffX * 0.1}deg)`;
                    card.style.opacity = 1 - Math.abs(diffX) / 300;
                    
                    // Show swipe overlays
                    const likeOverlay = card.querySelector('.swipe-overlay.like');
                    const nopeOverlay = card.querySelector('.swipe-overlay.nope');
                    const superOverlay = card.querySelector('.swipe-overlay.super');
                    
                    if (diffX > 100) {
                        if (likeOverlay) likeOverlay.style.opacity = '1';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    } else if (diffX < -100) {
                        if (nopeOverlay) nopeOverlay.style.opacity = '1';
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    } else if (diffY < -100) {
                        if (superOverlay) superOverlay.style.opacity = '1';
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                    } else {
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    }
                }
            }, { passive: false });
            
            card.addEventListener('touchend', () => {
                if (!startX || !moveX) return;
                
                const diffX = moveX - startX;
                const diffY = moveY - startY;
                const threshold = 100;
                
                // Hide all overlays
                const overlays = card.querySelectorAll('.swipe-overlay');
                overlays.forEach(o => o.style.opacity = '0');
                
                if (Math.abs(diffX) > threshold) {
                    if (diffX > 0) {
                        swipeRight();
                    } else {
                        swipeLeft();
                    }
                } else if (diffY < -threshold) {
                    superLike();
                } else {
                    card.style.transform = '';
                    card.style.opacity = '';
                }
                
                startX = startY = moveX = moveY = null;
            });
            
            // Mouse events for desktop
            card.addEventListener('mousedown', e => {
                startX = e.clientX;
                startY = e.clientY;
                card.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', e => {
                if (!startX || !startY) return;
                
                moveX = e.clientX;
                moveY = e.clientY;
                const diffX = moveX - startX;
                const diffY = moveY - startY;
                
                if (Math.abs(diffX) > 10) {
                    card.style.transform = `translateX(${diffX}px) rotate(${diffX * 0.1}deg)`;
                    card.style.opacity = 1 - Math.abs(diffX) / 300;
                    
                    // Show swipe overlays
                    const likeOverlay = card.querySelector('.swipe-overlay.like');
                    const nopeOverlay = card.querySelector('.swipe-overlay.nope');
                    const superOverlay = card.querySelector('.swipe-overlay.super');
                    
                    if (diffX > 100) {
                        if (likeOverlay) likeOverlay.style.opacity = '1';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    } else if (diffX < -100) {
                        if (nopeOverlay) nopeOverlay.style.opacity = '1';
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    } else if (diffY < -100) {
                        if (superOverlay) superOverlay.style.opacity = '1';
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                    } else {
                        if (likeOverlay) likeOverlay.style.opacity = '0';
                        if (nopeOverlay) nopeOverlay.style.opacity = '0';
                        if (superOverlay) superOverlay.style.opacity = '0';
                    }
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (!startX || !moveX) return;
                
                const diffX = moveX - startX;
                const diffY = moveY - startY;
                const threshold = 100;
                
                // Hide all overlays
                const overlays = card.querySelectorAll('.swipe-overlay');
                overlays.forEach(o => o.style.opacity = '0');
                
                if (Math.abs(diffX) > threshold) {
                    if (diffX > 0) {
                        swipeRight();
                    } else {
                        swipeLeft();
                    }
                } else if (diffY < -threshold) {
                    superLike();
                } else {
                    card.style.transform = '';
                    card.style.opacity = '';
                }
                
                startX = startY = moveX = moveY = null;
                card.style.cursor = 'grab';
            });
        }

        function swipeLeft() {
            console.log('Swiping left');
            
            // Check swipe limits based on plan
            if (!state.isPro && !state.isProPlus) {
                if (state.swipeCount >= state.dailyLikes) {
                    notificationSystem.show('Daily swipe limit reached. Upgrade for unlimited swipes!', 'warning');
                    navigateTo('pricing');
                    return;
                }
                
                // Check monthly limit for free users
                if (state.monthlySwipes >= 120) {
                    notificationSystem.show('Monthly swipe limit reached. Upgrade for more!', 'warning');
                    navigateTo('pricing');
                    return;
                }
            }
            
            const availableProfiles = MOCK_PROFILES.filter(p => 
                !state.swipeHistory.some(s => s.profile.id === p.id)
            );
            
            if (availableProfiles.length === 0) return;
            
            const profile = availableProfiles[0];
            state.swipeHistory.push({ profile, action: 'reject' });
            state.swipeCount++;
            state.monthlySwipes++;
            
            // Add profile view
            addProfileView(profile);
            
            notificationSystem.show(`Passed on ${profile.name}`);
            
            localStorage.setItem('amps_swipeCount', state.swipeCount);
            localStorage.setItem('amps_monthlySwipes', state.monthlySwipes);
            localStorage.setItem('amps_swipeHistory', JSON.stringify(state.swipeHistory));
            
            setTimeout(() => renderSwipePage(document.getElementById('content')), 300);
        }

        function swipeRight() {
            console.log('Swiping right');
            
            // Check swipe limits based on plan
            if (!state.isPro && !state.isProPlus) {
                if (state.swipeCount >= state.dailyLikes) {
                    notificationSystem.show('Daily swipe limit reached. Upgrade for unlimited swipes!', 'warning');
                    navigateTo('pricing');
                    return;
                }
                
                // Check monthly limit for free users
                if (state.monthlySwipes >= 120) {
                    notificationSystem.show('Monthly swipe limit reached. Upgrade for more!', 'warning');
                    navigateTo('pricing');
                    return;
                }
            }
            
            const availableProfiles = MOCK_PROFILES.filter(p => 
                !state.swipeHistory.some(s => s.profile.id === p.id)
            );
            
            if (availableProfiles.length === 0) return;
            
            const profile = availableProfiles[0];
            state.swipeHistory.push({ profile, action: 'like' });
            state.swipeCount++;
            state.monthlySwipes++;
            
            // Add profile view
            addProfileView(profile);
            
            // Match chance based on plan
            let matchChance = 0.4; // 40% base chance
            
            if (state.isPro) matchChance = 0.5; // 50% for Pro
            if (state.isProPlus) matchChance = 0.6; // 60% for Pro Plus
            
            if (Math.random() < matchChance) {
                const match = {
                    id: Date.now(),
                    userId: state.currentUser?.id,
                    matchId: profile.id,
                    timestamp: new Date().toISOString(),
                    eventId: state.currentEvent?.id,
                    lastMessage: 'You matched! Say hi!',
                    lastMessageTime: 'Just now',
                    unread: true,
                    user: profile
                };
                state.matches.push(match);
                state.lastMatch = profile;
                setTimeout(() => showMatchModal(), 400);
                notificationSystem.show(`It's a match with ${profile.name}! `, 'success');
            } else {
                notificationSystem.show(`Liked ${profile.name} `);
            }
            
            localStorage.setItem('amps_swipeCount', state.swipeCount);
            localStorage.setItem('amps_monthlySwipes', state.monthlySwipes);
            localStorage.setItem('amps_swipeHistory', JSON.stringify(state.swipeHistory));
            localStorage.setItem('amps_matches', JSON.stringify(state.matches));
            
            setTimeout(() => renderSwipePage(document.getElementById('content')), 300);
        }

        function superLike() {
            console.log('Super liking');
            
            // Check super like limits
            if (!state.isPro && !state.isProPlus && state.superLikes <= 0) {
                notificationSystem.show('No super likes remaining. Upgrade for more!', 'warning');
                navigateTo('pricing');
                return;
            }
            
            // Check swipe limits for free users
            if (!state.isPro && !state.isProPlus && state.swipeCount >= state.dailyLikes) {
                notificationSystem.show('Daily swipe limit reached. Upgrade for unlimited swipes!', 'warning');
                navigateTo('pricing');
                return;
            }
            
            const availableProfiles = MOCK_PROFILES.filter(p => 
                !state.swipeHistory.some(s => s.profile.id === p.id)
            );
            
            if (availableProfiles.length === 0) return;
            
            const profile = availableProfiles[0];
            state.swipeHistory.push({ profile, action: 'super' });
            state.swipeCount++;
            state.monthlySwipes++;
            
            if (!state.isPro && !state.isProPlus) {
                state.superLikes--;
            }
            
            // Add profile view
            addProfileView(profile);
            
            // Super like has higher match chance
            let matchChance = 0.7; // 70% base chance for super like
            
            if (state.isPro) matchChance = 0.8; // 80% for Pro
            if (state.isProPlus) matchChance = 0.9; // 90% for Pro Plus
            
            if (Math.random() < matchChance) {
                const match = {
                    id: Date.now(),
                    userId: state.currentUser?.id,
                    matchId: profile.id,
                    timestamp: new Date().toISOString(),
                    eventId: state.currentEvent?.id,
                    lastMessage: 'You super liked each other! ',
                    lastMessageTime: 'Just now',
                    unread: true,
                    user: profile
                };
                state.matches.push(match);
                state.lastMatch = profile;
                setTimeout(() => showMatchModal(), 400);
                notificationSystem.show(`Super match with ${profile.name}! `, 'success');
            } else {
                notificationSystem.show(`Super liked ${profile.name} `);
            }
            
            localStorage.setItem('amps_swipeCount', state.swipeCount);
            localStorage.setItem('amps_monthlySwipes', state.monthlySwipes);
            localStorage.setItem('amps_swipeHistory', JSON.stringify(state.swipeHistory));
            localStorage.setItem('amps_matches', JSON.stringify(state.matches));
            localStorage.setItem('amps_superLikes', state.superLikes);
            
            setTimeout(() => renderSwipePage(document.getElementById('content')), 300);
        }

        function undoSwipe() {
            console.log('Undoing swipe');
            if (state.swipeHistory.length === 0) return;
            
            // Check rewind limits
            if (!state.isPro && !state.isProPlus && state.rewindCount <= 0) {
                notificationSystem.show('No rewinds remaining. Upgrade for unlimited rewinds.', 'warning');
                return;
            }
            
            state.swipeHistory.pop();
            state.swipeCount = Math.max(0, state.swipeCount - 1);
            state.monthlySwipes = Math.max(0, state.monthlySwipes - 1);
            
            if (!state.isPro && !state.isProPlus) {
                state.rewindCount--;
            }
            
            notificationSystem.show('Undid last swipe', 'info');
            
            localStorage.setItem('amps_swipeCount', state.swipeCount);
            localStorage.setItem('amps_monthlySwipes', state.monthlySwipes);
            localStorage.setItem('amps_swipeHistory', JSON.stringify(state.swipeHistory));
            localStorage.setItem('amps_rewindCount', state.rewindCount);
            
            renderSwipePage(document.getElementById('content'));
        }

        function resetSwipes() {
            console.log('Resetting swipes');
            state.currentProfileIndex = 0;
            state.swipeHistory = [];
            renderSwipePage(document.getElementById('content'));
        }

        function showMatchModal() {
            console.log('Showing match modal');
            const modal = document.getElementById('matchModal');
            const matchAvatar = document.getElementById('matchAvatar');
            const userAvatar = document.getElementById('userAvatar');
            const matchMessage = document.getElementById('matchMessage');
            
            if (modal && state.lastMatch) {
                if (matchAvatar) matchAvatar.style.backgroundImage = `url('${state.lastMatch.livePhoto}')`;
                if (userAvatar) userAvatar.style.backgroundImage = `url('${state.userProfile.profilePhoto}')`;
                if (matchMessage) matchMessage.textContent = `You and ${state.lastMatch.name} liked each other`;
                modal.style.display = 'flex';
                createConfetti();
            }
        }

        function closeMatchModal() {
            console.log('Closing match modal');
            const modal = document.getElementById('matchModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function startChat() {
            console.log('Starting chat');
            closeMatchModal();
            if (state.lastMatch) {
                const matchId = state.lastMatch.id;
                navigateTo('chat-' + matchId);
            }
        }

        function openChat(matchId) {
            console.log('Opening chat with:', matchId);
            navigateTo('chat-' + matchId);
        }

        function sendMessage(matchId) {
            console.log('Sending message to:', matchId);
            const input = document.getElementById('messageInput');
            if (!input) return;
            
            const message = input.value.trim();
            
            if (message) {
                if (!state.chatMessages[matchId]) {
                    state.chatMessages[matchId] = [];
                }
                
                const now = new Date();
                const time = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                state.chatMessages[matchId].push({
                    text: message,
                    time: time,
                    sender: 'user',
                    read: false
                });
                
                localStorage.setItem('amps_chatMessages', JSON.stringify(state.chatMessages));
                
                input.value = '';
                renderChatPage(document.getElementById('content'));
                
                // Scroll to bottom
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                }
                
                // Simulate reply after 1-2 seconds
                setTimeout(() => {
                    const replies = [
                        'Sounds good!',
                        'Meet by the bar?',
                        'On my way!',
                        'Love that idea!',
                        'See you there! ',
                        'That\'s awesome!',
                        'Can\'t wait!',
                        'Perfect! '
                    ];
                    const reply = replies[Math.floor(Math.random() * replies.length)];
                    
                    state.chatMessages[matchId].push({
                        text: reply,
                        time: 'Just now',
                        sender: 'match',
                        read: true
                    });
                    
                    localStorage.setItem('amps_chatMessages', JSON.stringify(state.chatMessages));
                    renderChatPage(document.getElementById('content'));
                    
                    const updatedChatMessages = document.getElementById('chatMessages');
                    if (updatedChatMessages) {
                        setTimeout(() => {
                            updatedChatMessages.scrollTop = updatedChatMessages.scrollHeight;
                        }, 100);
                    }
                }, 1000 + Math.random() * 1000);
            }
        }

        // ===== PROFILE MANAGEMENT =====
        function saveProfile(event) {
            event.preventDefault();
            console.log('Saving profile');
            
            const form = event.target;
            const inputs = form.querySelectorAll('input, textarea, select');
            
            state.userProfile.name = form.querySelector('input[type="text"]').value;
            state.userProfile.age = parseInt(form.querySelector('input[type="number"]').value);
            state.userProfile.occupation = form.querySelectorAll('input[type="text"]')[1].value;
            state.userProfile.company = form.querySelectorAll('input[type="text"]')[2].value;
            state.userProfile.bio = document.getElementById('bioTextarea')?.value || state.userProfile.bio;
            state.userProfile.gender = document.getElementById('genderSelect')?.value || state.userProfile.gender;
            state.userProfile.location = form.querySelectorAll('input[type="text"]')[3]?.value || state.userProfile.location;
            state.userProfile.phone = form.querySelectorAll('input[type="text"]')[4]?.value || state.userProfile.phone;
            state.userProfile.visibility = document.getElementById('visibilitySelect')?.value || state.userProfile.visibility;
            
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            notificationSystem.show('Profile updated successfully!', 'success');
            setTimeout(() => navigateTo('profile'), 1000);
        }

        function addInterest() {
            console.log('Adding interest');
            const input = document.getElementById('newInterest');
            if (!input) return;
            
            const interest = input.value.trim();
            
            if (interest && state.userProfile.interests.length < 5) {
                state.userProfile.interests.push(interest);
                renderEditProfilePage(document.getElementById('content'));
                input.value = '';
            }
        }

        function removeInterest(interest) {
            console.log('Removing interest:', interest);
            state.userProfile.interests = state.userProfile.interests.filter(i => i !== interest);
            renderEditProfilePage(document.getElementById('content'));
        }

        function uploadProfilePhoto() {
            console.log('Uploading profile photo');
            notificationSystem.show('Photo upload coming soon! For now, use camera for live verification at events.', 'info');
        }

        function changeProfilePhoto() {
            uploadProfilePhoto();
        }

        function addProfilePhoto() {
            console.log('Adding profile photo');
            
            // Check photo limit
            if (state.userProfile.profilePhotos.length >= state.userProfile.maxPhotos) {
                if (!state.isPro && !state.isProPlus) {
                    notificationSystem.show('Photo limit reached. Upgrade to Pro for more photos!', 'warning');
                    navigateTo('pricing');
                    return;
                }
            }
            
            // Simulate photo upload
            const mockPhoto = `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23${Math.floor(Math.random()*16777215).toString(16)}"/><text x="100" y="120" font-size="24" text-anchor="middle" fill="white">Photo ${state.userProfile.profilePhotos.length + 1}</text></svg>`;
            
            state.userProfile.profilePhotos.push(mockPhoto);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            notificationSystem.show('Profile photo added!', 'success');
            renderProfilePage(document.getElementById('content'));
        }

        function removeProfilePhoto(index) {
            console.log('Removing profile photo:', index);
            state.userProfile.profilePhotos.splice(index, 1);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            notificationSystem.show('Profile photo removed', 'info');
            renderProfilePage(document.getElementById('content'));
        }

        // ===== EVENT MANAGEMENT =====
        function createEvent(event) {
            event.preventDefault();
            console.log('Creating event');
            
            const form = event.target;
            const eventName = form.querySelector('input[type="text"]').value;
            const description = form.querySelector('textarea').value;
            const location = form.querySelectorAll('input[type="text"]')[1].value;
            const date = form.querySelector('input[type="date"]').value;
            const time = form.querySelector('input[type="time"]').value;
            const duration = form.querySelector('input[type="number"]').value;
            const maxAttendees = form.querySelectorAll('input[type="number"]')[1].value;
            const ageMin = form.querySelectorAll('input[type="number"]')[2].value;
            const ageMax = form.querySelectorAll('input[type="number"]')[3].value;
            const tags = form.querySelectorAll('input[type="text"]')[2].value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const geoFencing = document.getElementById('geoFencing')?.checked || false;
            
            const newEvent = {
                id: state.events.length + 1,
                name: eventName,
                description: description,
                location: location,
                date: new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' }),
                time: `${time} - ${calculateEndTime(time, duration)}`,
                attendees: 0,
                maxAttendees: parseInt(maxAttendees),
                qrCode: 'AMPS_' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                radius: geoFencing ? 100 : 0,
                organizerId: state.currentUser?.id || 1,
                coordinates: { lat: 37.7749, lng: -122.4194 },
                ageRange: `${ageMin}-${ageMax}`,
                genderPreference: 'Everyone',
                tags: tags,
                bookmarked: false,
                rsvp: 'none',
                geoFencing: geoFencing,
                customTheme: state.isProPlus ? document.querySelector('.color-option.active')?.style.backgroundColor || '#8B5CF6' : null,
                type: 'active',
                mediaType: 'image',
                mediaUrl: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=300&fit=crop',
                promoted: false,
                maxUserOwned: state.isProPlus,
                organizerType: state.isProPlus ? 'max' : 'pro'
            };
            
            state.events.push(newEvent);
            
            notificationSystem.show(`Event "${eventName}" created successfully!`, 'success');
            
            setTimeout(() => {
                const qrDisplay = document.getElementById('qrDisplay');
                const qrCodeDisplay = document.getElementById('qrCodeDisplay');
                
                if (qrDisplay && qrCodeDisplay) {
                    qrDisplay.style.display = 'block';
                    qrCodeDisplay.textContent = newEvent.qrCode;
                    qrCodeDisplay.style.background = newEvent.customTheme ? newEvent.customTheme : 'white';
                    qrCodeDisplay.style.color = newEvent.customTheme ? 'white' : 'black';
                    
                    qrDisplay.scrollIntoView({ behavior: 'smooth' });
                }
            }, 500);
        }

        function calculateEndTime(startTime, duration) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const endHours = hours + parseInt(duration);
            return `${endHours % 24}:${minutes.toString().padStart(2, '0')}`;
        }

        function selectThemeColor(color) {
            console.log('Selecting theme color:', color);
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            
            const preview = document.getElementById('themePreview');
            if (preview) {
                preview.style.background = `linear-gradient(135deg, ${color}, ${darkenColor(color, 20)})`;
            }
        }

        function darkenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        function printQR() {
            console.log('Printing QR');
            notificationSystem.show('Printing QR code...', 'info');
        }

        function shareQR() {
            console.log('Sharing QR');
            notificationSystem.show('QR code shared successfully!', 'success');
        }

        function toggleBookmark(eventId) {
            console.log('Toggling bookmark for event:', eventId);
            const index = state.bookmarkedEvents.indexOf(eventId);
            if (index > -1) {
                state.bookmarkedEvents.splice(index, 1);
                notificationSystem.show('Event removed from bookmarks', 'info');
            } else {
                state.bookmarkedEvents.push(eventId);
                notificationSystem.show('Event bookmarked', 'success');
            }
            
            // Update the event in state
            const eventIndex = state.events.findIndex(e => e.id === eventId);
            if (eventIndex > -1) {
                state.events[eventIndex].bookmarked = !state.events[eventIndex].bookmarked;
            }
            
            localStorage.setItem('amps_bookmarkedEvents', JSON.stringify(state.bookmarkedEvents));
            localStorage.setItem('amps_events', JSON.stringify(state.events));
            
            // Refresh current page
            renderPage();
        }

        function updateRSVP(eventId, status) {
            console.log('Updating RSVP for event:', eventId, 'to:', status);
            const eventIndex = state.events.findIndex(e => e.id === eventId);
            if (eventIndex > -1) {
                const oldStatus = state.events[eventIndex].rsvp;
                state.events[eventIndex].rsvp = status;
                
                // Update attendees count
                if (status === 'going' && oldStatus !== 'going') {
                    state.events[eventIndex].attendees++;
                    
                    // Show ticket purchase modal
                    setTimeout(() => showTicketModal(), 500);
                } else if (status !== 'going' && oldStatus === 'going') {
                    state.events[eventIndex].attendees = Math.max(0, state.events[eventIndex].attendees - 1);
                }
                
                localStorage.setItem('amps_events', JSON.stringify(state.events));
                notificationSystem.show(`RSVP updated: ${status}`, 'success');
                
                // Refresh current page
                renderPage();
            }
        }

        function showTicketModal() {
            console.log('Showing ticket modal');
            const modal = document.getElementById('ticketModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeTicketModal() {
            console.log('Closing ticket modal');
            const modal = document.getElementById('ticketModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function selectTicketOption(option) {
            console.log('Selecting ticket option:', option);
            state.selectedTicketOption = option;
            
            // Update UI
            document.querySelectorAll('.ticket-option').forEach(el => el.classList.remove('selected'));
            event.target.closest('.ticket-option').classList.add('selected');
        }

        function confirmTicketPurchase() {
            if (!state.selectedTicketOption) {
                notificationSystem.show('Please select a ticket option', 'warning');
                return;
            }
            
            console.log('Confirming ticket purchase:', state.selectedTicketOption);
            
            // Set reminder for event
            const event = state.currentEvent;
            if (event) {
                notificationSystem.show(`Ticket confirmed! You'll be reminded on ${event.date}`, 'success');
                
                // Add to calendar
                setTimeout(() => {
                    notificationSystem.show('Event added to your calendar', 'info');
                }, 1000);
            }
            
            closeTicketModal();
        }

        function checkInToEvent(eventId) {
            console.log('Checking in to event:', eventId);
            if (!state.currentUser) {
                navigateTo('auth');
                return;
            }
            
            const event = state.events.find(e => e.id === eventId);
            if (event) {
                state.currentEvent = event;
                
                if (event.geoFencing) {
                    notificationSystem.show('Verifying location... Please enable location services', 'info');
                    
                    // Simulate location verification
                    setTimeout(() => {
                        notificationSystem.show('Location verified! Opening camera for check-in', 'success');
                        setTimeout(() => openCameraForSelfie(), 1000);
                    }, 1500);
                } else {
                    notificationSystem.show('Opening camera for check-in', 'info');
                    setTimeout(() => openCameraForSelfie(), 1000);
                }
            }
        }

        function shareEvent(eventId) {
            console.log('Sharing event:', eventId);
            const event = state.events.find(e => e.id === eventId);
            if (event) {
                if (navigator.share) {
                    navigator.share({
                        title: event.name,
                        text: `Join me at ${event.name} on Amps!`,
                        url: window.location.href
                    });
                } else {
                    notificationSystem.show('Event link copied to clipboard', 'success');
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(`${event.name} - ${window.location.href}`);
                }
            }
        }

        // ===== FILTERS =====
        function showFiltersModal() {
            console.log('Showing filters modal');
            const modal = document.getElementById('filtersModal');
            if (modal) {
                modal.style.display = 'flex';
                
                // Initialize filter values
                const distanceSlider = document.getElementById('distanceSlider');
                const distanceValue = document.getElementById('distanceValue');
                const ageSlider = document.getElementById('ageSlider');
                const ageValue = document.getElementById('ageValue');
                
                if (distanceSlider && distanceValue) {
                    distanceSlider.value = state.filters.distance;
                    distanceValue.textContent = state.filters.distance + ' km';
                    
                    distanceSlider.oninput = function() {
                        distanceValue.textContent = this.value + ' km';
                    };
                }
                
                if (ageSlider && ageValue) {
                    ageSlider.value = state.filters.ageRange.max;
                    ageValue.textContent = state.filters.ageRange.min + '-' + state.filters.ageRange.max;
                    
                    ageSlider.oninput = function() {
                        ageValue.textContent = state.filters.ageRange.min + '-' + this.value;
                    };
                }
                
                // Update gender buttons
                ['All', 'Male', 'Female'].forEach(gender => {
                    const btn = document.getElementById('gender' + gender);
                    if (btn) {
                        const value = gender.toLowerCase();
                        if (value === state.filters.gender) {
                            btn.classList.add('active');
                            btn.style.borderColor = 'var(--primary)';
                            btn.style.background = 'var(--primary)';
                            btn.style.color = 'white';
                        } else {
                            btn.classList.remove('active');
                            btn.style.borderColor = '';
                            btn.style.background = '';
                            btn.style.color = '';
                        }
                    }
                });
                
                const verifiedOnly = document.getElementById('verifiedOnly');
                if (verifiedOnly) {
                    verifiedOnly.checked = state.filters.verifiedOnly;
                }
            }
        }

        function closeFilters() {
            console.log('Closing filters');
            const modal = document.getElementById('filtersModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function toggleFilter(type, value) {
            console.log('Toggling filter:', type, value);
            if (type === 'gender') {
                state.filters.gender = value;
            }
            
            // Update UI
            showFiltersModal();
        }

        function toggleInterest(interest) {
            console.log('Toggling interest:', interest);
            const index = state.filters.interests.indexOf(interest);
            if (index > -1) {
                state.filters.interests.splice(index, 1);
                event.target.style.opacity = '0.5';
            } else {
                state.filters.interests.push(interest);
                event.target.style.opacity = '1';
                event.target.style.background = 'var(--primary)';
                event.target.style.color = 'white';
            }
        }

        function applyFilters() {
            console.log('Applying filters');
            const distance = parseInt(document.getElementById('distanceSlider')?.value || 50);
            const ageMax = parseInt(document.getElementById('ageSlider')?.value || 35);
            const verifiedOnly = document.getElementById('verifiedOnly')?.checked || false;
            
            state.filters.distance = distance;
            state.filters.ageRange = { min: 18, max: ageMax };
            state.filters.verifiedOnly = verifiedOnly;
            
            // Save active filters
            state.activeFilters = {
                distance: distance,
                ageRange: state.filters.ageRange,
                gender: state.filters.gender,
                interests: state.filters.interests.length > 0,
                verifiedOnly: verifiedOnly
            };
            
            localStorage.setItem('amps_filters', JSON.stringify(state.filters));
            localStorage.setItem('amps_activeFilters', JSON.stringify(state.activeFilters));
            
            closeFilters();
            notificationSystem.show('Filters applied', 'success');
            
            // Refresh swipe page
            if (state.currentPage === 'swipe') {
                renderSwipePage(document.getElementById('content'));
            }
        }

        function clearFilters() {
            console.log('Clearing filters');
            state.filters = {
                distance: 50,
                ageRange: { min: 18, max: 35 },
                gender: 'all',
                interests: [],
                verifiedOnly: false
            };
            state.activeFilters = {};
            
            localStorage.removeItem('amps_filters');
            localStorage.removeItem('amps_activeFilters');
            
            notificationSystem.show('Filters cleared', 'info');
            renderSwipePage(document.getElementById('content'));
        }

        // ===== CAROUSEL FUNCTIONS =====
        function moveCarousel(index) {
            console.log('Moving carousel to:', index);
            const track = document.getElementById('eventCarouselTrack');
            const dots = document.querySelectorAll('#carouselDots .carousel-dot');
            
            if (track && dots) {
                const itemWidth = document.querySelector('.event-carousel-item')?.offsetWidth || 300;
                track.style.transform = `translateX(-${index * (itemWidth + 16)}px)`;
                
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }

        function moveFeaturedCarousel(index) {
            console.log('Moving featured carousel to:', index);
            const track = document.getElementById('featuredCarouselTrack');
            const dots = document.querySelectorAll('#featuredCarouselDots .carousel-dot');
            
            if (track && dots) {
                const itemWidth = document.querySelector('.event-carousel-item')?.offsetWidth || 300;
                track.style.transform = `translateX(-${index * (itemWidth + 16)}px)`;
                
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }
        
        // ===== UPGRADE FUNCTIONS =====
        function showUpgradeModal() {
            console.log('Showing upgrade modal');
            const modal = document.getElementById('proModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        function closeProModal() {
            console.log('Closing pro modal');
            const modal = document.getElementById('proModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function upgradeToPro() {
            console.log('Upgrading to Pro');
            state.isPro = true;
            state.isProPlus = false;
            
            // Update user limits
            state.dailyLikes = 30;
            state.superLikes = 5;
            state.rewindCount = 5;
            state.userProfile.maxPhotos = 10;
            
            localStorage.setItem('amps_isPro', true);
            localStorage.setItem('amps_isProPlus', false);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            closeProModal();
            notificationSystem.show(' Welcome to Amps Pro!', 'success');
            
            // Refresh current page
            setTimeout(() => renderPage(), 500);
        }
        
        function upgradeToProPlus() {
            console.log('Upgrading to Pro Plus');
            state.isPro = true;
            state.isProPlus = true;
            
            // Update user limits
            state.dailyLikes = Infinity;
            state.superLikes = Infinity;
            state.rewindCount = Infinity;
            state.userProfile.maxPhotos = Infinity;
            
            localStorage.setItem('amps_isPro', true);
            localStorage.setItem('amps_isProPlus', true);
            localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            
            closeProModal();
            notificationSystem.show(' Welcome to Amps Pro Plus!', 'success');
            
            // Create confetti
            createConfetti();
            
            // Refresh current page
            setTimeout(() => renderPage(), 500);
        }
        
        // ===== COMMENT SECTION =====
        function openCommentSheet() {
            console.log('Opening comment sheet');
            const sheet = document.getElementById('commentSheet');
            const content = document.getElementById('commentSheetContent');
            
            if (sheet && content) {
                sheet.classList.remove('hidden');
                
                // Load comments
                content.innerHTML = `
                    <div class="comment-list">
                        ${state.currentEventComments.map(comment => `
                            <div class="comment-item">
                                <div class="comment-avatar" style="background-image: url('${comment.userAvatar}');"></div>
                                <div class="comment-content">
                                    <div class="comment-author">${comment.userName}</div>
                                    <div class="comment-text">${comment.text}</div>
                                    <div class="comment-actions">
                                        <button class="comment-action" onclick="likeComment(${comment.id})">
                                            <i class="fas fa-heart"></i> ${comment.likes}
                                        </button>
                                        <button class="comment-action" onclick="replyToComment(${comment.id})">
                                            <i class="fas fa-reply"></i> Reply
                                        </button>
                                        <span class="text-gray-400">${comment.timestamp}</span>
                                    </div>
                                    ${comment.replies && comment.replies.length > 0 ? `
                                        <div class="mt-4 ml-4 border-l-2 border-gray-800 pl-4">
                                            ${comment.replies.map(reply => `
                                                <div class="comment-item mt-3">
                                                    <div class="comment-avatar" style="background-image: url('${reply.userAvatar}');"></div>
                                                    <div class="comment-content">
                                                        <div class="comment-author">${reply.userName}</div>
                                                        <div class="comment-text">${reply.text}</div>
                                                        <div class="comment-actions">
                                                            <button class="comment-action" onclick="likeComment(${reply.id})">
                                                                <i class="fas fa-heart"></i> ${reply.likes}
                                                            </button>
                                                            <span class="text-gray-400">${reply.timestamp}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // Initialize drag functionality
                initializeCommentSheetDrag();
            }
        }
        
        function closeCommentSheet() {
            console.log('Closing comment sheet');
            const sheet = document.getElementById('commentSheet');
            if (sheet) {
                sheet.classList.add('hidden');
            }
        }
        
        function postComment() {
            console.log('Posting comment');
            const input = document.getElementById('commentInput');
            if (!input) return;
            
            const comment = input.value.trim();
            if (comment) {
                const newComment = {
                    id: Date.now(),
                    userId: state.currentUser?.id || 1,
                    userName: state.userProfile.name,
                    userAvatar: state.userProfile.profilePhoto,
                    text: comment,
                    timestamp: 'Just now',
                    likes: 0,
                    replies: []
                };
                
                state.currentEventComments.unshift(newComment);
                input.value = '';
                
                notificationSystem.show('Comment posted', 'success');
                
                // Refresh comment sheet
                openCommentSheet();
            }
        }
        
        function postQuickComment() {
            console.log('Posting quick comment');
            const input = document.getElementById('quickCommentInput');
            if (!input) return;
            
            const comment = input.value.trim();
            if (comment) {
                const newComment = {
                    id: Date.now(),
                    userId: state.currentUser?.id || 1,
                    userName: state.userProfile.name,
                    userAvatar: state.userProfile.profilePhoto,
                    text: comment,
                    timestamp: 'Just now',
                    likes: 0,
                    replies: []
                };
                
                state.currentEventComments.unshift(newComment);
                input.value = '';
                
                notificationSystem.show('Comment posted', 'success');
                
                // Refresh event detail page
                renderEventDetailPage(document.getElementById('content'));
            }
        }
        
        function likeComment(commentId) {
            console.log('Liking comment:', commentId);
            
            // Find comment in nested structure
            const findAndLike = (comments) => {
                for (let comment of comments) {
                    if (comment.id === commentId) {
                        comment.likes++;
                        return true;
                    }
                    if (comment.replies && comment.replies.length > 0) {
                        if (findAndLike(comment.replies)) {
                            return true;
                        }
                    }
                }
                return false;
            };
            
            if (findAndLike(state.currentEventComments)) {
                notificationSystem.show('Liked comment', 'success');
                
                // Refresh comment sheet if open
                if (!document.getElementById('commentSheet').classList.contains('hidden')) {
                    openCommentSheet();
                }
            }
        }
        
        function replyToComment(commentId) {
            console.log('Replying to comment:', commentId);
            const input = document.getElementById('commentInput');
            if (input) {
                input.placeholder = `Replying to comment ${commentId}...`;
                input.focus();
            }
        }
        
        function initializeCommentSheetDrag() {
            const sheet = document.getElementById('commentSheet');
            const handle = document.querySelector('.comment-sheet-handle');
            
            if (!sheet || !handle) return;
            
            let startY, currentY;
            let isDragging = false;
            
            const onTouchStart = (e) => {
                startY = e.touches ? e.touches[0].clientY : e.clientY;
                isDragging = true;
                sheet.style.transition = 'none';
            };
            
            const onTouchMove = (e) => {
                if (!isDragging) return;
                
                currentY = e.touches ? e.touches[0].clientY : e.clientY;
                const diff = currentY - startY;
                
                if (diff > 0) { // Only allow downward swipe to close
                    sheet.style.transform = `translateY(${diff}px)`;
                }
            };
            
            const onTouchEnd = () => {
                if (!isDragging) return;
                
                isDragging = false;
                const diff = currentY - startY;
                
                if (diff > 100) { // Swipe threshold
                    closeCommentSheet();
                } else {
                    sheet.style.transition = 'transform 0.3s';
                    sheet.style.transform = '';
                }
                
                startY = currentY = null;
            };
            
            // Touch events
            handle.addEventListener('touchstart', onTouchStart, { passive: true });
            handle.addEventListener('touchmove', onTouchMove, { passive: false });
            handle.addEventListener('touchend', onTouchEnd);
            
            // Mouse events for desktop
            handle.addEventListener('mousedown', onTouchStart);
            document.addEventListener('mousemove', onTouchMove);
            document.addEventListener('mouseup', onTouchEnd);
        }
        
        // ===== PHOTO DUMP =====
        function openPhotoDumpModal(eventId) {
            console.log('Opening photo dump modal for event:', eventId);
            const modal = document.getElementById('photoDumpModal');
            const grid = document.getElementById('photoDumpGrid');
            const uploadBtn = document.getElementById('uploadPhotoBtn');
            
            if (modal && grid && uploadBtn) {
                modal.style.display = 'flex';
                
                // Load photos
                const eventPhotos = state.communityPhotos.filter(photo => photo.eventId === eventId);
                
                grid.innerHTML = `
                    ${eventPhotos.map(photo => `
                        <div class="photo-item">
                            <img src="${photo.url}" alt="Community photo">
                            <div class="photo-overlay">
                                <div class="photo-actions">
                                    <button class="btn btn-outline btn-small" onclick="likePhoto(${photo.id})">
                                        <i class="fas fa-heart"></i> ${photo.likes}
                                    </button>
                                    <button class="btn btn-outline btn-small" onclick="downloadPhoto('${photo.url}')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    <div class="photo-item add-photo-btn ${state.isPro || state.isProPlus ? '' : 'locked'}" 
                         onclick="${state.isPro || state.isProPlus ? 'openPhotoUpload()' : 'notificationSystem.show(\'Upgrade to Pro to add photos\', \'warning\')'}">
                        <i class="fas fa-plus text-2xl"></i>
                        <span class="text-sm">${state.isPro || state.isProPlus ? 'Add Photo' : 'Upgrade to Add'}</span>
                    </div>
                `;
                
                // Update upload button text based on plan
                uploadBtn.innerHTML = state.isPro || state.isProPlus ? 
                    '<i class="fas fa-plus"></i> Add Photo' :
                    '<i class="fas fa-crown"></i> Upgrade to Add Photos';
            }
        }
        
        function closePhotoDumpModal() {
            console.log('Closing photo dump modal');
            const modal = document.getElementById('photoDumpModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function openPhotoUpload() {
            console.log('Opening photo upload');
            notificationSystem.show('Photo upload coming soon!', 'info');
        }
        
        function likePhoto(photoId) {
            console.log('Liking photo:', photoId);
            const photo = state.communityPhotos.find(p => p.id === photoId);
            if (photo) {
                photo.likes++;
                notificationSystem.show('Liked photo', 'success');
                
                // Refresh modal
                openPhotoDumpModal(state.currentEvent?.id);
            }
        }
        
        function downloadPhoto(url) {
            console.log('Downloading photo:', url);
            notificationSystem.show('Photo download started', 'success');
            
            // Simulate download
            const link = document.createElement('a');
            link.href = url;
            link.download = 'amps_photo.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function uploadCommunityPhoto() {
            if (!state.isPro && !state.isProPlus) {
                notificationSystem.show('Upgrade to Pro to add photos to the community dump', 'warning');
                navigateTo('pricing');
                return;
            }
            
            console.log('Uploading community photo');
            notificationSystem.show('Community photo upload coming soon!', 'info');
        }
        
        // ===== UTILITY FUNCTIONS =====
        function createConfetti() {
            console.log('Creating confetti');
            const confettiCount = 150;
            const container = document.getElementById('app');
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${['#8B5CF6', '#EC4899', '#3B82F6', '#10B981', '#F59E0B'][Math.floor(Math.random() * 5)]};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
                    top: -10px;
                    left: ${Math.random() * 100}%;
                    animation: confettiFall ${1 + Math.random() * 2}s linear forwards;
                    z-index: 3000;
                    pointer-events: none;
                `;
                
                container.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        function addProfileView(profile) {
            if (state.isPro || state.isProPlus) {
                const view = {
                    id: Date.now(),
                    name: profile.name,
                    age: profile.age,
                    photo: profile.livePhoto,
                    eventName: state.currentEvent?.name || 'Event',
                    time: 'Just now',
                    online: profile.online
                };
                
                state.userProfile.profileViews.unshift(view);
                localStorage.setItem('amps_userProfile', JSON.stringify(state.userProfile));
            }
        }
        
        function enterCodeManually() {
            console.log('Entering code manually');
            notificationSystem.show('Manual code entry coming soon!', 'info');
        }
        
        function playEventVideo(eventId) {
            console.log('Playing event video:', eventId);
            const video = document.getElementById('eventVideo');
            if (video) {
                video.muted = false;
                video.play();
                notificationSystem.show('Video playing with sound', 'info');
            }
        }
        
        function viewFullProfile(profileId) {
            console.log('Viewing full profile:', profileId);
            const profile = MOCK_PROFILES.find(p => p.id === profileId);
            if (profile) {
                const modal = document.createElement('div');
                modal.className = 'pro-modal';
                modal.style.cssText = `
                    position: fixed;
                    inset: 0;
                    background: rgba(0, 0, 0, 0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                    backdrop-filter: blur(10px);
                `;
                
                modal.innerHTML = `
                    <div class="pro-content" style="max-width: 90%;">
                        <button class="back-btn" onclick="this.closest('.pro-modal').remove()" style="position: absolute; top: 16px; left: 16px;">
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <div class="text-center">
                            <div class="avatar" style="width: 120px; height: 120px; background-image: url('${profile.livePhoto}'); margin: 0 auto 16px;"></div>
                            <h2>${profile.name}, ${profile.age}</h2>
                            <p class="text-gray-400 mb-4">${profile.bio}</p>
                            
                            <div class="live-badge mb-4">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${profile.location}  ${profile.distance}</span>
                            </div>
                            
                            <div class="interests mb-6">
                                ${profile.interests.map(interest => `
                                    <span class="interest-tag">${interest}</span>
                                `).join('')}
                            </div>
                            
                            <div class="flex gap-3">
                                <button class="btn btn-primary" onclick="swipeRight(); this.closest('.pro-modal').remove()">
                                    <i class="fas fa-heart"></i> Like
                                </button>
                                <button class="btn btn-outline" onclick="swipeLeft(); this.closest('.pro-modal').remove()">
                                    <i class="fas fa-times"></i> Pass
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
        }
        
        // ===== SETTINGS FUNCTIONS =====
        function updatePrivacySetting(key, value) {
            console.log('Updating privacy setting:', key, value);
            if (key === 'showProfile') {
                state.privacySettings.showProfile = value;
            } else if (key === 'showOnlineStatus') {
                state.privacySettings.showOnlineStatus = value;
            } else if (key === 'showDistance') {
                state.privacySettings.showDistance = value;
            }
            
            localStorage.setItem('amps_privacySettings', JSON.stringify(state.privacySettings));
            notificationSystem.show('Privacy settings updated', 'success');
        }
        
        function updateNotificationSetting(key, value) {
            console.log('Updating notification setting:', key, value);
            state.privacySettings.notifications[key] = value;
            localStorage.setItem('amps_privacySettings', JSON.stringify(state.privacySettings));
            notificationSystem.show('Notification settings updated', 'success');
        }
        
        function togglePushNotifications(enabled) {
            console.log('Toggle push notifications:', enabled);
            notificationSystem.show(enabled ? 'Push notifications enabled' : 'Push notifications disabled', 'info');
        }
        
        function toggleNotificationSound(enabled) {
            console.log('Toggle notification sound:', enabled);
            notificationSystem.show(enabled ? 'Notification sound enabled' : 'Notification sound disabled', 'info');
        }
        
        function toggleNotificationVibration(enabled) {
            console.log('Toggle notification vibration:', enabled);
            notificationSystem.show(enabled ? 'Notification vibration enabled' : 'Notification vibration disabled', 'info');
        }
        
        function saveQuietHours() {
            console.log('Saving quiet hours');
            notificationSystem.show('Quiet hours saved', 'success');
        }
        
        function changeEmail() {
            console.log('Changing email');
            notificationSystem.show('Email change coming soon!', 'info');
        }
        
        function changePassword() {
            console.log('Changing password');
            notificationSystem.show('Password change coming soon!', 'info');
        }
        
        function changePhone() {
            console.log('Changing phone');
            notificationSystem.show('Phone number change coming soon!', 'info');
        }
        
        function toggleTheme(darkMode) {
            console.log('Toggle theme:', darkMode);
            notificationSystem.show(darkMode ? 'Dark mode enabled' : 'Light mode enabled', 'info');
        }
        
        function toggleAutoplay(enabled) {
            console.log('Toggle autoplay:', enabled);
            notificationSystem.show(enabled ? 'Autoplay enabled' : 'Autoplay disabled', 'info');
        }
        
        function showTerms() {
            console.log('Showing terms');
            notificationSystem.show('Terms of service coming soon!', 'info');
        }
        
        function showPrivacyPolicy() {
            console.log('Showing privacy policy');
            notificationSystem.show('Privacy policy coming soon!', 'info');
        }
        
        function clearCache() {
            console.log('Clearing cache');
            notificationSystem.show('Cache cleared successfully', 'success');
        }
        
        function showBlockedUsers() {
            console.log('Showing blocked users');
            notificationSystem.show('Blocked users management coming soon!', 'info');
        }
        
        function showReportHistory() {
            console.log('Showing report history');
            notificationSystem.show('Report history coming soon!', 'info');
        }
        
        function setupEmergencyContacts() {
            console.log('Setting up emergency contacts');
            notificationSystem.show('Emergency contacts setup coming soon!', 'info');
        }
        
        function downloadData() {
            console.log('Downloading data');
            notificationSystem.show('Data download request sent', 'success');
        }
        
        function deleteAccount() {
            console.log('Deleting account');
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                notificationSystem.show('Account deletion request sent', 'info');
                setTimeout(() => {
                    logout();
                }, 2000);
            }
        }
        
        function exportData(format) {
            console.log('Exporting data as:', format);
            notificationSystem.show(`Exporting data as ${format.toUpperCase()}...`, 'success');
        }
        
        function showHelp() {
            console.log('Showing help');
            notificationSystem.show('Help & support coming soon!', 'info');
        }
        
        function showPayment(method) {
            console.log('Showing payment method:', method);
            notificationSystem.show(`${method.charAt(0).toUpperCase() + method.slice(1)} payment coming soon!`, 'info');
        }
        
        function editEvent(eventId) {
            console.log('Editing event:', eventId);
            notificationSystem.show('Event editing coming soon!', 'info');
        }
        
        function sendEventUpdate() {
            console.log('Sending event update');
            notificationSystem.show('Event update sent to attendees', 'success');
        }
        
        function downloadAttendeeList() {
            console.log('Downloading attendee list');
            notificationSystem.show('Attendee list downloaded', 'success');
        }
        
        function attachFile() {
            console.log('Attaching file');
            notificationSystem.show('File attachment coming soon!', 'info');
        }
        
        function showChatOptions(matchId) {
            console.log('Showing chat options for match:', matchId);
            notificationSystem.show('Chat options coming soon!', 'info');
        }
        
        function startVideoCall(matchId) {
            console.log('Starting video call with match:', matchId);
            if (!state.isPro && !state.isProPlus) {
                notificationSystem.show('Video calls require Pro or Pro Plus subscription', 'warning');
                navigateTo('pricing');
                return;
            }
            notificationSystem.show('Video call starting...', 'info');
        }
        
        function searchEvents() {
            console.log('Searching events');
            const searchInput = document.getElementById('eventSearch');
            if (searchInput) {
                const query = searchInput.value.toLowerCase();
                notificationSystem.show(`Searching for "${query}"...`, 'info');
            }
        }
        
        function filterEventsByTag(tag) {
            console.log('Filtering events by tag:', tag);
            const tags = document.querySelectorAll('.search-tag');
            tags.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            notificationSystem.show(`Filtering by ${tag}`, 'info');
        }
        
        // ===== ENHANCED CSS FOR MOBILE OPTIMIZATION =====
        function addSwitchStyles() {
            // Add switch styles if not already present
            if (!document.querySelector('#switchStyles')) {
                const style = document.createElement('style');
                style.id = 'switchStyles';
                style.textContent = `
                    /* Switch Toggle Styles */
                    .switch {
                        position: relative;
                        display: inline-block;
                        width: 44px;
                        height: 24px;
                    }
                    
                    .switch input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }
                    
                    .slider {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-color: var(--gray-700);
                        transition: .4s;
                        border-radius: 34px;
                    }
                    
                    .slider:before {
                        position: absolute;
                        content: "";
                        height: 16px;
                        width: 16px;
                        left: 4px;
                        bottom: 4px;
                        background-color: white;
                        transition: .4s;
                        border-radius: 50%;
                    }
                    
                    input:checked + .slider {
                        background-color: var(--primary);
                    }
                    
                    input:checked + .slider:before {
                        transform: translateX(20px);
                    }
                    
                    /* Enhanced Mobile Comment Sheet */
                    @keyframes slideUp {
                        from {
                            transform: translateY(100%);
                        }
                        to {
                            transform: translateY(0);
                        }
                    }
                    
                    /* Instagram-style Notification Overrides */
                    .notification-container {
                        top: 70px;
                        right: 16px;
                        left: auto;
                        width: auto;
                        max-width: 320px;
                    }
                    
                    .notification {
                        background: rgba(28, 28, 30, 0.95);
                        backdrop-filter: blur(40px);
                        border-radius: 16px;
                        padding: 12px;
                        border: 1px solid rgba(255, 255, 255, 0.15);
                        margin-bottom: 8px;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                    }
                    
                    /* Enhanced Mobile Scrollbars */
                    @media (max-width: 768px) {
                        ::-webkit-scrollbar {
                            width: 3px;
                        }
                        
                        ::-webkit-scrollbar-track {
                            background: transparent;
                        }
                        
                        ::-webkit-scrollbar-thumb {
                            background: rgba(139, 92, 246, 0.4);
                            border-radius: 3px;
                        }
                        
                        /* Hide scrollbar when not scrolling */
                        * {
                            scrollbar-width: none;
                        }
                        
                        .scrollable-content {
                            scrollbar-width: thin;
                            scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
                        }
                        
                        .scrollable-content::-webkit-scrollbar {
                            width: 3px;
                        }
                    }
                    
                    /* Mobile Touch Optimizations */
                    @media (hover: none) and (pointer: coarse) {
                        .btn, .action-button, .nav-item {
                            min-height: 44px;
                            min-width: 44px;
                        }
                        
                        .form-control, .search-input {
                            font-size: 16px; /* Prevents iOS zoom */
                        }
                        
                        .swipe-actions .action-button {
                            width: 64px;
                            height: 64px;
                        }
                        
                        .swipe-actions .action-button.like {
                            width: 72px;
                            height: 72px;
                        }
                    }
                    
                    /* Featured vs Bookmarked Event Styling */
                    .featured-badge {
                        background: var(--pro-gradient);
                        color: white;
                        padding: 4px 12px;
                        border-radius: 12px;
                        font-size: 10px;
                        font-weight: 700;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    .bookmark-button.active {
                        color: var(--accent-yellow);
                    }
                    
                    /* Max User Event Styling */
                    .event-card.max-user {
                        border-left: 4px solid var(--accent-gold);
                    }
                    
                    /* Pro-only Feature Indicators */
                    .pro-only {
                        position: relative;
                    }
                    
                    .pro-only::after {
                        content: 'PRO';
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: var(--pro-gradient);
                        color: white;
                        font-size: 8px;
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-weight: 700;
                    }
                    
                    /* Demo Mode Styling */
                    .demo-mode {
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .demo-mode::before {
                        content: 'DEMO';
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%) rotate(-45deg);
                        font-size: 48px;
                        font-weight: 900;
                        color: rgba(139, 92, 246, 0.1);
                        z-index: 1;
                        pointer-events: none;
                    }
                    
                    /* Loading States */
                    .loading {
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .loading::after {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: linear-gradient(90deg, 
                            transparent, 
                            rgba(255, 255, 255, 0.1), 
                            transparent);
                        animation: loading 1.5s infinite;
                    }
                    
                    @keyframes loading {
                        0% { transform: translateX(-100%); }
                        100% { transform: translateX(100%); }
                    }
                    
                    /* Enhanced Form States */
                    .form-control:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                    }
                    
                    .btn:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                        transform: none !important;
                    }
                    
                    /* Responsive Typography */
                    @media (max-width: 480px) {
                        h1 { font-size: 28px; }
                        h2 { font-size: 24px; }
                        h3 { font-size: 20px; }
                        h4 { font-size: 18px; }
                        
                        .hero h1 { font-size: 32px; }
                        .hero-subtitle { font-size: 16px; }
                        
                        .profile-info h2 { font-size: 20px; }
                    }
                    
                    /* Safe Area Insets for Modern Phones */
                    @supports (padding: max(0px)) {
                        .bottom-nav {
                            padding-bottom: max(env(safe-area-inset-bottom), 16px);
                        }
                        
                        .navbar {
                            padding-top: env(safe-area-inset-top);
                            height: calc(var(--header-height) + env(safe-area-inset-top));
                        }
                        
                        .content {
                            padding-top: calc(var(--header-height) + env(safe-area-inset-top) + 16px);
                        }
                    }
                    
                    /* Performance Optimizations */
                    .will-change-transform {
                        will-change: transform;
                    }
                    
                    .will-change-opacity {
                        will-change: opacity;
                    }
                    
                    /* Reduced Motion */
                    @media (prefers-reduced-motion: reduce) {
                        *,
                        *::before,
                        *::after {
                            animation-duration: 0.01ms !important;
                            animation-iteration-count: 1 !important;
                            transition-duration: 0.01ms !important;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // ===== INITIALIZATION =====
        function initApp() {
            console.log('Initializing Amps App');
            
            // Load saved state from localStorage
            const savedUser = localStorage.getItem('amps_user');
            const savedIsPro = localStorage.getItem('amps_isPro');
            const savedIsProPlus = localStorage.getItem('amps_isProPlus');
            const savedUserProfile = localStorage.getItem('amps_userProfile');
            const savedSwipeCount = localStorage.getItem('amps_swipeCount');
            const savedMonthlySwipes = localStorage.getItem('amps_monthlySwipes');
            const savedSwipeHistory = localStorage.getItem('amps_swipeHistory');
            const savedMatches = localStorage.getItem('amps_matches');
            const savedChatMessages = localStorage.getItem('amps_chatMessages');
            const savedFilters = localStorage.getItem('amps_filters');
            const savedActiveFilters = localStorage.getItem('amps_activeFilters');
            const savedBookmarkedEvents = localStorage.getItem('amps_bookmarkedEvents');
            const savedPrivacySettings = localStorage.getItem('amps_privacySettings');
            const savedDemoMode = localStorage.getItem('amps_demoMode');
            
            if (savedUser) state.currentUser = JSON.parse(savedUser);
            if (savedIsPro) state.isPro = savedIsPro === 'true';
            if (savedIsProPlus) state.isProPlus = savedIsProPlus === 'true';
            if (savedUserProfile) state.userProfile = JSON.parse(savedUserProfile);
            if (savedSwipeCount) state.swipeCount = parseInt(savedSwipeCount);
            if (savedMonthlySwipes) state.monthlySwipes = parseInt(savedMonthlySwipes);
            if (savedSwipeHistory) state.swipeHistory = JSON.parse(savedSwipeHistory);
            if (savedMatches) state.matches = JSON.parse(savedMatches);
            if (savedChatMessages) state.chatMessages = JSON.parse(savedChatMessages);
            if (savedFilters) state.filters = JSON.parse(savedFilters);
            if (savedActiveFilters) state.activeFilters = JSON.parse(savedActiveFilters);
            if (savedBookmarkedEvents) state.bookmarkedEvents = JSON.parse(savedBookmarkedEvents);
            if (savedPrivacySettings) state.privacySettings = JSON.parse(savedPrivacySettings);
            if (savedDemoMode) state.demoMode = savedDemoMode === 'true';
            
            // Check if daily likes should reset
            const today = new Date().toDateString();
            if (state.lastSwipeReset !== today) {
                state.swipeCount = 0;
                state.lastSwipeReset = today;
                localStorage.setItem('amps_swipeCount', 0);
                localStorage.setItem('amps_lastSwipeReset', today);
            }
            
            // Show demo banner if in demo mode
            if (state.demoMode) {
                document.getElementById('demoBanner').classList.remove('hidden');
                document.getElementById('demoExitBtn').classList.remove('hidden');
            }
            
            // Set up auto-advancing carousels
            setupAutoCarousels();
            
            // Set up service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            }
            
            // Set up PWA manifest
            const manifest = document.getElementById('manifest');
            if (manifest) {
                manifest.href = '/manifest.json';
            }
            
            // Set up beforeinstallprompt for PWA
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button
                setTimeout(() => {
                    notificationSystem.show('Install Amps for a better experience?', 'info', 5000);
                }, 3000);
            });
            
            // Initial render
            renderPage();
            updateNavigation();
            
            // Show welcome notification
            if (!state.currentUser && !state.demoMode) {
                setTimeout(() => {
                    notificationSystem.show('Welcome to Amps! Try the demo or sign up to get started ', 'info', 4000);
                }, 1000);
            }
        }
        
        function setupAutoCarousels() {
            // Set up auto-advancing for carousels
            setInterval(() => {
                const featuredDots = document.querySelectorAll('#featuredCarouselDots .carousel-dot');
                const activeDot = document.querySelector('#featuredCarouselDots .carousel-dot.active');
                
                if (featuredDots.length > 0 && activeDot) {
                    let currentIndex = Array.from(featuredDots).indexOf(activeDot);
                    let nextIndex = (currentIndex + 1) % featuredDots.length;
                    
                    moveFeaturedCarousel(nextIndex);
                }
            }, 5000); // Change every 5 seconds
        }
        
        // ===== ENHANCED SCROLLBAR FIX =====
        function enhanceScrollbars() {
            // Add custom scrollbar styles dynamically
            const scrollbarStyles = `
                /* Hide scrollbar by default, show on hover/focus */
                .scrollable-content {
                    scrollbar-width: thin;
                    scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
                    overflow-y: scroll;
                }
                
                .scrollable-content::-webkit-scrollbar {
                    width: 4px;
                    height: 4px;
                }
                
                .scrollable-content::-webkit-scrollbar-track {
                    background: transparent;
                    border-radius: 2px;
                }
                
                .scrollable-content::-webkit-scrollbar-thumb {
                    background: rgba(139, 92, 246, 0.3);
                    border-radius: 2px;
                    transition: background 0.3s ease;
                }
                
                .scrollable-content::-webkit-scrollbar-thumb:hover {
                    background: rgba(139, 92, 246, 0.5);
                }
                
                /* For mobile, hide scrollbar completely */
                @media (max-width: 768px) {
                    .scrollable-content::-webkit-scrollbar {
                        display: none;
                    }
                    
                    .scrollable-content {
                        -webkit-overflow-scrolling: touch;
                        scrollbar-width: none;
                    }
                }
                
                /* Smooth scrolling for the whole app */
                html {
                    scroll-behavior: smooth;
                }
            `;
            
            const style = document.createElement('style');
            style.textContent = scrollbarStyles;
            document.head.appendChild(style);
        }
        
        // ===== BACK BUTTON HANDLING =====
        window.addEventListener('popstate', function(event) {
            console.log('Back button pressed');
            goBack();
        });
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app');
            enhanceScrollbars();
            initApp();
            
            // Add global click handler for modals
            document.addEventListener('click', function(e) {
                // Close modals when clicking outside
                if (e.target.classList.contains('pro-modal') || 
                    e.target.classList.contains('match-modal') ||
                    e.target.classList.contains('filters-modal') ||
                    e.target.classList.contains('ticket-modal') ||
                    e.target.classList.contains('photoDumpModal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Escape key closes modals
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.pro-modal, .match-modal, .filters-modal, .ticket-modal, .photoDumpModal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'flex') {
                            modal.style.display = 'none';
                        }
                    });
                    
                    // Also close comment sheet
                    const commentSheet = document.getElementById('commentSheet');
                    if (commentSheet && !commentSheet.classList.contains('hidden')) {
                        closeCommentSheet();
                    }
                }
                
                // Left/right arrow for carousel navigation
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    const activeCarousel = document.querySelector('.event-carousel');
                    if (activeCarousel) {
                        const dots = activeCarousel.querySelectorAll('.carousel-dot');
                        const activeDot = activeCarousel.querySelector('.carousel-dot.active');
                        if (dots.length > 0 && activeDot) {
                            let currentIndex = Array.from(dots).indexOf(activeDot);
                            let nextIndex = e.key === 'ArrowLeft' ? 
                                (currentIndex - 1 + dots.length) % dots.length : 
                                (currentIndex + 1) % dots.length;
                            
                            if (activeCarousel.id === 'featuredCarousel') {
                                moveFeaturedCarousel(nextIndex);
                            } else {
                                moveCarousel(nextIndex);
                            }
                        }
                    }
                }
            });
            
            // Prevent pull-to-refresh on mobile
            document.body.addEventListener('touchmove', function(e) {
                if (e.target.closest('.scrollable-content')) {
                    return;
                }
                
                const startY = e.touches[0].clientY;
                if (startY < 10) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Add resize handler for mobile optimization
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    // Reinitialize swipe gestures on resize
                    if (state.currentPage === 'swipe') {
                        initializeSwipeGestures();
                    }
                }, 250);
            });
            
            // Set up visibility change handler
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    console.log('App hidden');
                    // Save state
                    localStorage.setItem('amps_state', JSON.stringify({
                        currentPage: state.currentPage,
                        currentEvent: state.currentEvent,
                        swipeCount: state.swipeCount,
                        matches: state.matches
                    }));
                } else {
                    console.log('App visible');
                    // Check if we need to reset daily limits
                    const today = new Date().toDateString();
                    if (state.lastSwipeReset !== today) {
                        state.swipeCount = 0;
                        state.lastSwipeReset = today;
                        localStorage.setItem('amps_swipeCount', 0);
                        localStorage.setItem('amps_lastSwipeReset', today);
                        
                        if (state.currentPage === 'swipe' || state.currentPage === 'dashboard') {
                            renderPage();
                        }
                    }
                }
            });
            
            // Add offline/online handlers
            window.addEventListener('offline', function() {
                notificationSystem.show('You\'re offline. Some features may be limited.', 'warning');
            });
            
            window.addEventListener('online', function() {
                notificationSystem.show('You\'re back online!', 'success');
            });
            
            // Initial network status check
            if (!navigator.onLine) {
                notificationSystem.show('You\'re offline. Using cached data.', 'warning');
            }
        });
        
        // Export for debugging
        window.ampsState = state;
        window.ampsNavigate = navigateTo;
        window.ampsNotification = notificationSystem;
        
        console.log('Amps App initialized successfully');
   </sript>
</body>
</html>
