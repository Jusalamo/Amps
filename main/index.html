<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Amps | Amplify Your Connections at Live Events</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Mapbox GL -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" id="manifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Amps">
    
    <!-- Styles -->
    <style>
       /* ===== BASE STYLES ===== */
:root {
    --bg-primary: #000000;
    --bg-secondary: #0a0a0a;
    --bg-tertiary: #161616;
    --bg-card: rgba(30, 30, 30, 0.7);
    --bg-glass: rgba(255, 255, 255, 0.05);
    
    /* Profile Card Colors */
    --card-purple: #8B5CF6;
    --card-pink: #EC4899;
    --card-blue: #3B82F6;
    --card-green: #10B981;
    --card-yellow: #F59E0B;
    --card-orange: #F97316;
    --card-red: #EF4444;
    --card-teal: #14B8A6;
    --card-indigo: #6366F1;
    --card-lavender: #C4B5FD;
    --card-pastel-pink: #FFC0D9;
    --card-pastel-blue: #BAE6FD;
    --card-mint: #BBF7D0;
    --card-peach: #FECACA;
    
    --primary: #8B5CF6;
    --primary-light: #A78BFA;
    --primary-dark: #7C3AED;
    --primary-glow: rgba(139, 92, 246, 0.3);
    
    --accent-green: #10B981;
    --accent-red: #EF4444;
    --accent-yellow: #F59E0B;
    --accent-blue: #3B82F6;
    --accent-gold: #F5DEB3;
    
    --pro-gradient: linear-gradient(135deg, #8B5CF6, #EC4899, #F59E0B);
    --pro-plus-gradient: linear-gradient(135deg, #F59E0B, #8B5CF6, #EC4899);
    --demo-gradient: linear-gradient(135deg, #3B82F6, #8B5CF6, #EC4899);
    
    --white: #FFFFFF;
    --gray-100: #F1F5F9;
    --gray-200: #E2E8F0;
    --gray-300: #CBD5E1;
    --gray-400: #8E8E93;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1C1C1E;
    --gray-900: #2C2C2E;
    
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
    --shadow-glow: 0 0 30px rgba(139, 92, 246, 0.4);
    --shadow-card-stack: 0 20px 60px rgba(0, 0, 0, 0.4), 0 8px 24px rgba(0, 0, 0, 0.3);
    --shadow-gold: 0 8px 24px rgba(245, 222, 179, 0.3);
    
    /* Border Radius System */
    --radius-sm: 8px;
    --radius: 12px;
    --radius-md: 16px;
    --radius-lg: 20px;
    --radius-xl: 24px;
    --radius-2xl: 32px;
    --radius-full: 9999px;
    
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
    
    --header-height: 64px;
    --bottom-nav-height: 65px;
    --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
    
    /* Map Drawer */
    --map-drawer-height: 20%;
    --map-drawer-transition: cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, Oxygen, Ubuntu, sans-serif;
    background: var(--bg-primary);
    color: var(--white);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
    min-height: 100vh;
    padding-bottom: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
}

.app {
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    background: var(--bg-primary);
    position: relative;
    overflow: hidden;
}

/* ===== UTILITY CLASSES ===== */
.hidden { display: none !important; }
.flex { display: flex; }
.flex-col { flex-direction: column; }
.items-center { align-items: center; }
.justify-center { justify-content: center; }
.justify-between { justify-content: space-between; }
.gap-2 { gap: 8px; }
.gap-3 { gap: 12px; }
.gap-4 { gap: 16px; }
.gap-5 { gap: 20px; }
.w-full { width: 100%; }
.text-center { text-align: center; }
.cursor-pointer { cursor: pointer; }
.relative { position: relative; }
.mt-1 { margin-top: 4px; }
.mt-2 { margin-top: 8px; }
.mt-3 { margin-top: 16px; }
.mt-4 { margin-top: 24px; }
.mt-5 { margin-top: 32px; }
.mb-1 { margin-bottom: 4px; }
.mb-2 { margin-bottom: 8px; }
.mb-3 { margin-bottom: 16px; }
.mb-4 { margin-bottom: 24px; }
.mb-5 { margin-bottom: 32px; }

/* ===== LANDING PAGE ===== */
.hero {
    text-align: center;
    padding: 80px 20px 40px;
    position: relative;
    z-index: 1;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    line-height: 1.1;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 30%, var(--card-pink) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 40px;
    color: var(--gray-400);
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin: 60px 0;
}

.feature {
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--radius-2xl);
    padding: 24px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all var(--transition);
}

.feature:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-glow);
}

.feature-icon {
    width: 56px;
    height: 56px;
    background: rgba(139, 92, 246, 0.2);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 24px;
    color: var(--primary-light);
}

.cta-grid {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin: 40px 0;
}

/* ===== NAVIGATION ===== */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    height: var(--header-height);
    background: rgba(0, 0, 0, 0.9);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    backdrop-filter: blur(20px);
    max-width: 480px;
    margin: 0 auto;
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 24px;
    font-weight: 800;
    cursor: pointer;
}

.nav-brand .amp {
    background: var(--pro-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.nav-brand .s {
    color: var(--white);
}

.nav-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.back-btn {
    background: none;
    border: none;
    color: var(--white);
    font-size: 20px;
    cursor: pointer;
    padding: 8px;
    border-radius: var(--radius-full);
    transition: background var(--transition-fast);
}

.back-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* ===== BOTTOM NAVIGATION ===== */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: var(--safe-area-inset-bottom);
    z-index: 999;
    max-width: 480px;
    margin: 0 auto;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 12px;
    background: none;
    border: none;
    color: var(--gray-400);
    font-size: 12px;
    transition: all var(--transition-fast);
    flex: 1;
    height: 100%;
}

.nav-item.active {
    color: var(--primary);
}

.nav-item i {
    font-size: 20px;
}

/* ===== CONTENT CONTAINER ===== */
.content {
    padding: calc(var(--header-height) + 20px) 20px 20px;
    min-height: 100vh;
}

/* ===== BUTTONS ===== */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: var(--radius-xl);
    font-weight: 600;
    font-size: 14px;
    text-decoration: none;
    cursor: pointer;
    border: none;
    transition: all var(--transition);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.btn-primary {
    background: var(--primary);
    color: var(--white);
    box-shadow: var(--shadow-glow);
}

.btn-primary:hover {
    background: var(--primary-light);
    transform: translateY(-2px);
    box-shadow: var(--shadow-glow), 0 8px 25px rgba(139, 92, 246, 0.3);
}

.btn-pro {
    background: var(--pro-gradient);
    color: var(--white);
    background-size: 200% 200%;
    animation: gradientMove 3s ease infinite;
    box-shadow: 0 0 30px rgba(236, 72, 153, 0.3);
}

.btn-pro:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 40px rgba(236, 72, 153, 0.4);
}

.btn-pro-plus {
    background: var(--pro-plus-gradient);
    color: var(--white);
    box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
}

.btn-demo {
    background: var(--demo-gradient);
    color: var(--white);
    animation: gradientMove 3s ease infinite;
    background-size: 200% 200%;
}

.btn-outline {
    background: transparent;
    color: var(--white);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.btn-outline:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--primary);
    transform: translateY(-2px);
}

.btn-glass {
    background: var(--bg-glass);
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
}

.btn-glass:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.btn-large {
    padding: 16px 32px;
    font-size: 16px;
}

.btn-small {
    padding: 8px 16px;
    font-size: 12px;
}

.btn-block {
    width: 100%;
}

.btn-icon {
    width: 48px;
    height: 48px;
    padding: 0;
    border-radius: var(--radius-full);
    font-size: 20px;
}

/* ===== CARD COMPONENTS ===== */
.card {
    background: var(--bg-card);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-2xl);
    padding: 24px;
    backdrop-filter: blur(20px);
    transition: all var(--transition);
}

.card:hover {
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.card-glass {
    background: var(--bg-glass);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-2xl);
    padding: 24px;
    backdrop-filter: blur(20px);
}

/* ===== HOME PAGE ===== */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin: 32px 0;
}

.action-card {
    background: var(--bg-card);
    border-radius: var(--radius-2xl);
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: all var(--transition);
}

.action-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-glow);
}

.action-card i {
    font-size: 32px;
    margin-bottom: 12px;
}

.action-card.primary i { color: var(--primary); }
.action-card.blue i { color: var(--card-blue); }
.action-card.pink i { color: var(--card-pink); }
.action-card.gold i { color: var(--accent-gold); }

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 20px 0;
}

.stat-card {
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 16px;
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 12px;
    color: var(--gray-400);
}

/* ===== EVENTS PAGE WITH MAP DRAWER ===== */
.events-container {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
    z-index: 10;
    background: var(--bg-primary);
    transition: transform 0.4s var(--map-drawer-transition);
    transform: translateY(0);
    overflow: hidden;
}

.events-container.dragging {
    transition: none;
}

.map-drawer {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 5;
    background: var(--bg-primary);
}

.map-container {
    width: 100%;
    height: 100%;
    background: var(--bg-tertiary);
}

#map {
    width: 100%;
    height: 100%;
}

.events-header {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: var(--bg-primary);
}

.events-list {
    height: calc(100% - 80px);
    overflow-y: auto;
    padding: 20px;
}

.event-card-list {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(90deg, transparent, var(--bg-card));
    border-radius: var(--radius-xl);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 12px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.event-card-list::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 100px;
    background: linear-gradient(90deg, rgba(139, 92, 246, 0.2), transparent);
    z-index: 0;
}

.event-card-image {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
}

.event-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.event-card-content {
    flex: 1;
    position: relative;
    z-index: 1;
}

.map-handle {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-primary);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 20;
    cursor: grab;
}

.map-handle:active {
    cursor: grabbing;
}

.map-handle-bar {
    width: 40px;
    height: 4px;
    background: var(--gray-600);
    border-radius: 2px;
}

/* ===== CONNECT (SWIPE) PAGE ===== */
.swipe-interface {
    height: calc(100vh - var(--header-height) - var(--bottom-nav-height));
    display: flex;
    flex-direction: column;
}

.swipe-header {
    padding: 20px;
}

.card-stack {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
}

.card-container {
    width: 100%;
    max-width: 280px;
    aspect-ratio: 3/4;
    position: relative;
}

.profile-card {
    position: absolute;
    width: 100%;
    height: 100%;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s;
    cursor: grab;
    z-index: 1;
    border-radius: var(--radius-xl);
    overflow: hidden;
}

.profile-card:active {
    cursor: grabbing;
}

.card-content {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-card-stack);
}

.card-frame {
    position: absolute;
    width: 110%;
    height: 110%;
    top: -8%;
    left: -5%;
    background: var(--accent-gold);
    border-radius: var(--radius-xl);
    transform: rotate(-3deg);
    z-index: -1;
    box-shadow: var(--shadow-gold);
}

.profile-image {
    width: 85%;
    aspect-ratio: 1/1;
    margin: 24px auto 0;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    background-size: cover;
    background-position: center;
    position: relative;
}

.profile-info {
    padding: 20px 24px;
    text-align: center;
}

.profile-info h2 {
    font-size: 1.5rem;
    margin-bottom: 4px;
    color: var(--gray-800);
    font-weight: 700;
    letter-spacing: -0.02em;
}

.profile-info p {
    font-size: 13px;
    color: var(--gray-600);
    margin-bottom: 16px;
    line-height: 1.5;
}

.interests {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-bottom: 20px;
}

.interest-tag {
    font-size: 11px;
    padding: 4px 10px;
    border-radius: 12px;
    background: rgba(28, 28, 30, 0.08);
    color: var(--gray-600);
    font-weight: 600;
}

.swipe-actions {
    padding: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    z-index: 50;
}

.action-button {
    width: 72px;
    height: 72px;
    border-radius: var(--radius-full);
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: transform 0.2s;
    background: var(--gray-900);
    color: var(--white);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.action-button:hover {
    transform: scale(1.05);
}

.action-button:active {
    transform: scale(0.95);
}

.action-button.undo {
    width: 64px;
    height: 64px;
    font-size: 20px;
    background: var(--gray-400);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
}

.action-button.like {
    width: 80px;
    height: 80px;
    background: var(--card-pink);
    color: var(--white);
    font-weight: bold;
    box-shadow: 0 10px 30px rgba(236, 72, 153, 0.5);
}

.action-button.like:hover {
    transform: scale(1.1);
}

/* ===== MATCHES/CHAT PAGE ===== */
.matches-list {
    padding: 20px;
}

.match-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 12px;
    cursor: pointer;
    transition: all var(--transition);
}

.match-item:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.match-avatar {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-full);
    background-size: cover;
    background-position: center;
    border: 2px solid var(--primary);
}

.match-info {
    flex: 1;
}

.match-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
}

.status-online {
    color: var(--accent-green);
}

.status-away {
    color: var(--accent-yellow);
}

/* ===== CHAT INTERFACE ===== */
.chat-header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--bg-secondary);
}

.chat-avatar {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    background-size: cover;
    background-position: center;
}

.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.message {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
    animation: messageAppear 0.3s ease;
}

.message.sent {
    background: var(--primary);
    color: var(--white);
    align-self: flex-end;
    border-bottom-right-radius: 4px;
    border-radius: 18px 18px 4px 18px;
}

.message.received {
    background: var(--bg-tertiary);
    color: var(--white);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
    border-radius: 18px 18px 18px 4px;
}

.message-time {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 4px;
    text-align: right;
}

.chat-input {
    padding: 16px 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    gap: 12px;
    background: var(--bg-secondary);
}

/* ===== PROFILE PAGE ===== */
.profile-header {
    text-align: center;
    padding: 20px;
}

.avatar {
    width: 100px;
    height: 100px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    margin: 0 auto 16px;
    position: relative;
    overflow: hidden;
    border: 3px solid var(--bg-primary);
    background-size: cover;
    background-position: center;
}

.avatar.pro {
    border: 3px solid transparent;
    border-image: var(--pro-gradient) 1;
}

.avatar.pro-plus {
    border: 3px solid transparent;
    border-image: var(--pro-plus-gradient) 1;
}

/* ===== FORMS ===== */
.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    color: var(--gray-300);
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 14px 16px;
    background: var(--bg-tertiary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    color: var(--white);
    font-size: 16px;
    transition: all var(--transition-fast);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-glow);
}

/* ===== BADGES ===== */
.pro-badge {
    background: var(--pro-gradient);
    color: white;
    padding: 6px 16px;
    border-radius: var(--radius-full);
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.pro-plus-badge {
    background: var(--pro-plus-gradient);
    color: white;
    padding: 6px 16px;
    border-radius: var(--radius-full);
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.free-badge {
    background: var(--bg-tertiary);
    color: var(--gray-400);
    padding: 6px 16px;
    border-radius: var(--radius-full);
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.live-badge {
    background: var(--accent-green);
    color: white;
    padding: 6px 12px;
    border-radius: var(--radius-full);
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    animation: pulse 2s infinite;
}

/* ===== TICKET BOX ===== */
.tabs {
    display: flex;
    background: var(--bg-tertiary);
    border-radius: var(--radius);
    padding: 4px;
    margin-bottom: 24px;
}

.tab-button {
    flex: 1;
    padding: 12px;
    text-align: center;
    background: none;
    border: none;
    color: var(--gray-400);
    font-weight: 600;
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.tab-button.active {
    background: var(--primary);
    color: var(--white);
}

.tab-content {
    display: block;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

.ticket-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.ticket-qr {
    width: 80px;
    height: 80px;
    background: white;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: black;
    font-weight: bold;
}

/* ===== MODALS ===== */
.pro-modal, .match-modal, .filters-modal, .ticket-modal, .event-wizard-modal,
.chat-modal, .settings-modal, .currency-modal, .ticket-purchase-modal,
.emergency-modal, .report-modal, .analytics-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(10px);
}

.modal-content {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: var(--radius-2xl);
    padding: 32px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== WIZARD ===== */
.wizard-progress {
    display: flex;
    justify-content: space-between;
    position: relative;
}

.wizard-progress::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 10%;
    right: 10%;
    height: 2px;
    background: var(--gray-700);
    z-index: 1;
}

.progress-step {
    position: relative;
    z-index: 2;
    background: var(--bg-tertiary);
    padding: 8px 12px;
    border-radius: var(--radius);
    font-size: 12px;
    font-weight: 600;
    color: var(--gray-400);
}

.progress-step.active {
    background: var(--primary);
    color: white;
}

.wizard-step {
    display: none;
}

.wizard-step.active {
    display: block;
}

.wizard-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 32px;
}

/* ===== SETTINGS ===== */
.settings-section {
    margin-bottom: 24px;
}

.settings-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    margin-bottom: 8px;
    cursor: pointer;
    transition: all var(--transition);
}

.settings-option:hover {
    background: var(--bg-tertiary);
}

.settings-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

/* ===== NOTIFICATIONS ===== */
.notifications-dropdown {
    position: fixed;
    top: var(--header-height);
    right: 20px;
    width: 320px;
    max-height: 400px;
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    display: none;
    flex-direction: column;
    backdrop-filter: blur(20px);
}

.notifications-header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notifications-list {
    overflow-y: auto;
    max-height: 300px;
}

.notification-item {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    gap: 12px;
    transition: background var(--transition-fast);
    cursor: pointer;
}

.notification-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.notification-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
}

/* ===== ANALYTICS ===== */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin: 20px 0;
}

.analytics-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 16px;
    text-align: center;
}

.analytics-value {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 4px;
}

.analytics-label {
    font-size: 12px;
    color: var(--gray-400);
}

.analytics-chart {
    width: 100%;
    height: 200px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    margin: 20px 0;
    display: flex;
    align-items: flex-end;
    padding: 20px;
    gap: 4px;
}

.chart-bar {
    flex: 1;
    background: var(--primary);
    border-radius: 4px 4px 0 0;
    min-height: 20px;
    transition: height 0.3s ease;
}

/* ===== CUSTOM SCROLLBAR ===== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-light);
}

.scrollable-content:hover::-webkit-scrollbar-thumb {
    opacity: 1;
}

/* Hide scrollbar by default, show on hover */
* {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

*:hover {
    scrollbar-color: var(--primary) transparent;
}

/* ===== ENHANCED MAP DRAWER ===== */
.events-container {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
    z-index: 10;
    background: var(--bg-primary);
    transition: transform 0.4s var(--map-drawer-transition);
    transform: translateY(0);
    overflow: hidden;
    border-radius: 24px 24px 0 0;
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.3);
}

.events-container.dragging {
    transition: none;
}

.events-container.full-map {
    transform: translateY(calc(100% - 80px));
}

.events-container.hybrid {
    transform: translateY(50%);
}

/* ===== ENHANCED HOME PAGE STYLES ===== */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 32px 0 16px;
}

.events-carousel {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding: 8px 4px 16px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.events-carousel::-webkit-scrollbar {
    display: none;
}

.event-card-featured {
    flex: 0 0 280px;
    background: var(--bg-card);
    border-radius: var(--radius-2xl);
    overflow: hidden;
    scroll-snap-align: start;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all var(--transition);
    cursor: pointer;
    position: relative;
}

.event-card-featured:hover {
    transform: translateY(-4px);
    border-color: var(--primary);
    box-shadow: var(--shadow-glow);
}

.event-card-featured .event-card-image {
    width: 100%;
    height: 160px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.event-card-overlay {
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.event-card-featured .event-card-content {
    padding: 16px;
}

.bookmark-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-full);
    background: rgba(0, 0, 0, 0.7);
    border: none;
    color: var(--gray-400);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition);
    z-index: 2;
}

.bookmark-btn:hover {
    background: rgba(0, 0, 0, 0.9);
    color: var(--white);
}

.bookmark-btn.active {
    color: var(--accent-gold);
    background: rgba(245, 222, 179, 0.2);
}

.bookmark-btn.active:hover {
    background: rgba(245, 222, 179, 0.3);
}

.bookmarked-events {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* ===== ENHANCED EVENTS PAGE SEARCH ===== */
.search-container {
    position: relative;
    width: 100%;
}

.search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.search-input-wrapper i {
    position: absolute;
    left: 16px;
    color: var(--gray-400);
    z-index: 1;
}

.search-input {
    width: 100%;
    padding: 14px 16px 14px 44px;
    background: var(--bg-tertiary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    color: var(--white);
    font-size: 16px;
    transition: all var(--transition);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-glow);
}

.clear-search {
    position: absolute;
    right: 12px;
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    padding: 8px;
    border-radius: var(--radius-full);
    transition: all var(--transition);
}

.clear-search:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
}

.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 8px;
    z-index: 100;
    display: none;
    max-height: 300px;
    overflow-y: auto;
}

.search-result-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: background var(--transition);
    display: flex;
    align-items: center;
    gap: 12px;
}

.search-result-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.search-result-item i {
    color: var(--primary);
}

/* ===== ENHANCED MAP HEADER ===== */
.map-header {
    padding: 16px 20px;
    background: var(--bg-primary);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* ===== ENHANCED SWIPE ACTIONS ===== */
.swipe-actions {
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    z-index: 50;
}

.action-button {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-full);
    border: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: all var(--transition);
    color: var(--white);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.action-button span {
    font-size: 12px;
    margin-top: 4px;
    font-weight: 600;
}

.action-button.nope {
    background: var(--accent-red);
}

.action-button.rewind {
    background: var(--gray-600);
    width: 70px;
    height: 70px;
    font-size: 20px;
}

.action-button.rewind:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.action-button.refresh {
    background: var(--accent-blue);
    width: 70px;
    height: 70px;
    font-size: 20px;
}

.action-button.like {
    background: var(--card-pink);
}

.action-button:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
}

.action-button:active:not(:disabled) {
    transform: scale(0.95);
}

.stats-row {
    display: flex;
    justify-content: space-around;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 12px;
    margin-top: 16px;
}

.stat {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    color: var(--gray-300);
}

.stat i {
    color: var(--primary);
}

/* ===== CHECK-IN FLOW MODALS ===== */
.privacy-choice-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(10px);
}

.privacy-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.privacy-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition);
}

.privacy-option:hover {
    border-color: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
}

.privacy-option.public:hover {
    border-color: var(--primary);
}

.privacy-option.private:hover {
    border-color: var(--gray-500);
}

.privacy-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.privacy-option.public .privacy-icon {
    background: rgba(139, 92, 246, 0.2);
    color: var(--primary);
}

.privacy-option.private .privacy-icon {
    background: rgba(100, 116, 139, 0.2);
    color: var(--gray-400);
}

.privacy-info {
    flex: 1;
}

.privacy-badge {
    opacity: 0;
    color: var(--primary);
    transition: opacity var(--transition);
}

.privacy-option:hover .privacy-badge {
    opacity: 1;
}

.qr-scan-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
    pointer-events: none;
}

.qr-frame {
    width: 200px;
    height: 200px;
    border: 2px solid var(--primary);
    border-radius: var(--radius);
    position: relative;
}

.qr-frame::before,
.qr-frame::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    border: 3px solid var(--primary);
}

.qr-frame::before {
    top: -3px;
    left: -3px;
    border-right: none;
    border-bottom: none;
}

.qr-frame::after {
    bottom: -3px;
    right: -3px;
    border-left: none;
    border-top: none;
}

.qr-instruction {
    margin-top: 20px;
    color: var(--white);
    font-weight: 500;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/* ===== EVENT WIZARD ENHANCEMENTS ===== */
.location-search {
    position: relative;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 8px;
    z-index: 100;
    display: none;
    max-height: 200px;
    overflow-y: auto;
}

.geofence-slider {
    margin-top: 8px;
}

.range-value {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 14px;
    color: var(--gray-300);
}

.range-slider {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--bg-tertiary);
    outline: none;
    -webkit-appearance: none;
}

.range-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    border: 3px solid var(--white);
    box-shadow: var(--shadow);
}

.range-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    border: 3px solid var(--white);
    box-shadow: var(--shadow);
}

/* ===== RESPONSIVE ENHANCEMENTS ===== */
@media (max-width: 480px) {
    .event-card-featured {
        flex: 0 0 260px;
    }
    
    .action-button {
        width: 70px;
        height: 70px;
        font-size: 20px;
    }
    
    .action-button.rewind,
    .action-button.refresh {
        width: 60px;
        height: 60px;
        font-size: 18px;
    }
    
    .stats-row {
        font-size: 12px;
    }
    
    .privacy-option {
        padding: 16px;
    }
    
    .privacy-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.pulse {
    animation: pulse 2s infinite;
}

@keyframes slideInFromRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.slide-in-right {
    animation: slideInFromRight 0.3s ease;
}

.map-drawer {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 5;
    background: var(--bg-primary);
    pointer-events: none;
}

.map-container {
    width: 100%;
    height: 100%;
    background: var(--bg-tertiary);
    pointer-events: all;
}

#map {
    width: 100%;
    height: 100%;
}

.events-header {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: var(--bg-primary);
    border-radius: 24px 24px 0 0;
}

.events-list {
    height: calc(100% - 120px);
    overflow-y: auto;
    padding: 20px;
    scrollbar-color: var(--primary) transparent;
}

.event-card-list {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: linear-gradient(90deg, transparent, var(--bg-card));
    border-radius: var(--radius-xl);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 12px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all var(--transition);
}

.event-card-list:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.event-card-list::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 100px;
    background: linear-gradient(90deg, rgba(139, 92, 246, 0.2), transparent);
    z-index: 0;
}

.event-card-image {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
}

.event-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.event-card-content {
    flex: 1;
    position: relative;
    z-index: 1;
}

.map-handle {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-primary);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 20;
    cursor: grab;
    border-radius: 24px 24px 0 0;
}

.map-handle:active {
    cursor: grabbing;
}

.map-handle-bar {
    width: 40px;
    height: 4px;
    background: var(--gray-600);
    border-radius: 2px;
    transition: all var(--transition);
}

.map-handle:hover .map-handle-bar {
    background: var(--primary);
    width: 60px;
}

/* Map markers */
.event-marker {
    background: white;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    border: 3px solid var(--primary);
    cursor: pointer;
    transition: all var(--transition);
}

.event-marker:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
}

.event-marker i {
    color: var(--primary);
    font-size: 18px;
}

/* Map popup */
.mapboxgl-popup {
    max-width: 200px;
}

.mapboxgl-popup-content {
    background: var(--bg-card);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-lg);
    padding: 16px;
    color: var(--white);
}

.mapboxgl-popup-content h3 {
    color: var(--white);
    margin-bottom: 8px;
    font-size: 16px;
}

.mapboxgl-popup-content p {
    color: var(--gray-400);
    margin-bottom: 4px;
    font-size: 14px;
}

.mapboxgl-popup-content button {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: var(--radius);
    cursor: pointer;
    margin-top: 8px;
    width: 100%;
    font-weight: 600;
}

.mapboxgl-popup-close-button {
    color: var(--white);
    font-size: 16px;
    padding: 4px 8px;
}

/* ===== SNAP POINTS INDICATOR ===== */
.snap-points {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
    z-index: 25;
    pointer-events: none;
}

.snap-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transition: all var(--transition);
}

.snap-dot.active {
    background: var(--primary);
    transform: scale(1.2);
}

/* ===== ANIMATIONS ===== */
@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

@keyframes messageAppear {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideIn {
    from {
        transform: translateX(100px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* ===== SWITCH ===== */
.switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 26px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--gray-700);
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--primary);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 480px) {
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    .hero h1 {
        font-size: 2.5rem;
    }
    
    .content {
        padding: calc(var(--header-height) + 16px) 16px 16px;
    }
    
    .navbar {
        padding: 0 16px;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .features-grid {
        grid-template-columns: 1fr;
    }
    
    .notifications-dropdown {
        width: calc(100% - 32px);
        right: 16px;
    }
}

@supports (padding: max(0px)) {
    .bottom-nav {
        padding-bottom: max(var(--safe-area-inset-bottom), 20px);
    }
}
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- Navigation will be injected here -->
        <div class="content" id="content">
            <!-- Content will be dynamically loaded here -->
        </div>
        
        <!-- Bottom Navigation will be injected here -->
        <div id="bottomNav"></div>
    </div>

    <!-- ===== MODALS ===== -->
    
    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <div class="camera-container">
            <div class="camera-preview">
                <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                <div class="camera-overlay"></div>
                <div class="live-badge" style="position: absolute; top: 16px; right: 16px;">
                    <i class="fas fa-camera"></i>
                    <span>LIVE PHOTO</span>
                </div>
            </div>
            <div class="camera-controls">
                <button class="btn btn-outline" onclick="closeCamera()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="camera-btn" onclick="takePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
                <button class="btn btn-outline" onclick="switchCamera()">
                    <i class="fas fa-sync-alt"></i> Flip
                </button>
            </div>
        </div>
    </div>

    <!-- Pro Upgrade Modal -->
    <div class="pro-modal" id="proModal">
        <div class="modal-content">
            <div class="text-center mb-6">
                <div class="pro-badge mb-4" style="font-size: 14px; padding: 8px 16px;">
                    <i class="fas fa-crown"></i>
                    <span>UPGRADE TO PRO</span>
                </div>
                <h2 class="pro-gradient">Unlock Premium Features</h2>
                <p class="mt-2">Get unlimited swipes, create events, and more!</p>
            </div>

            <div class="flex flex-col gap-4 mb-6">
                <div class="card-glass">
                    <h4 class="mb-2">Unlimited Daily Swipes</h4>
                    <p class="text-gray-400">Free users limited to 30 swipes/day per event</p>
                </div>
                
                <div class="card-glass">
                    <h4 class="mb-2">Create Unlimited Events</h4>
                    <p class="text-gray-400">Free users can create 3 events/month</p>
                </div>
                
                <div class="card-glass">
                    <h4 class="mb-2">See Who Liked You</h4>
                    <p class="text-gray-400">Free users can't see who liked them</p>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="mb-4 text-center">Choose Plan</h4>
                <div class="flex flex-col gap-3">
                    <div class="pricing-card">
                        <div class="free-badge mb-4">FREE</div>
                        <h3 class="text-center mb-2">$0/month</h3>
                        <p class="text-center text-gray-400 mb-4">Basic features</p>
                        <div class="flex flex-col gap-2 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Join unlimited events</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>10 likes/day</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-times text-gray-500"></i>
                                <span class="text-gray-400">Create events</span>
                            </div>
                        </div>
                        <button class="btn btn-outline btn-block" onclick="showNotification('You\\'re already on Free plan', 'info')">
                            Current Plan
                        </button>
                    </div>
                    
                    <div class="pricing-card featured">
                        <div class="pro-badge mb-4">PRO</div>
                        <h3 class="text-center mb-2 pro-gradient">$14.98/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $143.76/year (save 20%)</p>
                        <div class="flex flex-col gap-2 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Everything in Free</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>Unlimited likes</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>5 events/month</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-green-500"></i>
                                <span>See who liked you</span>
                            </div>
                        </div>
                        <button class="btn btn-pro btn-block" onclick="upgradeToPro()">
                            <i class="fas fa-crown"></i> Upgrade Now
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="pro-plus-badge mb-4">MAX</div>
                        <h3 class="text-center mb-2 pro-plus-gradient">$52.98/month</h3>
                        <p class="text-center text-gray-400 mb-4">or $508.60/year (save 20%)</p>
                        <div class="flex flex-col gap-2 mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>All Pro features</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Unlimited events</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Featured placement</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-yellow-500"></i>
                                <span>Advanced analytics</span>
                            </div>
                        </div>
                        <button class="btn btn-pro-plus btn-block" onclick="upgradeToMax()">
                            <i class="fas fa-star"></i> Upgrade to Max
                        </button>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-glass btn-block mt-4" onclick="closeProModal()">
                Maybe Later
            </button>
        </div>
    </div>

    <!-- Match Modal -->
    <div class="match-modal" id="matchModal">
        <div class="modal-content">
            <div class="match-images">
                <div class="match-avatar" id="userAvatar"></div>
                <div class="flex items-center">
                    <i class="fas fa-bolt" style="font-size: 32px; color: var(--primary);"></i>
                </div>
                <div class="match-avatar" id="matchAvatar"></div>
            </div>
            <h2>It's a Match!</h2>
            <p class="mt-2" id="matchMessage"></p>
            <div class="flex flex-col gap-3 mt-4">
                <button class="btn btn-primary" onclick="startChat()">
                    <i class="fas fa-comment"></i> Send Message
                </button>
                <button class="btn btn-outline" onclick="closeMatchModal()">
                    Keep Swiping
                </button>
            </div>
        </div>
    </div>

    <!-- Filters Modal -->
    <div class="filters-modal" id="filtersModal">
        <div class="modal-content">
            <h2 class="mb-6">Filters</h2>
            
            <div class="filter-section">
                <h4 class="mb-4">Distance</h4>
                <div class="range-value">
                    <span>0 km</span>
                    <span id="distanceValue">50 km</span>
                    <span>100 km</span>
                </div>
                <input type="range" class="range-slider" id="distanceSlider" min="0" max="100" value="50" oninput="updateDistanceValue(this.value)">
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Age Range</h4>
                <div class="range-value">
                    <span>18</span>
                    <span id="ageValue">18-35</span>
                    <span>60</span>
                </div>
                <div class="flex gap-3">
                    <input type="number" class="form-control" id="ageMin" value="18" min="18" max="60" onchange="updateAgeRange()">
                    <span>to</span>
                    <input type="number" class="form-control" id="ageMax" value="35" min="18" max="60" onchange="updateAgeRange()">
                </div>
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Gender</h4>
                <div class="flex gap-3">
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'all')" id="genderAll">All</button>
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'male')" id="genderMale">Men</button>
                    <button class="btn btn-outline flex-1" onclick="toggleFilter('gender', 'female')" id="genderFemale">Women</button>
                </div>
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Interests</h4>
                <div class="flex flex-wrap gap-2">
                    <span class="interest-tag filter-interest" onclick="toggleInterest('music')">Music</span>
                    <span class="interest-tag filter-interest" onclick="toggleInterest('tech')">Tech</span>
                    <span class="interest-tag filter-interest" onclick="toggleInterest('art')">Art</span>
                    <span class="interest-tag filter-interest" onclick="toggleInterest('sports')">Sports</span>
                    <span class="interest-tag filter-interest" onclick="toggleInterest('food')">Food</span>
                    <span class="interest-tag filter-interest" onclick="toggleInterest('travel')">Travel</span>
                </div>
            </div>
            
            <div class="filter-section">
                <h4 class="mb-4">Verification</h4>
                <div class="filter-option">
                    <span>Verified Only</span>
                    <label class="switch">
                        <input type="checkbox" id="verifiedOnly">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="flex gap-3 mt-8">
                <button class="btn btn-outline flex-1" onclick="closeFilters()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="applyFilters()">
                    Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Ticket Box Modal -->
    <div class="ticket-modal" id="ticketModal">
        <div class="modal-content">
            <h2 class="mb-4">Ticket Box</h2>
            
            <div class="tabs mb-6">
                <button class="tab-button active" onclick="switchTicketTab('active')" id="ticketActiveTab">
                    Active Tickets
                </button>
                <button class="tab-button" onclick="switchTicketTab('purchase')" id="ticketPurchaseTab">
                    Purchase
                </button>
                <button class="tab-button" onclick="switchTicketTab('history')" id="ticketHistoryTab">
                    History
                </button>
            </div>
            
            <div class="tab-content">
                <div id="activeTicketsTab" class="tab-pane active">
                    <div id="activeTicketsList">
                        <!-- Active tickets will be loaded here -->
                    </div>
                    <button class="btn btn-primary btn-block mt-4" onclick="switchTicketTab('purchase')">
                        <i class="fas fa-plus"></i> Get More Tickets
                    </button>
                </div>
                
                <div id="purchaseTicketsTab" class="tab-pane">
                    <div id="availableTicketsList">
                        <!-- Available tickets will be loaded here -->
                    </div>
                </div>
                
                <div id="ticketHistoryTab" class="tab-pane">
                    <div id="ticketHistoryList">
                        <!-- Ticket history will be loaded here -->
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline btn-block mt-4" onclick="closeTicketModal()">
                Close
            </button>
        </div>
    </div>

    <!-- Event Wizard Modal -->
    <div class="event-wizard-modal" id="eventWizardModal">
        <div class="modal-content">
            <div class="wizard-progress mb-6">
                <div class="progress-step active" data-step="1">1. Basic Info</div>
                <div class="progress-step" data-step="2">2. Details</div>
                <div class="progress-step" data-step="3">3. Tickets</div>
                <div class="progress-step" data-step="4">4. Theme</div>
            </div>
            
            <div class="wizard-step active" id="wizardStep1">
                <h2 class="mb-4">Create Event</h2>
                <div class="form-group">
                    <label class="form-label">Event Name</label>
                    <input type="text" class="form-control" id="eventName" placeholder="Tech Mixer Afterparty">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="eventDescription" rows="3" placeholder="Describe your event..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="eventCategory">
                        <option value="tech">Technology</option>
                        <option value="art">Art & Culture</option>
                        <option value="music">Music</option>
                        <option value="sports">Sports</option>
                        <option value="food">Food & Drink</option>
                        <option value="networking">Networking</option>
                    </select>
                </div>
                <div class="wizard-navigation">
                    <button class="btn btn-outline" onclick="closeEventWizard()">Cancel</button>
                    <button class="btn btn-primary" onclick="nextWizardStep()">Next</button>
                </div>
            </div>
            
            <div class="wizard-step" id="wizardStep2">
                <h2 class="mb-4">Event Details</h2>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" id="eventLocation" placeholder="123 Main St, San Francisco">
                </div>
                <div class="form-group">
                    <label class="form-label">Date & Time</label>
                    <div class="flex gap-3">
                        <input type="date" class="form-control flex-1" id="eventDate">
                        <input type="time" class="form-control flex-1" id="eventTime">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Capacity</label>
                    <input type="number" class="form-control" id="eventCapacity" value="100" min="1" max="1000">
                </div>
                <div class="wizard-navigation">
                    <button class="btn btn-outline" onclick="prevWizardStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextWizardStep()">Next</button>
                </div>
            </div>
            
            <div class="wizard-step" id="wizardStep3">
                <h2 class="mb-4">Ticket Setup</h2>
                <div class="form-group">
                    <label class="form-label">Ticket Type</label>
                    <select class="form-control" id="ticketType">
                        <option value="free">Free</option>
                        <option value="paid">Paid</option>
                    </select>
                </div>
                <div class="form-group" id="priceGroup" style="display: none;">
                    <label class="form-label">Price ($)</label>
                    <input type="number" class="form-control" id="ticketPrice" min="0" step="0.01" placeholder="25.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Available Tickets</label>
                    <input type="number" class="form-control" id="availableTickets" value="100" min="1">
                </div>
                <div class="wizard-navigation">
                    <button class="btn btn-outline" onclick="prevWizardStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextWizardStep()">Next</button>
                </div>
            </div>
            
            <div class="wizard-step" id="wizardStep4">
                <h2 class="mb-4">Customization</h2>
                <div class="customization-preview" id="eventThemePreview">
                    Your Event Theme
                </div>
                <div class="color-picker">
                    <div class="color-option active" style="background: #8B5CF6;" onclick="selectEventColor('#8B5CF6')"></div>
                    <div class="color-option" style="background: #EC4899;" onclick="selectEventColor('#EC4899')"></div>
                    <div class="color-option" style="background: #3B82F6;" onclick="selectEventColor('#3B82F6')"></div>
                    <div class="color-option" style="background: #10B981;" onclick="selectEventColor('#10B981')"></div>
                    <div class="color-option" style="background: #F59E0B;" onclick="selectEventColor('#F59E0B')"></div>
                </div>
                <div class="wizard-navigation">
                    <button class="btn btn-outline" onclick="prevWizardStep()">Back</button>
                    <button class="btn btn-primary" onclick="createEventFinal()">Create Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Dropdown -->
    <div class="notifications-dropdown" id="notificationsDropdown">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <button class="btn btn-outline btn-small" onclick="markAllAsRead()">
                <i class="fas fa-check-double"></i> Mark all read
            </button>
        </div>
        <div class="notifications-list" id="notificationsList">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <!-- Chat Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="modal-content" style="height: 80vh; display: flex; flex-direction: column;">
            <div class="chat-header" id="chatHeader">
                <!-- Chat header will be loaded here -->
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be loaded here -->
            </div>
            
            <div class="chat-input">
                <input type="text" class="form-control" id="messageInput" placeholder="Type a message..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button class="btn btn-primary btn-icon" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="modal-content">
            <h2 class="mb-6">Settings</h2>
            
            <div class="settings-section">
                <h3 class="mb-4">Account</h3>
                <div class="settings-option" onclick="navigateTo('edit-profile')">
                    <div class="settings-info">
                        <i class="fas fa-user"></i>
                        <span>Edit Profile</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-option" onclick="changeEmail()">
                    <div class="settings-info">
                        <i class="fas fa-envelope"></i>
                        <span>Change Email</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-option" onclick="changePassword()">
                    <div class="settings-info">
                        <i class="fas fa-lock"></i>
                        <span>Change Password</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="mb-4">Preferences</h3>
                <div class="settings-option">
                    <div class="settings-info">
                        <i class="fas fa-palette"></i>
                        <span>Theme</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="themeToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="settings-option" onclick="showCurrencySelector()">
                    <div class="settings-info">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Currency</span>
                    </div>
                    <span id="currentCurrency">USD</span>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-option">
                    <div class="settings-info">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="notificationsToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="mb-4">Privacy & Safety</h3>
                <div class="settings-option" onclick="navigateTo('privacy-settings')">
                    <div class="settings-info">
                        <i class="fas fa-shield-alt"></i>
                        <span>Privacy Settings</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-option" onclick="showBlockedUsers()">
                    <div class="settings-info">
                        <i class="fas fa-user-slash"></i>
                        <span>Blocked Users</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                
                <div class="settings-option" onclick="setupEmergencyContact()">
                    <div class="settings-info">
                        <i class="fas fa-phone-alt"></i>
                        <span>Emergency Contact</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-option" onclick="logout()">
                    <div class="settings-info">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="text-red-400">Sign Out</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Currency Selector Modal -->
    <div class="currency-modal" id="currencyModal">
        <div class="modal-content">
            <h2 class="mb-6">Select Currency</h2>
            <div class="currency-list" id="currencyList">
                <!-- Currency options will be loaded here -->
            </div>
            <button class="btn btn-outline btn-block mt-4" onclick="closeCurrencyModal()">
                Cancel
            </button>
        </div>
    </div>

    <!-- Ticket Purchase Modal -->
    <div class="ticket-purchase-modal" id="ticketPurchaseModal">
        <div class="modal-content">
            <h2 class="mb-4">Purchase Ticket</h2>
            <div id="ticketPurchaseDetails">
                <!-- Ticket details will be loaded here -->
            </div>
            <div class="form-group mt-4">
                <label class="form-label">Quantity</label>
                <div class="quantity-selector">
                    <button class="quantity-btn" onclick="updateTicketQuantity(-1)">-</button>
                    <input type="number" class="form-control text-center" id="ticketQuantity" value="1" min="1" max="10">
                    <button class="quantity-btn" onclick="updateTicketQuantity(1)">+</button>
                </div>
            </div>
            <div class="total-price mt-4">
                <span>Total:</span>
                <span id="ticketTotalPrice">$0.00</span>
            </div>
            <div class="flex gap-3 mt-8">
                <button class="btn btn-outline flex-1" onclick="closeTicketPurchaseModal()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="processTicketPayment()">
                    Purchase
                </button>
            </div>
        </div>
    </div>

    <!-- Emergency Contact Modal -->
    <div class="emergency-modal" id="emergencyModal">
        <div class="modal-content">
            <h2 class="mb-6">Emergency Contact</h2>
            <p class="text-gray-400 mb-6">Add a trusted contact for safety</p>
            
            <div class="form-group">
                <label class="form-label">Contact Name</label>
                <input type="text" class="form-control" id="emergencyName" placeholder="Enter contact name">
            </div>
            
            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="emergencyPhone" placeholder="+1 (555) 123-4567">
            </div>
            
            <div class="form-group">
                <label class="form-label">Relationship</label>
                <input type="text" class="form-control" id="emergencyRelationship" placeholder="Friend, Family, etc.">
            </div>
            
            <div class="flex gap-3 mt-8">
                <button class="btn btn-outline flex-1" onclick="closeEmergencyModal()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="saveEmergencyContact()">
                    Save Contact
                </button>
            </div>
        </div>
    </div>

    <!-- Report User Modal -->
    <div class="report-modal" id="reportModal">
        <div class="modal-content">
            <h2 class="mb-6">Report User</h2>
            
            <div class="form-group">
                <label class="form-label">Reason for Report</label>
                <select class="form-control" id="reportReason">
                    <option value="">Select a reason</option>
                    <option value="spam">Spam or fake profile</option>
                    <option value="harassment">Harassment or bullying</option>
                    <option value="inappropriate">Inappropriate content</option>
                    <option value="safety">Safety concerns</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Additional Details (Optional)</label>
                <textarea class="form-control" id="reportDetails" rows="3" placeholder="Please provide any additional details..."></textarea>
            </div>
            
            <div class="flex gap-3 mt-8">
                <button class="btn btn-outline flex-1" onclick="closeReportModal()">
                    Cancel
                </button>
                <button class="btn btn-primary flex-1" onclick="submitReport()">
                    Submit Report
                </button>
            </div>
        </div>
    </div>

    <!-- Analytics Dashboard Modal -->
    <div class="analytics-modal" id="analyticsModal">
        <div class="modal-content">
            <h2 class="mb-6">Analytics Dashboard</h2>
            
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-value">1,245</div>
                    <div class="analytics-label">Profile Views</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">567</div>
                    <div class="analytics-label">Event Views</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">24%</div>
                    <div class="analytics-label">Match Rate</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">89%</div>
                    <div class="analytics-label">Response Rate</div>
                </div>
            </div>
            
            <div class="mt-6">
                <h4 class="mb-4">Monthly Engagement</h4>
                <div class="analytics-chart">
                    <div class="chart-bar" style="height: 40%;"></div>
                    <div class="chart-bar" style="height: 60%;"></div>
                    <div class="chart-bar" style="height: 80%;"></div>
                    <div class="chart-bar" style="height: 95%;"></div>
                    <div class="chart-bar" style="height: 75%;"></div>
                    <div class="chart-bar" style="height: 65%;"></div>
                </div>
            </div>
            
            <button class="btn btn-outline btn-block mt-6" onclick="closeAnalyticsModal()">
                Close
            </button>
        </div>
    </div>

    <!-- Script -->
    <script>
        // ===== CONFIGURATION =====
const MAPBOX_TOKEN = 'pk.eyJ1IjoianVzYSIsImEiOiJjbWpjanh5amEwbDEwM2dzOXVhbjZ5dzcwIn0.stWdbPHCrf9sKrRJRmShlg';
const NAMIBIA_COORDINATES = {
    windhoek: { lat: -22.5609, lng: 17.0658 },
    swakopmund: { lat: -22.6833, lng: 14.5333 },
    walvisBay: { lat: -22.9575, lng: 14.5053 },
    rundu: { lat: -17.9204, lng: 19.7492 },
    katimaMulilo: { lat: -17.5036, lng: 24.2756 }
};

// ===== ENHANCED MOCK DATA =====
const MOCK_PROFILES = [
    {
        id: 1,
        name: 'Nadia',
        age: 24,
        bio: 'Event Photographer & Dancer. Love capturing moments and moving to the beat.',
        interests: ['Photography', 'Dance', 'Art', 'Music'],
        eventId: 1,
        location: 'Main Stage',
        online: true,
        verified: true,
        cardColor: 'var(--card-purple)',
        livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23C4B5FD"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
        distance: '15m away',
        gender: 'female',
        isPublic: true,
        tempProfile: true
    },
    {
        id: 2,
        name: 'David',
        age: 28,
        bio: 'Tech Entrepreneur at Windhoek Startup Hub. Love connecting innovators.',
        interests: ['Technology', 'Startups', 'Networking', 'Coffee'],
        eventId: 1,
        location: 'VIP Lounge',
        online: true,
        verified: true,
        cardColor: 'var(--card-blue)',
        livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23BAE6FD"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
        distance: '25m away',
        gender: 'male',
        isPublic: true,
        tempProfile: true
    },
    {
        id: 3,
        name: 'Sarah',
        age: 26,
        bio: 'Environmental Activist & Yoga Instructor. Passionate about sustainability.',
        interests: ['Yoga', 'Environment', 'Wellness', 'Travel'],
        eventId: 2,
        location: 'Garden Area',
        online: false,
        verified: true,
        cardColor: 'var(--card-green)',
        livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23BBF7D0"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
        distance: '50m away',
        gender: 'female',
        isPublic: true,
        tempProfile: true
    },
    {
        id: 4,
        name: 'Michael',
        age: 32,
        bio: 'Chef & Food Blogger. Exploring Namibian cuisine fusion.',
        interests: ['Food', 'Cooking', 'Travel', 'Photography'],
        eventId: 1,
        location: 'Food Court',
        online: true,
        verified: false,
        cardColor: 'var(--card-orange)',
        livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23FECACA"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
        distance: '30m away',
        gender: 'male',
        isPublic: true,
        tempProfile: true
    },
    {
        id: 5,
        name: 'Lisa',
        age: 23,
        bio: 'Music Producer & DJ. Mixing traditional Namibian sounds with electronic.',
        interests: ['Music', 'DJ', 'Production', 'Festivals'],
        eventId: 3,
        location: 'DJ Booth',
        online: true,
        verified: true,
        cardColor: 'var(--card-pink)',
        livePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23FFC0D9"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>',
        distance: '45m away',
        gender: 'female',
        isPublic: true,
        tempProfile: true
    }
];

const MOCK_EVENTS = [
    {
        id: 1,
        name: 'Windhoek Tech Summit 2024',
        location: 'Windhoek Country Club Resort',
        address: '123 Luxury Street, Windhoek, Namibia',
        date: 'Tonight',
        time: '6:00 PM - 11:00 PM',
        attendees: 156,
        maxAttendees: 200,
        description: 'The premier tech networking event in Namibia. Connect with tech entrepreneurs, developers, and investors from across the country.',
        category: 'Tech Networking',
        coverImage: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=300&fit=crop',
        qrCode: 'AMPS_TECH_2024_001',
        radius: 100,
        organizerId: 1,
        coordinates: { lat: -22.5609, lng: 17.0658 },
        price: 150.00,
        currency: 'NAD',
        ageRange: '18-45',
        genderPreference: 'Everyone',
        tags: ['Tech', 'Networking', 'Startups', 'AI', 'Innovation'],
        bookmarked: true,
        rsvp: 'going',
        geoFencing: true,
        customTheme: '#8B5CF6',
        isFeatured: true,
        geofenceRadius: 100
    },
    {
        id: 2,
        name: 'Namibian Art & Culture Festival',
        location: 'National Theatre of Namibia',
        address: 'Robert Mugabe Ave, Windhoek, Namibia',
        date: 'Tomorrow',
        time: '5:00 PM - 10:00 PM',
        attendees: 89,
        maxAttendees: 150,
        description: 'Celebrate Namibian heritage through art exhibitions, traditional dance, and cultural performances.',
        category: 'Art & Culture',
        coverImage: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=600&h=300&fit=crop',
        qrCode: 'AMPS_ART_2024_002',
        radius: 80,
        organizerId: 2,
        coordinates: { lat: -22.5690, lng: 17.0836 },
        price: 80.00,
        currency: 'NAD',
        ageRange: '16+',
        genderPreference: 'Everyone',
        tags: ['Art', 'Culture', 'Heritage', 'Traditional', 'Exhibition'],
        bookmarked: true,
        rsvp: 'maybe',
        geoFencing: true,
        customTheme: '#EC4899',
        isFeatured: true,
        geofenceRadius: 80
    },
    {
        id: 3,
        name: 'Swakopmund Music Festival',
        location: 'Swakopmund Beach',
        address: 'Beach Road, Swakopmund, Namibia',
        date: 'Friday',
        time: '4:00 PM - 2:00 AM',
        attendees: 345,
        maxAttendees: 500,
        description: 'Beachside music festival featuring local and international artists. Three stages of non-stop music.',
        category: 'Music Festival',
        coverImage: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=600&h=300&fit=crop',
        qrCode: 'AMPS_MUSIC_2024_003',
        radius: 200,
        organizerId: 3,
        coordinates: { lat: -22.6833, lng: 14.5333 },
        price: 250.00,
        currency: 'NAD',
        ageRange: '18+',
        genderPreference: 'Everyone',
        tags: ['Music', 'Festival', 'Beach', 'DJ', 'Live'],
        bookmarked: false,
        rsvp: 'none',
        geoFencing: true,
        customTheme: '#3B82F6',
        isFeatured: false,
        geofenceRadius: 150
    },
    {
        id: 4,
        name: 'Startup Pitch Night Windhoek',
        location: 'Namibia Innovation Hub',
        address: 'Sam Nujoma Drive, Windhoek, Namibia',
        date: 'Saturday',
        time: '6:30 PM - 9:30 PM',
        attendees: 120,
        maxAttendees: 150,
        description: 'Watch emerging Namibian startups pitch to investors. Network with founders and VCs.',
        category: 'Startups',
        coverImage: 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=600&h=300&fit=crop',
        qrCode: 'AMPS_STARTUP_2024_004',
        radius: 75,
        organizerId: 4,
        coordinates: { lat: -22.5750, lng: 17.0800 },
        price: 100.00,
        currency: 'NAD',
        ageRange: '18+',
        genderPreference: 'Everyone',
        tags: ['Startups', 'Investing', 'Pitching', 'Entrepreneurship'],
        bookmarked: false,
        rsvp: 'none',
        geoFencing: false,
        customTheme: '#10B981',
        isFeatured: false,
        geofenceRadius: 50
    },
    {
        id: 5,
        name: 'Wellness & Yoga Retreat',
        location: 'Daan Viljoen Game Reserve',
        address: 'Windhoek, Namibia',
        date: 'Sunday',
        time: '7:00 AM - 12:00 PM',
        attendees: 65,
        maxAttendees: 100,
        description: 'Morning yoga, meditation, and wellness workshops in nature. Connect with like-minded health enthusiasts.',
        category: 'Health & Wellness',
        coverImage: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=600&h=300&fit=crop',
        qrCode: 'AMPS_WELLNESS_2024_005',
        radius: 60,
        organizerId: 5,
        coordinates: { lat: -22.5200, lng: 16.9800 },
        price: 120.00,
        currency: 'NAD',
        ageRange: '18+',
        genderPreference: 'Everyone',
        tags: ['Yoga', 'Meditation', 'Wellness', 'Nature', 'Health'],
        bookmarked: true,
        rsvp: 'going',
        geoFencing: true,
        customTheme: '#F59E0B',
        isFeatured: true,
        geofenceRadius: 200
    }
];

const CURRENCIES = [
    { code: 'NAD', symbol: 'N$', name: 'Namibian Dollar', conversionRate: 1 },
    { code: 'USD', symbol: '$', name: 'US Dollar', conversionRate: 0.055 },
    { code: 'EUR', symbol: '', name: 'Euro', conversionRate: 0.051 },
    { code: 'GBP', symbol: '', name: 'British Pound', conversionRate: 0.044 },
    { code: 'ZAR', symbol: 'R', name: 'South African Rand', conversionRate: 1 }
];

// ===== APP STATE =====
let state = {
    currentUser: null,
    currentPage: 'landing',
    currentEvent: null,
    currentMatch: null,
    swipeCount: 0,
    dailyLikes: 10,
    isPro: false,
    isMax: false,
    matches: [],
    events: MOCK_EVENTS,
    attendees: MOCK_PROFILES,
    cameraStream: null,
    facingMode: 'user',
    history: ['landing'],
    currentProfileIndex: 0,
    swipeHistory: [],
    lastMatch: null,
    chatMessages: {},
    userProfile: {
        name: 'Demo User',
        email: 'demo@amps.com',
        age: 28,
        occupation: 'Software Engineer',
        company: 'Tech Corp Namibia',
        bio: 'Passionate about technology and building meaningful connections at events in Namibia.',
        interests: ['Technology', 'Music', 'Travel', 'Fitness', 'Photography'],
        profilePhoto: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%238B5CF6"/><text x="100" y="120" font-size="24" text-anchor="middle" fill="white">User</text></svg>',
        phone: '+264 81 123 4567',
        location: 'Windhoek, Namibia',
        gender: 'male',
        visibility: 'public',
        bookmarkedEvents: [1, 2, 5]
    },
    superLikes: 1,
    rewindCount: 3,
    filters: {
        distance: 50,
        ageRange: { min: 18, max: 35 },
        gender: 'all',
        interests: [],
        verifiedOnly: false,
        searchQuery: ''
    },
    tickets: [],
    currency: 'NAD',
    notifications: [],
    map: null,
    mapDrawerOpen: false,
    mapDrawerPosition: 0,
    isDraggingMap: false,
    previousPage: null,
    eventSearchQuery: '',
    checkInFlow: {
        active: false,
        step: null,
        eventId: null,
        privacyChoice: null,
        livePhoto: null
    },
    mapMarkers: []
};

// ===== INITIALIZATION =====
function init() {
    loadState();
    restorePageState();
    renderPage();
    updateNavigation();
    
    // Initialize map when on events page
    if (state.currentPage === 'events') {
        setTimeout(() => {
            initMap();
            initMapDrawer();
            initEventSearch();
        }, 500);
    }
    
    // Show welcome notification
    if (!state.currentUser) {
        showNotification('Welcome to Amps! Connect at Namibian events.', 'info');
    }
    
    // Add scrollbar styling
    addScrollbarStyles();
}

function loadState() {
    const savedState = localStorage.getItem('amps_state');
    if (savedState) {
        const parsed = JSON.parse(savedState);
        state = { ...state, ...parsed };
    }
}

function saveState() {
    localStorage.setItem('amps_state', JSON.stringify(state));
}

function restorePageState() {
    const savedPage = localStorage.getItem('amps_current_page');
    if (savedPage && savedPage !== 'landing') {
        state.currentPage = savedPage;
        state.history = [savedPage];
    }
}

function savePageState() {
    localStorage.setItem('amps_current_page', state.currentPage);
}

// ===== ENHANCED ROUTER =====
function navigateTo(page) {
    state.previousPage = state.currentPage;
    state.history.push(state.currentPage);
    state.currentPage = page;
    savePageState();
    renderPage();
    updateNavigation();
    window.scrollTo(0, 0);
    saveState();
}

function goBack() {
    if (state.history.length > 1) {
        state.currentPage = state.history.pop();
        savePageState();
        renderPage();
        updateNavigation();
        window.scrollTo(0, 0);
    }
}

// ===== PAGE RENDERERS =====
function renderPage() {
    const content = document.getElementById('content');
    content.innerHTML = '';
    
    switch(state.currentPage) {
        case 'landing':
            renderLandingPage(content);
            break;
        case 'auth':
            renderAuthPage(content);
            break;
        case 'home':
            renderHomePage(content);
            break;
        case 'events':
            renderEventsPage(content);
            break;
        case 'connect':
            renderConnectPage(content);
            break;
        case 'matches':
            renderMatchesPage(content);
            break;
        case 'profile':
            renderProfilePage(content);
            break;
        case 'edit-profile':
            renderEditProfilePage(content);
            break;
        case 'privacy-settings':
            renderPrivacySettingsPage(content);
            break;
        default:
            renderLandingPage(content);
    }
}

function renderLandingPage(container) {
    container.innerHTML = `
        <div class="hero">
            <h1>Amplify Your Connections at Live Events</h1>
            <p class="hero-subtitle">Connect with verified attendees in real-time. Scan event QR codes, swipe to match, and make meaningful connections.</p>
            
            <div class="cta-grid">
                <button class="btn btn-primary btn-large" onclick="navigateTo('auth')">
                    <i class="fas fa-user-plus"></i> Get Started Free
                </button>
                <button class="btn btn-demo btn-large" onclick="demoLogin()">
                    <i class="fas fa-play-circle"></i> Try Demo
                </button>
            </div>
        </div>
        
        <div class="features-grid">
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-qrcode"></i>
                </div>
                <h3>Event Check-in</h3>
                <p>Scan QR codes at events to see who's there</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3>Smart Matching</h3>
                <p>Swipe to connect with like-minded attendees</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3>Instant Chat</h3>
                <p>Chat with matches during the event</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <h3>Digital Tickets</h3>
                <p>Store and manage all your event tickets</p>
            </div>
        </div>
        
        <div class="card text-center mt-8">
            <h2 class="mb-4">Ready to Amplify Your Social Life?</h2>
            <p class="text-gray-400 mb-6">Join thousands of event-goers making real connections</p>
            <button class="btn btn-primary btn-large" onclick="navigateTo('auth')">
                <i class="fas fa-rocket"></i> Start Free Today
            </button>
        </div>
    `;
}

function renderAuthPage(container) {
    container.innerHTML = `
        <div class="auth-container">
            <h2 class="text-center mb-5">Welcome to Amps</h2>
            
            <div class="card">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="loginTab" onclick="switchAuthTab('login')">Sign In</button>
                    <button class="auth-tab" id="signupTab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>
                
                <form id="authForm" onsubmit="handleAuth(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="authEmail" placeholder="you@example.com" value="demo@amps.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="authPassword" placeholder="" value="password" required minlength="6">
                    </div>
                    
                    <div id="signupFields" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="authName" placeholder="Alex Johnson" value="Demo User">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Age</label>
                            <input type="number" class="form-control" id="authAge" placeholder="24" min="18" max="100" value="28">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block mt-4" id="authSubmit">
                        <i class="fas fa-sign-in-alt"></i> Continue
                    </button>
                </form>
                
                <div class="text-center mt-4">
                    <button class="btn btn-demo btn-block" onclick="demoLogin()">
                        <i class="fas fa-play-circle"></i> Continue as Demo User
                    </button>
                </div>
                
                <div class="text-xs text-gray-400 text-center mt-4 p-3 bg-gray-900/50 rounded-lg">
                    Demo credentials pre-filled. Just click "Continue" or try the demo!
                </div>
            </div>
        </div>
    `;
}

function renderHomePage(container) {
    const eventsAttended = 12;
    const totalMatches = state.matches.length;
    const remainingSwipes = state.isPro || state.isMax ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
    
    const featuredEvents = state.events.filter(e => e.isFeatured);
    const bookmarkedEvents = state.events.filter(e => state.userProfile.bookmarkedEvents?.includes(e.id));
    
    container.innerHTML = `
        <div class="profile-header">
            <div class="avatar ${state.isPro ? 'pro' : state.isMax ? 'pro-plus' : ''}" style="background-image: url('${state.userProfile.profilePhoto}');">
                ${state.isPro ? '<div class="pro-badge" style="position: absolute; bottom: -8px; right: -8px; font-size: 10px;"><i class="fas fa-crown"></i></div>' : ''}
                ${state.isMax ? '<div class="pro-plus-badge" style="position: absolute; bottom: -8px; right: -8px; font-size: 10px;"><i class="fas fa-star"></i></div>' : ''}
            </div>
            <h2>${state.userProfile.name}</h2>
            <p class="text-gradient">${state.userProfile.occupation}  ${state.userProfile.company}</p>
            ${state.isPro ? 
                '<div class="pro-badge mt-2"><i class="fas fa-crown"></i> PRO MEMBER</div>' : 
                state.isMax ?
                '<div class="pro-plus-badge mt-2"><i class="fas fa-star"></i> MAX MEMBER</div>' :
                '<div class="free-badge mt-2"><i class="fas fa-user"></i> FREE MEMBER</div>'
            }
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${eventsAttended}</div>
                <div class="stat-label">Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${totalMatches}</div>
                <div class="stat-label">Matches</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${remainingSwipes}</div>
                <div class="stat-label">Likes Left</div>
            </div>
        </div>
        
        ${featuredEvents.length > 0 ? `
            <div class="section-header">
                <h3>Featured Events</h3>
                <button class="btn btn-outline btn-small" onclick="navigateTo('events')">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="events-carousel" id="featuredEventsCarousel">
                ${featuredEvents.map(event => `
                    <div class="event-card-featured" onclick="viewEventDetail(${event.id})">
                        <div class="event-card-image" style="background-image: url('${event.coverImage}');">
                            <button class="bookmark-btn ${event.bookmarked ? 'active' : ''}" onclick="toggleBookmark(${event.id}, event)">
                                <i class="fas fa-bookmark"></i>
                            </button>
                            <div class="event-card-overlay">
                                <span class="live-badge"><i class="fas fa-bolt"></i> FEATURED</span>
                            </div>
                        </div>
                        <div class="event-card-content">
                            <h4 class="mb-2">${event.name}</h4>
                            <p class="text-gray-400 text-sm mb-2">
                                <i class="fas fa-map-marker-alt"></i> ${event.location}
                            </p>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gradient">
                                    <i class="fas fa-users"></i> ${event.attendees}
                                </span>
                                <span class="text-gray-400">${event.date}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        ` : ''}
        
        <h3 class="mt-6 mb-4">Quick Actions</h3>
        <div class="quick-actions">
            <div class="action-card primary" onclick="startCheckInFlow()">
                <i class="fas fa-qrcode"></i>
                <h4>Check In</h4>
                <p class="text-gray-400">Scan event QR</p>
            </div>
            
            <div class="action-card blue" onclick="openMapFromHome()">
                <i class="fas fa-map"></i>
                <h4>View Map</h4>
                <p class="text-gray-400">Event locations</p>
            </div>
            
            <div class="action-card pink" onclick="${state.isPro || state.isMax ? 'showEventWizard()' : 'showProModal()'}">
                <i class="fas fa-plus-circle"></i>
                <h4>Create Event</h4>
                <p class="text-gray-400">${state.isPro || state.isMax ? 'Set up new event' : 'Upgrade to create'}</p>
                ${!state.isPro && !state.isMax ? '<div class="pro-badge mt-2">PRO</div>' : ''}
            </div>
            
            <div class="action-card gold" onclick="showTicketModal()">
                <i class="fas fa-ticket-alt"></i>
                <h4>Ticket Box</h4>
                <p class="text-gray-400">Manage tickets</p>
            </div>
        </div>
        
        ${bookmarkedEvents.length > 0 ? `
            <div class="section-header mt-6">
                <h3>Bookmarked Events</h3>
                <button class="btn btn-outline btn-small" onclick="navigateTo('events')">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="bookmarked-events">
                ${bookmarkedEvents.slice(0, 3).map(event => `
                    <div class="event-card-list mb-3" onclick="viewEventDetail(${event.id})">
                        <div class="event-card-image">
                            <img src="${event.coverImage}" alt="${event.name}">
                        </div>
                        <div class="event-card-content">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="mb-1">${event.name}</h4>
                                    <p class="text-gray-400 text-sm">
                                        <i class="fas fa-map-marker-alt"></i> ${event.location}
                                    </p>
                                </div>
                                <button class="bookmark-btn active" onclick="toggleBookmark(${event.id}, event)">
                                    <i class="fas fa-bookmark"></i>
                                </button>
                            </div>
                            <div class="flex items-center gap-4 text-sm mt-2">
                                <span class="text-gradient">
                                    <i class="fas fa-users"></i> ${event.attendees}
                                </span>
                                <span class="text-gray-400">${event.date}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        ` : ''}
        
        <div class="card mt-6">
            <h4 class="mb-4">Recent Matches</h4>
            ${state.matches.length > 0 ? `
                <div class="attendee-list">
                    ${state.matches.slice(0, 3).map(match => {
                        const profile = MOCK_PROFILES.find(p => p.id === match.matchId);
                        return `
                            <div class="attendee-item" onclick="openChatModal(${match.matchId})">
                                <div class="attendee-avatar" style="background-image: url('${profile?.livePhoto || ''}');"></div>
                                <div class="attendee-info">
                                    <h4>${profile?.name || 'Unknown'}</h4>
                                    <p class="text-gray-400 text-sm">${match.lastMessage || 'New match!'}</p>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <button class="btn btn-outline btn-block mt-4" onclick="navigateTo('matches')">
                    View All Matches
                </button>
            ` : `
                <p class="text-gray-400 text-center py-4">No matches yet. Check into an event and start swiping!</p>
                <button class="btn btn-primary btn-block mt-2" onclick="navigateTo('events')">
                    <i class="fas fa-calendar"></i> Find Events
                </button>
            `}
        </div>
    `;
    
    // Initialize carousel if exists
    initCarousel();
}

function renderEventsPage(container) {
    const filteredEvents = filterEventsBySearch();
    
    container.innerHTML = `
        <div class="events-container" id="eventsContainer">
            <div class="map-handle" id="mapHandle">
                <div class="map-handle-bar"></div>
            </div>
            <div class="events-header">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               class="search-input" 
                               id="eventSearchInput" 
                               placeholder="Search events in Namibia..." 
                               value="${state.eventSearchQuery}"
                               oninput="handleEventSearch(event)">
                        ${state.eventSearchQuery ? `
                            <button class="clear-search" onclick="clearEventSearch()">
                                <i class="fas fa-times"></i>
                            </button>
                        ` : ''}
                    </div>
                    <div class="search-suggestions" id="searchSuggestions"></div>
                </div>
                <div class="flex gap-3 mt-4">
                    <button class="btn btn-primary flex-1" onclick="${state.isPro || state.isMax ? 'showEventWizard()' : 'showProModal()'}">
                        <i class="fas fa-plus"></i> Create Event
                    </button>
                    <button class="btn btn-outline" onclick="showFiltersModal()">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>
            <div class="events-list" id="eventsList">
                ${filteredEvents.length > 0 ? filteredEvents.map(event => `
                    <div class="event-card-list" onclick="viewEventDetail(${event.id})">
                        <div class="event-card-image">
                            <img src="${event.coverImage}" alt="${event.name}">
                            <button class="bookmark-btn ${event.bookmarked ? 'active' : ''}" onclick="toggleBookmark(${event.id}, event)">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                        <div class="event-card-content">
                            <h4 class="mb-2">${event.name}</h4>
                            <p class="text-gray-400 text-sm mb-2">
                                <i class="fas fa-map-marker-alt"></i> ${event.location}
                            </p>
                            <div class="flex items-center gap-4 text-sm">
                                <span class="text-gradient">
                                    <i class="fas fa-users"></i> ${event.attendees}
                                </span>
                                <span class="text-gray-400">${event.date}</span>
                                ${event.price > 0 ? `
                                    <span class="text-yellow-500">
                                        ${formatCurrency(event.price, event.currency)}
                                    </span>
                                ` : `
                                    <span class="text-green-500">Free</span>
                                `}
                            </div>
                        </div>
                    </div>
                `).join('') : `
                    <div class="text-center py-12">
                        <i class="fas fa-search" style="font-size: 48px; color: var(--gray-600); margin-bottom: 16px;"></i>
                        <h3 class="mb-2">No events found</h3>
                        <p class="text-gray-400">Try adjusting your search or filters</p>
                        <button class="btn btn-primary mt-4" onclick="clearEventSearch()">
                            Clear Search
                        </button>
                    </div>
                `}
            </div>
        </div>
        
        <div class="map-drawer">
            <div class="map-header">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               class="search-input" 
                               id="mapSearchInput" 
                               placeholder="Search locations in Namibia..."
                               oninput="handleMapSearch(event)">
                        <button class="clear-search" onclick="clearMapSearch()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    `;
    
    // Initialize map and interactions
    setTimeout(() => {
        if (!state.map) {
            initMap();
        } else {
            updateMapMarkers();
        }
        initMapDrawer();
        initEventSearch();
        initMapSearch();
    }, 100);
}

function renderConnectPage(container) {
    if (!state.currentEvent) {
        container.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-calendar-times" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                <h3 class="mb-2">No Active Event</h3>
                <p class="text-gray-400 mb-6">Check into an event first to start connecting with people</p>
                <button class="btn btn-primary" onclick="startCheckInFlow()">
                    <i class="fas fa-qrcode"></i> Check Into Event
                </button>
            </div>
        `;
        return;
    }
    
    const filteredProfiles = MOCK_PROFILES.filter(p => 
        !state.swipeHistory.some(s => s.profile.id === p.id) && 
        p.isPublic === true &&
        p.eventId === state.currentEvent.id
    );
    
    if (filteredProfiles.length === 0) {
        container.innerHTML = `
            <div class="swipe-interface">
                <div class="swipe-header">
                    <div class="flex justify-between items-center mb-4">
                        <div class="event-badge">
                            <i class="fas fa-calendar"></i>
                            <span>${state.currentEvent.name}</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center py-12">
                    <i class="fas fa-users" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                    <h3 class="mb-2">No more profiles</h3>
                    <p class="text-gray-400 mb-6">Check back later for new attendees!</p>
                    <div class="flex gap-3 justify-center">
                        <button class="btn btn-primary" onclick="resetSwipes()">
                            <i class="fas fa-redo"></i> Refresh Profiles
                        </button>
                        <button class="btn btn-outline" onclick="navigateTo('events')">
                            <i class="fas fa-calendar"></i> Find Another Event
                        </button>
                    </div>
                </div>
                
                <div class="swipe-actions">
                    <button class="action-button nope" onclick="showNotification('No profiles to swipe', 'info')">
                        <i class="fas fa-times"></i>
                        <span>Nope</span>
                    </button>
                    
                    <button class="action-button rewind" onclick="undoSwipe()" ${state.swipeHistory.length === 0 ? 'disabled' : ''}>
                        <i class="fas fa-undo"></i>
                        <span>Rewind</span>
                    </button>
                    
                    <button class="action-button refresh" onclick="resetSwipes()">
                        <i class="fas fa-redo"></i>
                        <span>Refresh</span>
                    </button>
                    
                    <button class="action-button like" onclick="showNotification('No profiles to like', 'info')">
                        <i class="fas fa-heart"></i>
                        <span>Like</span>
                    </button>
                </div>
            </div>
        `;
        return;
    }
    
    const currentProfile = filteredProfiles[0];
    const likesRemaining = state.isPro || state.isMax ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
    const rewindRemaining = state.rewindCount;
    
    container.innerHTML = `
        <div class="swipe-interface">
            <div class="swipe-header">
                <div class="flex justify-between items-center mb-4">
                    <div class="event-badge">
                        <i class="fas fa-calendar"></i>
                        <span>${state.currentEvent.name}</span>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-glass btn-small" onclick="showFiltersModal()">
                            <i class="fas fa-filter"></i>
                        </button>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat">
                        <i class="fas fa-user-friends"></i>
                        <span>${filteredProfiles.length} available</span>
                    </div>
                    <div class="stat">
                        <i class="fas fa-heart"></i>
                        <span>${likesRemaining} likes left</span>
                    </div>
                    <div class="stat">
                        <i class="fas fa-undo"></i>
                        <span>${rewindRemaining} rewinds</span>
                    </div>
                </div>
            </div>
            
            <div class="card-stack">
                <div class="card-container">
                    <div class="profile-card" id="profileCard${currentProfile.id}" style="z-index: 3;">
                        <div class="card-frame"></div>
                        <div class="card-content" style="background: ${currentProfile.cardColor};">
                            <div class="profile-image" style="background-image: url('${currentProfile.livePhoto}');">
                                <div class="live-badge">
                                    <i class="fas fa-camera"></i>
                                    <span>LIVE</span>
                                </div>
                            </div>
                            <div class="profile-info">
                                <h2>${currentProfile.name}, ${currentProfile.age}</h2>
                                <p class="text-gray-600 mb-4">
                                    <i class="fas fa-map-marker-alt"></i> ${currentProfile.location}  ${currentProfile.distance}
                                </p>
                                
                                <p class="mb-4">${currentProfile.bio}</p>
                                
                                <div class="interests mb-6">
                                    ${currentProfile.interests.slice(0, 4).map(interest => `
                                        <span class="interest-tag">${interest}</span>
                                    `).join('')}
                                </div>
                                
                                <div class="text-center text-gray-600 text-sm">
                                    ${currentProfile.verified ? '<i class="fas fa-shield-alt"></i> Verified attendee' : ''}
                                    ${currentProfile.tempProfile ? '<i class="fas fa-clock ml-2"></i> Temp profile' : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="swipe-actions">
                <button class="action-button nope" onclick="swipeLeft()" ${(!state.isPro && !state.isMax && state.swipeCount >= state.dailyLikes) ? 'disabled' : ''}>
                    <i class="fas fa-times"></i>
                    <span>Nope</span>
                </button>
                
                <button class="action-button rewind" onclick="undoSwipe()" ${state.swipeHistory.length === 0 || state.rewindCount <= 0 ? 'disabled' : ''}>
                    <i class="fas fa-undo"></i>
                    <span>Rewind</span>
                </button>
                
                <button class="action-button refresh" onclick="resetSwipes()">
                    <i class="fas fa-redo"></i>
                    <span>Refresh</span>
                </button>
                
                <button class="action-button like" onclick="swipeRight()" ${(!state.isPro && !state.isMax && state.swipeCount >= state.dailyLikes) ? 'disabled' : ''}>
                    <i class="fas fa-heart"></i>
                    <span>Like</span>
                </button>
            </div>
            
            ${(!state.isPro && !state.isMax) && (state.swipeCount >= state.dailyLikes - 5 || state.rewindCount <= 0) ? `
                <div class="text-center mt-4">
                    <button class="btn btn-pro btn-small" onclick="showProModal()">
                        <i class="fas fa-crown"></i> Upgrade for unlimited
                    </button>
                </div>
            ` : ''}
        </div>
    `;
    
    setTimeout(() => initializeSwipeGestures(currentProfile.id), 100);
}

function renderMatchesPage(container) {
    container.innerHTML = `
        <h2 class="mb-4">Your Matches</h2>
        
        ${state.matches.length > 0 ? `
            <div class="matches-list">
                ${state.matches.map(match => {
                    const profile = MOCK_PROFILES.find(p => p.id === match.matchId);
                    return `
                        <div class="match-item" onclick="openChatModal(${match.matchId})">
                            <div class="match-avatar" style="background-image: url('${profile?.livePhoto || ''}');"></div>
                            <div class="match-info">
                                <div class="flex items-center gap-2">
                                    <h4>${profile?.name || 'Unknown'}, ${profile?.age || ''}</h4>
                                    ${match.unread ? '<span class="w-2 h-2 bg-primary rounded-full"></span>' : ''}
                                </div>
                                <p class="text-gray-400 text-sm">${match.lastMessage || 'New match!'}</p>
                                <div class="match-status">
                                    ${profile?.online ? '<span class="status-online">Online</span>' : '<span class="status-away">Offline</span>'}
                                    <span class="text-gray-400"> ${match.lastMessageTime}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        ` : `
            <div class="text-center py-12">
                <i class="fas fa-heart" style="font-size: 64px; color: var(--gray-600); margin-bottom: 16px;"></i>
                <h3 class="mb-2">No Matches Yet</h3>
                <p class="text-gray-400 mb-6">Start swiping at events to make connections!</p>
                <button class="btn btn-primary" onclick="navigateTo('events')">
                    <i class="fas fa-calendar"></i> Find Events
                </button>
            </div>
        `}
    `;
}

function renderProfilePage(container) {
    const remainingSwipes = state.isPro || state.isMax ? '' : Math.max(0, state.dailyLikes - state.swipeCount);
    
    container.innerHTML = `
        <div class="profile-header">
            <div class="avatar ${state.isPro ? 'pro' : state.isMax ? 'pro-plus' : ''}" style="background-image: url('${state.userProfile.profilePhoto}');">
                <button class="absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full" onclick="changeProfilePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
            <h2>${state.userProfile.name}, ${state.userProfile.age}</h2>
            <p class="text-gradient">${state.userProfile.occupation}  ${state.userProfile.company}</p>
            
            <div class="flex gap-3 mt-4">
                ${state.isPro ? 
                    '<div class="pro-badge"><i class="fas fa-crown"></i> PRO</div>' : 
                    state.isMax ?
                    '<div class="pro-plus-badge"><i class="fas fa-star"></i> MAX</div>' :
                    '<div class="free-badge"><i class="fas fa-user"></i> FREE</div>'
                }
                <div class="pro-badge" style="background: var(--bg-tertiary); color: var(--gray-300);">
                    <i class="fas fa-heart"></i>
                    <span>${remainingSwipes} likes today</span>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <h3 class="mb-4">About</h3>
            <p class="text-gray-300 mb-4">${state.userProfile.bio}</p>
            <div class="flex flex-wrap gap-2">
                ${state.userProfile.interests.map(interest => `
                    <span class="px-3 py-1 bg-gray-800 rounded-full text-sm">${interest}</span>
                `).join('')}
            </div>
            <button class="btn btn-outline btn-block mt-4" onclick="navigateTo('edit-profile')">
                <i class="fas fa-edit"></i> Edit Profile
            </button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">12</div>
                <div class="stat-label">Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${state.matches.length}</div>
                <div class="stat-label">Matches</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">89%</div>
                <div class="stat-label">Response</div>
            </div>
        </div>
        
        <div class="card mt-4">
            <h3 class="mb-4">Account</h3>
            <div class="flex flex-col gap-3">
                <button class="btn btn-outline" onclick="showSettingsModal()">
                    <i class="fas fa-cog"></i> Settings
                </button>
                ${(state.isPro || state.isMax) ? `
                    <button class="btn btn-outline" onclick="showAnalyticsModal()">
                        <i class="fas fa-chart-line"></i> Analytics
                    </button>
                ` : ''}
                ${!state.isPro && !state.isMax ? `
                    <button class="btn btn-pro" onclick="showProModal()">
                        <i class="fas fa-crown"></i> Upgrade to Pro
                    </button>
                ` : ''}
                <button class="btn btn-outline" onclick="navigateTo('privacy-settings')">
                    <i class="fas fa-shield-alt"></i> Privacy & Safety
                </button>
            </div>
        </div>
        
        <div class="card mt-4">
            <button class="btn btn-outline btn-block text-red-400" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sign Out
            </button>
        </div>
    `;
}

function renderEditProfilePage(container) {
    container.innerHTML = `
        <div class="edit-profile-container">
            <h2 class="mb-6">Edit Profile</h2>
            
            <div class="card">
                <div class="profile-photo-upload">
                    <div class="avatar" style="background-image: url('${state.userProfile.profilePhoto}');"></div>
                    <button class="upload-button" onclick="uploadProfilePhoto()">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                
                <form id="editProfileForm" onsubmit="saveProfile(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" value="${state.userProfile.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Age</label>
                        <input type="number" class="form-control" value="${state.userProfile.age}" min="18" max="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Occupation</label>
                        <input type="text" class="form-control" value="${state.userProfile.occupation}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company</label>
                        <input type="text" class="form-control" value="${state.userProfile.company}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-control" rows="3" maxlength="200" id="bioTextarea">${state.userProfile.bio}</textarea>
                        <div class="text-right text-xs text-gray-400 mt-1" id="bioCounter">${state.userProfile.bio.length}/200</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Interests</label>
                        <div class="flex flex-wrap gap-2 mb-3" id="interestsContainer">
                            ${state.userProfile.interests.map(interest => `
                                <span class="interest-tag">
                                    ${interest}
                                    <i class="fas fa-times ml-1 cursor-pointer" onclick="removeInterest('${interest}')"></i>
                                </span>
                            `).join('')}
                        </div>
                        <div class="flex gap-2">
                            <input type="text" class="form-control flex-1" id="newInterest" placeholder="Add interest">
                            <button type="button" class="btn btn-outline" onclick="addInterest()">Add</button>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button type="button" class="btn btn-outline flex-1" onclick="goBack()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary flex-1">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
}

function renderPrivacySettingsPage(container) {
    container.innerHTML = `
        <h2 class="mb-6">Privacy & Safety</h2>
        
        <div class="card">
            <h3 class="mb-4">Profile Visibility</h3>
            <div class="privacy-option">
                <div class="privacy-info">
                    <span>Show my profile to</span>
                    <small class="text-gray-400">Control who can see your profile</small>
                </div>
                <select class="form-control" style="width: auto;" onchange="updatePrivacySetting('showProfile', this.value)">
                    <option value="public" ${state.userProfile.visibility === 'public' ? 'selected' : ''}>Everyone</option>
                    <option value="private" ${state.userProfile.visibility === 'private' ? 'selected' : ''}>Private</option>
                </select>
            </div>
        </div>
        
        <div class="card mt-4">
            <h3 class="mb-4">Safety Features</h3>
            
            <div class="privacy-option">
                <div class="privacy-info">
                    <span>Blocked Users</span>
                    <small class="text-gray-400">Manage blocked accounts</small>
                </div>
                <button class="btn btn-outline btn-small" onclick="showBlockedUsers()">
                    Manage
                </button>
            </div>
            
            <div class="privacy-option">
                <div class="privacy-info">
                    <span>Report History</span>
                    <small class="text-gray-400">View your reports</small>
                </div>
                <button class="btn btn-outline btn-small" onclick="showReportHistory()">
                    View
                </button>
            </div>
            
            <div class="privacy-option">
                <div class="privacy-info">
                    <span>Emergency Contact</span>
                    <small class="text-gray-400">Set up emergency contact</small>
                </div>
                <button class="btn btn-outline btn-small" onclick="setupEmergencyContact()">
                    Setup
                </button>
            </div>
        </div>
    `;
}

// ===== NAVIGATION =====
function updateNavigation() {
    let navbar = document.querySelector('.navbar');
    
    if (!navbar) {
        navbar = document.createElement('nav');
        navbar.className = 'navbar';
        document.getElementById('app').insertBefore(navbar, document.getElementById('content'));
    }
    
    let navHTML = `
        <div class="nav-brand" onclick="navigateTo('home')">
            <i class="fas fa-bolt"></i>
            <span class="amp">Amps</span>
        </div>
        <div class="nav-actions">
    `;
    
    if (state.currentPage === 'landing') {
        navHTML += `
            <button class="btn btn-outline btn-small" onclick="navigateTo('auth')">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>
        `;
    } else if (state.currentPage === 'home') {
        navHTML += `
            <button class="btn btn-outline btn-small" onclick="showNotifications()">
                <i class="fas fa-bell"></i>
                ${state.notifications.filter(n => !n.read).length > 0 ? 
                    `<span class="notification-badge">${state.notifications.filter(n => !n.read).length}</span>` : ''}
            </button>
        `;
    } else {
        navHTML += `
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
        `;
    }
    
    navHTML += `</div>`;
    
    navbar.innerHTML = navHTML;
    
    // Update bottom nav
    const bottomNav = document.getElementById('bottomNav');
    if (state.currentUser && ['home', 'events', 'connect', 'matches', 'profile'].includes(state.currentPage)) {
        const unreadCount = state.matches.filter(m => m.unread).length;
        bottomNav.innerHTML = `
            <div class="bottom-nav">
                <button class="nav-item ${state.currentPage === 'home' ? 'active' : ''}" onclick="navigateTo('home')">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </button>
                <button class="nav-item ${state.currentPage === 'events' ? 'active' : ''}" onclick="navigateTo('events')">
                    <i class="fas fa-calendar"></i>
                    <span>Events</span>
                </button>
                <button class="nav-item ${state.currentPage === 'connect' ? 'active' : ''}" onclick="navigateTo('connect')">
                    <i class="fas fa-users"></i>
                    <span>Connect</span>
                </button>
                <button class="nav-item ${state.currentPage === 'matches' ? 'active' : ''}" onclick="navigateTo('matches')">
                    <i class="fas fa-heart"></i>
                    <span>Matches${unreadCount > 0 ? `<span class="notification-badge">${unreadCount}</span>` : ''}</span>
                </button>
                <button class="nav-item ${state.currentPage === 'profile' ? 'active' : ''}" onclick="navigateTo('profile')">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </button>
            </div>
        `;
    } else {
        bottomNav.innerHTML = '';
    }
}

// ===== AUTHENTICATION =====
function switchAuthTab(tab) {
    const loginTab = document.getElementById('loginTab');
    const signupTab = document.getElementById('signupTab');
    const signupFields = document.getElementById('signupFields');
    const authSubmit = document.getElementById('authSubmit');
    
    if (loginTab && signupTab) {
        loginTab.classList.toggle('active', tab === 'login');
        signupTab.classList.toggle('active', tab === 'signup');
    }
    
    if (signupFields) {
        signupFields.classList.toggle('hidden', tab === 'login');
    }
    
    if (authSubmit) {
        authSubmit.innerHTML = tab === 'login' ? 
            '<i class="fas fa-sign-in-alt"></i> Sign In' : 
            '<i class="fas fa-user-plus"></i> Create Account';
    }
}

function handleAuth(event) {
    event.preventDefault();
    
    const form = event.target;
    const email = form.querySelector('#authEmail').value;
    const password = form.querySelector('#authPassword').value;
    
    if (password.length < 6) {
        showNotification('Password must be at least 6 characters', 'error');
        return;
    }
    
    // In a real app, you would verify credentials with a backend
    state.currentUser = {
        id: 'user_' + Date.now(),
        email: email,
        createdAt: new Date().toISOString()
    };
    
    // Update user profile with form data if signing up
    const authTab = document.querySelector('.auth-tab.active');
    if (authTab && authTab.textContent === 'Sign Up') {
        const name = form.querySelector('#authName')?.value || email.split('@')[0];
        const age = form.querySelector('#authAge')?.value || 25;
        state.userProfile.name = name;
        state.userProfile.age = parseInt(age);
        state.userProfile.email = email;
    }
    
    showNotification('Welcome to Amps! ', 'success');
    setTimeout(() => navigateTo('home'), 1000);
    
    saveState();
}

function demoLogin() {
    state.currentUser = {
        id: 'demo_user',
        email: 'demo@amps.com',
        createdAt: new Date().toISOString()
    };
    
    // Add demo matches
    state.matches = [
        {
            id: 1,
            userId: 'demo_user',
            matchId: 2,
            timestamp: new Date().toISOString(),
            eventId: 1,
            lastMessage: 'Hey! How\'s the event?',
            lastMessageTime: '2:15 PM',
            unread: true
        },
        {
            id: 2,
            userId: 'demo_user',
            matchId: 5,
            timestamp: new Date(Date.now() - 86400000).toISOString(),
            eventId: 1,
            lastMessage: 'Great meeting you!',
            lastMessageTime: 'Yesterday',
            unread: false
        }
    ];
    
    // Add demo tickets
    state.tickets = [
        {
            id: 1,
            eventId: 1,
            eventName: 'Windhoek Tech Summit 2024',
            purchaseDate: new Date().toISOString(),
            price: 150.00,
            currency: 'NAD',
            qrCode: 'AMPS_TECH_2024_001_DEMO',
            status: 'active'
        },
        {
            id: 2,
            eventId: 2,
            eventName: 'Namibian Art & Culture Festival',
            purchaseDate: new Date(Date.now() - 86400000).toISOString(),
            price: 80.00,
            currency: 'NAD',
            qrCode: 'AMPS_ART_2024_002_DEMO',
            status: 'active'
        }
    ];
    
    showNotification('Demo mode activated! Explore all features.', 'success');
    navigateTo('home');
    saveState();
}

function logout() {
    state.currentUser = null;
    state.currentPage = 'landing';
    showNotification('Successfully signed out', 'info');
    renderPage();
    updateNavigation();
    saveState();
}

// ===== MAP DRAWER FUNCTIONS =====
function openMapFromHome() {
    navigateTo('events');
    // Open map drawer to 50% position
    setTimeout(() => {
        const eventsContainer = document.querySelector('.events-container');
        if (eventsContainer) {
            const windowHeight = window.innerHeight;
            eventsContainer.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            eventsContainer.style.transform = `translateY(${windowHeight * 0.5}px)`;
            state.mapDrawerPosition = windowHeight * 0.5;
            state.mapDrawerOpen = true;
            
            // Update snap points
            updateSnapPoints(1);
            
            setTimeout(() => {
                eventsContainer.style.transition = '';
            }, 300);
        }
    }, 100);
}

function initMapDrawer() {
    const eventsContainer = document.querySelector('.events-container');
    const mapHandle = document.getElementById('mapHandle');
    
    if (!eventsContainer || !mapHandle) return;
    
    let startY = 0;
    let currentY = 0;
    let isDragging = false;
    
    mapHandle.addEventListener('touchstart', (e) => {
        startY = e.touches[0].clientY;
        isDragging = true;
        eventsContainer.classList.add('dragging');
        e.preventDefault();
    }, { passive: false });
    
    mapHandle.addEventListener('mousedown', (e) => {
        startY = e.clientY;
        isDragging = true;
        eventsContainer.classList.add('dragging');
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        currentY = e.touches[0].clientY;
        const diff = currentY - startY;
        updateDrawerPosition(diff);
        startY = currentY;
    }, { passive: false });
    
    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        currentY = e.clientY;
        const diff = currentY - startY;
        updateDrawerPosition(diff);
        startY = currentY;
    });
    
    document.addEventListener('touchend', () => {
        if (!isDragging) return;
        isDragging = false;
        eventsContainer.classList.remove('dragging');
        snapDrawer();
    });
    
    document.addEventListener('mouseup', () => {
        if (!isDragging) return;
        isDragging = false;
        eventsContainer.classList.remove('dragging');
        snapDrawer();
    });
    
    // Add snap points indicator
    const snapPoints = document.createElement('div');
    snapPoints.className = 'snap-points';
    snapPoints.innerHTML = `
        <div class="snap-dot active" data-position="0"></div>
        <div class="snap-dot" data-position="1"></div>
        <div class="snap-dot" data-position="2"></div>
    `;
    eventsContainer.appendChild(snapPoints);
}

function updateDrawerPosition(diff) {
    const eventsContainer = document.querySelector('.events-container');
    if (!eventsContainer) return;
    
    const maxHeight = window.innerHeight * 0.85;
    const newPosition = Math.max(0, Math.min(maxHeight, state.mapDrawerPosition + diff));
    
    eventsContainer.style.transform = `translateY(${newPosition}px)`;
    state.mapDrawerPosition = newPosition;
    
    // Update snap points visual feedback
    updateSnapPointsVisual(newPosition);
}

function snapDrawer() {
    const eventsContainer = document.querySelector('.events-container');
    if (!eventsContainer) return;
    
    const windowHeight = window.innerHeight;
    const currentPosition = state.mapDrawerPosition;
    
    let targetPosition;
    let snapIndex;
    
    if (currentPosition < windowHeight * 0.3) {
        // Snap to top (full events - 100%)
        targetPosition = 0;
        snapIndex = 0;
        state.mapDrawerOpen = false;
        eventsContainer.classList.remove('hybrid', 'full-map');
    } else if (currentPosition < windowHeight * 0.6) {
        // Snap to middle (hybrid - 50%)
        targetPosition = windowHeight * 0.5;
        snapIndex = 1;
        state.mapDrawerOpen = true;
        eventsContainer.classList.add('hybrid');
        eventsContainer.classList.remove('full-map');
    } else {
        // Snap to bottom (full map - 15-20%)
        targetPosition = windowHeight * 0.82;
        snapIndex = 2;
        state.mapDrawerOpen = true;
        eventsContainer.classList.add('full-map');
        eventsContainer.classList.remove('hybrid');
    }
    
    eventsContainer.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    eventsContainer.style.transform = `translateY(${targetPosition}px)`;
    state.mapDrawerPosition = targetPosition;
    
    // Update snap points
    updateSnapPoints(snapIndex);
    
    setTimeout(() => {
        eventsContainer.style.transition = '';
    }, 300);
}

function updateSnapPointsVisual(currentPosition) {
    const windowHeight = window.innerHeight;
    const dots = document.querySelectorAll('.snap-dot');
    
    if (!dots.length) return;
    
    dots.forEach((dot, index) => {
        let targetPosition;
        switch(index) {
            case 0: targetPosition = 0; break; // 100% - events only
            case 1: targetPosition = windowHeight * 0.5; break; // 50% - hybrid
            case 2: targetPosition = windowHeight * 0.82; break; // 18% - full map
        }
        
        const distance = Math.abs(currentPosition - targetPosition);
        const maxDistance = windowHeight * 0.3;
        const opacity = 1 - Math.min(distance / maxDistance, 1);
        const scale = 1 + (1 - distance / maxDistance) * 0.5;
        
        dot.style.opacity = opacity;
        dot.style.transform = `scale(${scale})`;
    });
}

function updateSnapPoints(activeIndex) {
    const dots = document.querySelectorAll('.snap-dot');
    dots.forEach((dot, index) => {
        if (index === activeIndex) {
            dot.classList.add('active');
            dot.style.background = 'var(--primary)';
        } else {
            dot.classList.remove('active');
            dot.style.background = 'rgba(255, 255, 255, 0.3)';
        }
    });
}

// ===== ENHANCED MAP FUNCTIONS =====
function initMap() {
    if (!mapboxgl || !MAPBOX_TOKEN) {
        console.error('Mapbox not loaded');
        return;
    }
    
    mapboxgl.accessToken = MAPBOX_TOKEN;
    
    if (!state.map) {
        state.map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [17.0658, -22.5609], // Windhoek, Namibia
            zoom: 12
        });
        
        state.map.on('load', () => {
            updateMapMarkers();
            
            // Add geofence circles for events
            state.events.forEach(event => {
                if (event.geoFencing && event.coordinates) {
                    addGeofenceCircle(event);
                }
            });
        });
    }
}

function updateMapMarkers() {
    if (!state.map) return;
    
    // Clear existing markers
    if (state.mapMarkers) {
        state.mapMarkers.forEach(marker => marker.remove());
    }
    state.mapMarkers = [];
    
    // Add markers for each event
    state.events.forEach(event => {
        const el = document.createElement('div');
        el.className = 'event-marker';
        el.innerHTML = `<i class="fas fa-map-marker-alt"></i>`;
        el.style.color = event.customTheme || '#8B5CF6';
        el.style.cursor = 'pointer';
        
        el.addEventListener('click', (e) => {
            e.stopPropagation();
            viewEventDetail(event.id);
        });
        
        // Create popup content
        const popupContent = document.createElement('div');
        popupContent.innerHTML = `
            <h3>${event.name}</h3>
            <p><i class="fas fa-map-marker-alt"></i> ${event.location}</p>
            <p><i class="fas fa-calendar"></i> ${event.date}</p>
            <p><i class="fas fa-users"></i> ${event.attendees} attending</p>
            ${event.geofenceRadius ? `<p><i class="fas fa-expand-arrows-alt"></i> ${event.geofenceRadius}m radius</p>` : ''}
            <button onclick="viewEventDetail(${event.id})">View Details</button>
        `;
        
        // Create marker
        const marker = new mapboxgl.Marker(el)
            .setLngLat([event.coordinates.lng, event.coordinates.lat])
            .addTo(state.map);
        
        // Add popup
        const popup = new mapboxgl.Popup({
            offset: 25,
            closeButton: true,
            closeOnClick: true
        })
            .setDOMContent(popupContent);
        
        marker.setPopup(popup);
        
        // Store reference to marker
        state.mapMarkers.push(marker);
    });
}

function addGeofenceCircle(event) {
    if (!state.map || !event.geofenceRadius) return;
    
    // Convert meters to degrees (approximate)
    const radiusInDegrees = event.geofenceRadius / 111320;
    
    // Create circle coordinates
    const circleCoordinates = [];
    const steps = 64;
    
    for (let i = 0; i < steps; i++) {
        const angle = (i / steps) * 2 * Math.PI;
        const lat = event.coordinates.lat + radiusInDegrees * Math.cos(angle);
        const lng = event.coordinates.lng + radiusInDegrees * Math.sin(angle) / Math.cos(event.coordinates.lat * Math.PI / 180);
        circleCoordinates.push([lng, lat]);
    }
    
    // Close the circle
    circleCoordinates.push(circleCoordinates[0]);
    
    // Add source and layer if they don't exist
    const sourceId = `geofence-${event.id}`;
    const layerId = `geofence-layer-${event.id}`;
    
    if (!state.map.getSource(sourceId)) {
        state.map.addSource(sourceId, {
            type: 'geojson',
            data: {
                type: 'Feature',
                geometry: {
                    type: 'Polygon',
                    coordinates: [circleCoordinates]
                }
            }
        });
        
        state.map.addLayer({
            id: layerId,
            type: 'fill',
            source: sourceId,
            paint: {
                'fill-color': event.customTheme || '#8B5CF6',
                'fill-opacity': 0.1,
                'fill-outline-color': event.customTheme || '#8B5CF6'
            }
        });
    }
}

// ===== EVENTS =====
function viewEventDetail(eventId) {
    const event = state.events.find(e => e.id === eventId);
    if (!event) return;
    
    state.previousPage = state.currentPage;
    
    const modal = document.createElement('div');
    modal.className = 'event-detail-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="event-detail-header">
                <h2>${event.name}</h2>
                <button class="close-btn" onclick="closeEventDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="event-detail-content">
                <img src="${event.coverImage}" alt="${event.name}" class="event-detail-image">
                
                <div class="event-detail-info">
                    <p><i class="fas fa-map-marker-alt"></i> ${event.location}</p>
                    <p><i class="fas fa-calendar"></i> ${event.date}  ${event.time}</p>
                    <p><i class="fas fa-users"></i> ${event.attendees} / ${event.maxAttendees} attending</p>
                    <p><i class="fas fa-tag"></i> ${event.category}</p>
                    ${event.price > 0 ? `
                        <p><i class="fas fa-dollar-sign"></i> ${formatCurrency(event.price, event.currency)}</p>
                    ` : ''}
                    ${event.geofenceRadius ? `
                        <p><i class="fas fa-expand-arrows-alt"></i> ${event.geofenceRadius}m geofence radius</p>
                    ` : ''}
                </div>
                
                <div class="event-detail-description">
                    <h3>Description</h3>
                    <p>${event.description}</p>
                </div>
                
                <div class="event-detail-tags">
                    ${event.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                
                <div class="event-detail-actions">
                    <button class="btn btn-primary btn-block" onclick="checkInToEvent(${event.id})">
                        <i class="fas fa-qrcode"></i> Check In Now
                    </button>
                    <button class="btn btn-outline btn-block mt-2" onclick="purchaseTicket(${event.id})">
                        <i class="fas fa-ticket-alt"></i> Get Ticket
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function closeEventDetailModal() {
    const modal = document.querySelector('.event-detail-modal');
    if (modal) {
        modal.remove();
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function checkInToEvent(eventId) {
    const event = state.events.find(e => e.id === eventId);
    if (!event) return;
    
    closeEventDetailModal();
    state.currentEvent = event;
    startCheckInFlow();
}

function purchaseTicket(eventId) {
    const event = state.events.find(e => e.id === eventId);
    if (!event) return;
    
    state.currentEvent = event;
    showTicketPurchaseModal(event);
}

// ===== SWIPE SYSTEM =====
function initializeSwipeGestures(profileId) {
    const card = document.getElementById(`profileCard${profileId}`);
    if (!card) return;
    
    let startX, startY, moveX, moveY;
    
    card.addEventListener('touchstart', e => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
    }, { passive: true });
    
    card.addEventListener('touchmove', e => {
        if (!startX || !startY) return;
        
        moveX = e.touches[0].clientX;
        moveY = e.touches[0].clientY;
        
        const diffX = moveX - startX;
        
        if (Math.abs(diffX) > 50) {
            e.preventDefault();
            card.style.transform = `translateX(${diffX}px) rotate(${diffX * 0.1}deg)`;
            card.style.opacity = 1 - Math.abs(diffX) / 300;
        }
    }, { passive: false });
    
    card.addEventListener('touchend', () => {
        if (!startX || !moveX) return;
        
        const diffX = moveX - startX;
        const threshold = 100;
        
        if (Math.abs(diffX) > threshold) {
            if (diffX > 0) {
                swipeRight();
            } else {
                swipeLeft();
            }
        } else {
            card.style.transform = '';
            card.style.opacity = '';
        }
        
        startX = startY = moveX = moveY = null;
    });
}

function swipeLeft() {
    if (!state.isPro && !state.isMax && state.swipeCount >= state.dailyLikes) {
        showProModal();
        return;
    }
    
    const availableProfiles = getAvailableProfiles();
    
    if (availableProfiles.length === 0) return;
    
    const profile = availableProfiles[0];
    state.swipeHistory.push({ profile, action: 'reject' });
    state.swipeCount++;
    
    showNotification(`Passed on ${profile.name}`);
    saveState();
    
    setTimeout(() => renderPage(), 300);
}

function swipeRight() {
    if (!state.isPro && !state.isMax && state.swipeCount >= state.dailyLikes) {
        showProModal();
        return;
    }
    
    const availableProfiles = getAvailableProfiles();
    
    if (availableProfiles.length === 0) return;
    
    const profile = availableProfiles[0];
    state.swipeHistory.push({ profile, action: 'like' });
    state.swipeCount++;
    
    if (Math.random() < 0.4) {
        const match = {
            id: Date.now(),
            userId: state.currentUser?.id,
            matchId: profile.id,
            timestamp: new Date().toISOString(),
            eventId: state.currentEvent?.id,
            lastMessage: 'You matched! Say hi!',
            lastMessageTime: 'Just now',
            unread: true
        };
        state.matches.push(match);
        state.lastMatch = profile;
        setTimeout(() => showMatchModal(), 400);
        showNotification(`It's a match with ${profile.name}! `, 'success');
    } else {
        showNotification(`Liked ${profile.name} `);
    }
    
    saveState();
    setTimeout(() => renderPage(), 300);
}

function superLike() {
    if (!state.isPro && !state.isMax && state.superLikes <= 0) {
        showProModal();
        return;
    }
    
    const availableProfiles = getAvailableProfiles();
    
    if (availableProfiles.length === 0) return;
    
    const profile = availableProfiles[0];
    state.swipeHistory.push({ profile, action: 'super' });
    state.swipeCount++;
    state.superLikes--;
    
    if (Math.random() < 0.7) {
        const match = {
            id: Date.now(),
            userId: state.currentUser?.id,
            matchId: profile.id,
            timestamp: new Date().toISOString(),
            eventId: state.currentEvent?.id,
            lastMessage: 'You super liked each other!',
            lastMessageTime: 'Just now',
            unread: true
        };
        state.matches.push(match);
        state.lastMatch = profile;
        setTimeout(() => showMatchModal(), 400);
        showNotification(`Super match with ${profile.name}! `, 'success');
    } else {
        showNotification(`Super liked ${profile.name} `);
    }
    
    saveState();
    setTimeout(() => renderPage(), 300);
}

function undoSwipe() {
    if (state.swipeHistory.length === 0 || state.rewindCount <= 0) {
        showNotification('No rewinds available', 'info');
        return;
    }
    
    state.swipeHistory.pop();
    state.swipeCount = Math.max(0, state.swipeCount - 1);
    state.rewindCount--;
    showNotification('Rewinded last swipe', 'info');
    
    renderPage();
    saveState();
}

function resetSwipes() {
    state.swipeHistory = [];
    renderPage();
    saveState();
}

function getAvailableProfiles() {
    return MOCK_PROFILES.filter(p => 
        !state.swipeHistory.some(s => s.profile.id === p.id) && 
        p.isPublic === true &&
        p.eventId === state.currentEvent?.id
    );
}

// ===== BOOKMARK FUNCTIONALITY =====
function toggleBookmark(eventId, eventElement) {
    if (!state.userProfile.bookmarkedEvents) {
        state.userProfile.bookmarkedEvents = [];
    }
    
    const index = state.userProfile.bookmarkedEvents.indexOf(eventId);
    if (index > -1) {
        // Remove bookmark
        state.userProfile.bookmarkedEvents.splice(index, 1);
        if (eventElement) eventElement.bookmarked = false;
        showNotification('Removed from bookmarks', 'info');
    } else {
        // Add bookmark
        state.userProfile.bookmarkedEvents.push(eventId);
        if (eventElement) eventElement.bookmarked = true;
        showNotification('Added to bookmarks', 'success');
    }
    
    // Update UI immediately
    const bookmarkBtn = event?.target?.closest('.bookmark-btn');
    if (bookmarkBtn) {
        bookmarkBtn.classList.toggle('active');
    }
    
    saveState();
}

// ===== ENHANCED CHECK-IN FLOW =====
function startCheckInFlow() {
    state.checkInFlow = {
        active: true,
        step: 'scan',
        eventId: null,
        privacyChoice: null,
        livePhoto: null
    };
    
    // Open camera for QR scanning
    openCameraForScanning();
}

function openCameraForScanning() {
    const modal = document.getElementById('cameraModal');
    if (modal) {
        // Update camera modal for QR scanning
        const cameraPreview = modal.querySelector('.camera-preview');
        if (cameraPreview) {
            cameraPreview.innerHTML = `
                <div class="qr-scan-overlay">
                    <div class="qr-frame"></div>
                    <p class="qr-instruction">Align QR code within frame</p>
                </div>
                <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                <div class="live-badge" style="position: absolute; top: 16px; right: 16px;">
                    <i class="fas fa-qrcode"></i>
                    <span>SCAN QR</span>
                </div>
            `;
        }
        
        const cameraControls = modal.querySelector('.camera-controls');
        if (cameraControls) {
            cameraControls.innerHTML = `
                <button class="btn btn-outline" onclick="closeCamera()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="simulateQRScan()">
                    <i class="fas fa-qrcode"></i> Simulate Scan
                </button>
                <button class="btn btn-outline" onclick="enterEventCodeManually()">
                    <i class="fas fa-keyboard"></i> Enter Code
                </button>
            `;
        }
        
        modal.style.display = 'flex';
    }
}

function simulateQRScan() {
    // Simulate scanning an event QR code
    closeCamera();
    
    // For demo, pick a random event
    const randomEvent = state.events[Math.floor(Math.random() * state.events.length)];
    state.checkInFlow.eventId = randomEvent.id;
    
    // Check if user is within geofence
    checkGeofenceAndProceed(randomEvent);
}

function enterEventCodeManually() {
    closeCamera();
    const code = prompt('Enter event code (e.g., AMPS_TECH_2024_001):');
    if (code) {
        // Find event by QR code
        const event = state.events.find(e => e.qrCode === code);
        if (event) {
            state.checkInFlow.eventId = event.id;
            checkGeofenceAndProceed(event);
        } else {
            showNotification('Invalid event code', 'error');
            state.checkInFlow.active = false;
        }
    }
}

function checkGeofenceAndProceed(event) {
    if (event.geoFencing) {
        // Simulate geofence check
        const isWithinGeofence = Math.random() > 0.2; // 80% success rate for demo
        
        if (isWithinGeofence) {
            showNotification(`Within ${event.geofenceRadius}m of ${event.name}`, 'success');
            proceedToPrivacyChoice(event);
        } else {
            showNotification(`You must be within ${event.geofenceRadius}m of the event location`, 'error');
            state.checkInFlow.active = false;
        }
    } else {
        proceedToPrivacyChoice(event);
    }
}

function proceedToPrivacyChoice(event) {
    showPrivacyChoiceModal(event);
}

function showPrivacyChoiceModal(event) {
    const modal = document.createElement('div');
    modal.className = 'privacy-choice-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 class="mb-2">Checking into ${event.name}</h2>
            <p class="text-gray-400 mb-6">Choose how you want to appear at this event</p>
            
            <div class="privacy-options">
                <div class="privacy-option public" onclick="choosePrivacy('public')">
                    <div class="privacy-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="privacy-info">
                        <h4>Public Profile</h4>
                        <p class="text-gray-400">Others can see and connect with you</p>
                    </div>
                    <div class="privacy-badge">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                
                <div class="privacy-option private" onclick="choosePrivacy('private')">
                    <div class="privacy-icon">
                        <i class="fas fa-user-secret"></i>
                    </div>
                    <div class="privacy-info">
                        <h4>Private Mode</h4>
                        <p class="text-gray-400">Browse anonymously, no connections</p>
                    </div>
                    <div class="privacy-badge">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline btn-block mt-6" onclick="closePrivacyModal()">
                Cancel Check-in
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function choosePrivacy(choice) {
    state.checkInFlow.privacyChoice = choice;
    closePrivacyModal();
    
    if (choice === 'public') {
        // Take live photo for public profile
        openCameraForLivePhoto();
    } else {
        // Private mode - just welcome
        completePrivateCheckIn();
    }
}

function openCameraForLivePhoto() {
    const modal = document.getElementById('cameraModal');
    if (modal) {
        // Update camera modal for live photo
        const cameraPreview = modal.querySelector('.camera-preview');
        if (cameraPreview) {
            cameraPreview.innerHTML = `
                <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                <div class="camera-overlay"></div>
                <div class="live-badge" style="position: absolute; top: 16px; right: 16px;">
                    <i class="fas fa-camera"></i>
                    <span>LIVE PHOTO</span>
                </div>
            `;
        }
        
        const cameraControls = modal.querySelector('.camera-controls');
        if (cameraControls) {
            cameraControls.innerHTML = `
                <button class="btn btn-outline" onclick="closeCamera()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="camera-btn" onclick="takeLivePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
                <button class="btn btn-outline" onclick="switchCamera()">
                    <i class="fas fa-sync-alt"></i> Flip
                </button>
            `;
        }
        
        modal.style.display = 'flex';
    }
}

function takeLivePhoto() {
    // Simulate taking a live photo
    closeCamera();
    
    // Generate a temporary live photo
    const colors = ['#8B5CF6', '#EC4899', '#3B82F6', '#10B981', '#F59E0B'];
    const randomColor = colors[Math.floor(Math.random() * colors.length)];
    
    state.checkInFlow.livePhoto = `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="${randomColor}"/><text x="100" y="110" font-size="24" text-anchor="middle" fill="white">Live Photo</text></svg>`;
    
    // Create temporary profile for the event
    const event = state.events.find(e => e.id === state.checkInFlow.eventId);
    if (event) {
        const tempProfile = {
            id: Date.now(),
            name: state.userProfile.name,
            age: state.userProfile.age,
            bio: `At ${event.name}`,
            interests: state.userProfile.interests.slice(0, 3),
            eventId: event.id,
            location: 'Checked in',
            online: true,
            verified: false,
            cardColor: randomColor,
            livePhoto: state.checkInFlow.livePhoto,
            distance: 'Just arrived',
            gender: state.userProfile.gender,
            isPublic: true,
            tempProfile: true,
            userId: state.currentUser?.id
        };
        
        // Add to mock profiles for this session
        MOCK_PROFILES.push(tempProfile);
        
        // Set as current event
        state.currentEvent = event;
        
        showNotification(`Welcome to ${event.name}! Your profile is live.`, 'success');
        
        // Navigate to connect page
        setTimeout(() => navigateTo('connect'), 1000);
    }
    
    state.checkInFlow.active = false;
    saveState();
}

function completePrivateCheckIn() {
    const event = state.events.find(e => e.id === state.checkInFlow.eventId);
    if (event) {
        state.currentEvent = event;
        
        showNotification(`Welcome to ${event.name}! You're browsing privately.`, 'success');
        
        // Navigate to connect page (will show no profiles since private)
        setTimeout(() => navigateTo('connect'), 1000);
    }
    
    state.checkInFlow.active = false;
    saveState();
}

function closePrivacyModal() {
    const modal = document.querySelector('.privacy-choice-modal');
    if (modal) {
        modal.remove();
    }
    state.checkInFlow.active = false;
}

// ===== ENHANCED EVENT CREATION WIZARD =====
function showEventWizard() {
    if (!state.isPro && !state.isMax) {
        showProModal();
        return;
    }
    
    const modal = document.getElementById('eventWizardModal');
    if (modal) {
        // Reset wizard
        document.querySelectorAll('.wizard-step').forEach(step => {
            step.classList.remove('active');
        });
        document.getElementById('wizardStep1').classList.add('active');
        
        document.querySelectorAll('.progress-step').forEach(step => {
            step.classList.toggle('active', parseInt(step.dataset.step) === 1);
        });
        
        // Set default location to Windhoek
        const locationInput = document.getElementById('eventLocation');
        if (locationInput) locationInput.value = 'Windhoek, Namibia';
        
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeEventWizard() {
    const modal = document.getElementById('eventWizardModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function nextWizardStep() {
    const currentStep = document.querySelector('.wizard-step.active');
    const currentStepId = parseInt(currentStep.id.replace('wizardStep', ''));
    
    // Validate current step
    if (currentStepId === 1) {
        const name = document.getElementById('eventName')?.value;
        const description = document.getElementById('eventDescription')?.value;
        if (!name || !description) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
    }
    
    if (currentStepId === 2) {
        const location = document.getElementById('eventLocation')?.value;
        const date = document.getElementById('eventDate')?.value;
        if (!location || !date) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
    }
    
    if (currentStepId < 4) {
        currentStep.classList.remove('active');
        const nextStep = document.getElementById(`wizardStep${currentStepId + 1}`);
        if (nextStep) {
            nextStep.classList.add('active');
            
            // Special handling for step 3 (geofence)
            if (currentStepId + 1 === 3) {
                nextStep.innerHTML = renderEventWizardStep3();
                updateGeofenceValue(100); // Default value
            }
        }
        
        // Update progress steps
        document.querySelectorAll('.progress-step').forEach(step => {
            const stepNum = parseInt(step.dataset.step);
            step.classList.toggle('active', stepNum <= currentStepId + 1);
        });
    }
}

function prevWizardStep() {
    const currentStep = document.querySelector('.wizard-step.active');
    const currentStepId = parseInt(currentStep.id.replace('wizardStep', ''));
    
    if (currentStepId > 1) {
        currentStep.classList.remove('active');
        const prevStep = document.getElementById(`wizardStep${currentStepId - 1}`);
        if (prevStep) {
            prevStep.classList.add('active');
        }
        
        // Update progress steps
        document.querySelectorAll('.progress-step').forEach(step => {
            const stepNum = parseInt(step.dataset.step);
            step.classList.toggle('active', stepNum <= currentStepId - 1);
        });
    }
}

function renderEventWizardStep3() {
    return `
        <h2 class="mb-4">Location & Geofencing</h2>
        <div class="form-group">
            <label class="form-label">Event Location</label>
            <div class="location-search">
                <input type="text" class="form-control" id="eventLocationSearch" 
                       placeholder="Search locations in Namibia..." 
                       oninput="handleLocationSearch(event)"
                       value="${document.getElementById('eventLocation')?.value || ''}">
                <div class="search-results" id="locationSearchResults"></div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Geofence Radius</label>
            <div class="geofence-slider">
                <div class="range-value">
                    <span>5m</span>
                    <span id="geofenceValue">100m</span>
                    <span>450m</span>
                </div>
                <input type="range" class="range-slider" id="geofenceSlider" 
                       min="5" max="450" value="100" 
                       oninput="updateGeofenceValue(this.value)">
                <p class="text-gray-400 text-sm mt-2">
                    <i class="fas fa-info-circle"></i> Attendees must be within this radius to check in
                </p>
            </div>
        </div>
        
        <div class="map-preview" id="eventLocationMap" style="height: 200px; border-radius: var(--radius-lg); overflow: hidden; margin-top: 16px;">
            <div style="width: 100%; height: 100%; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; color: var(--gray-400);">
                <i class="fas fa-map-marked-alt" style="font-size: 48px;"></i>
                <p class="ml-3">Map preview would appear here</p>
            </div>
        </div>
        
        <div class="wizard-navigation">
            <button class="btn btn-outline" onclick="prevWizardStep()">Back</button>
            <button class="btn btn-primary" onclick="nextWizardStep()">Next</button>
        </div>
    `;
}

function updateGeofenceValue(value) {
    const display = document.getElementById('geofenceValue');
    if (display) {
        display.textContent = `${value}m`;
    }
}

function handleLocationSearch(event) {
    const query = event.target.value;
    const resultsContainer = document.getElementById('locationSearchResults');
    
    if (!query || !resultsContainer) return;
    
    // Mock location suggestions for Namibia
    const namibiaLocations = [
        'Windhoek Country Club Resort, Windhoek',
        'National Theatre of Namibia, Windhoek',
        'Swakopmund Beach, Swakopmund',
        'Namibia Innovation Hub, Windhoek',
        'Daan Viljoen Game Reserve, Windhoek',
        'Walvis Bay Waterfront, Walvis Bay',
        'Katutura Community Hall, Windhoek',
        'Opuwo Country Lodge, Opuwo'
    ];
    
    const filtered = namibiaLocations.filter(location => 
        location.toLowerCase().includes(query.toLowerCase())
    );
    
    resultsContainer.innerHTML = filtered.map(location => `
        <div class="search-result-item" onclick="selectLocation('${location}')">
            <i class="fas fa-map-marker-alt"></i>
            <span>${location}</span>
        </div>
    `).join('');
    
    resultsContainer.style.display = 'block';
}

function selectLocation(location) {
    const input = document.getElementById('eventLocationSearch');
    const results = document.getElementById('locationSearchResults');
    
    if (input) input.value = location;
    if (results) results.style.display = 'none';
    
    // Update the main location input as well
    const mainLocationInput = document.getElementById('eventLocation');
    if (mainLocationInput) mainLocationInput.value = location;
    
    showNotification(`Location set: ${location}`, 'success');
}

function selectEventColor(color) {
    state.eventThemeColor = color;
    
    document.querySelectorAll('.color-option').forEach(opt => {
        opt.classList.remove('active');
    });
    
    event.target.classList.add('active');
    
    const preview = document.getElementById('eventThemePreview');
    if (preview) {
        preview.style.background = color;
    }
}

function createEventFinal() {
    const name = document.getElementById('eventName')?.value || 'New Event';
    const description = document.getElementById('eventDescription')?.value || 'Event description';
    const location = document.getElementById('eventLocation')?.value || 'Event location';
    const date = document.getElementById('eventDate')?.value;
    const time = document.getElementById('eventTime')?.value;
    const capacity = document.getElementById('eventCapacity')?.value || 100;
    const ticketType = document.getElementById('ticketType')?.value || 'free';
    const price = ticketType === 'paid' ? parseFloat(document.getElementById('ticketPrice')?.value || 0) : 0;
    const availableTickets = document.getElementById('availableTickets')?.value || 100;
    const geofenceRadius = document.getElementById('geofenceSlider')?.value || 100;
    
    // Get coordinates for Namibia location
    let coordinates = NAMIBIA_COORDINATES.windhoek; // Default to Windhoek
    
    // Try to find matching coordinates
    const locationLower = location.toLowerCase();
    if (locationLower.includes('swakopmund')) coordinates = NAMIBIA_COORDINATES.swakopmund;
    else if (locationLower.includes('walvis')) coordinates = NAMIBIA_COORDINATES.walvisBay;
    else if (locationLower.includes('rundu')) coordinates = NAMIBIA_COORDINATES.rundu;
    else if (locationLower.includes('katima')) coordinates = NAMIBIA_COORDINATES.katimaMulilo;
    
    const newEvent = {
        id: state.events.length + 1,
        name: name,
        description: description,
        location: location,
        address: location,
        date: date ? new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' }) : 'Soon',
        time: time ? `${time} - ${calculateEndTime(time, 4)}` : 'TBD',
        attendees: 0,
        maxAttendees: parseInt(capacity),
        qrCode: 'AMPS_' + Math.random().toString(36).substr(2, 9).toUpperCase(),
        radius: 100,
        organizerId: state.currentUser?.id || 1,
        coordinates: coordinates,
        price: price,
        currency: state.currency,
        ageRange: '18+',
        genderPreference: 'Everyone',
        tags: ['New Event'],
        bookmarked: false,
        rsvp: 'none',
        geoFencing: geofenceRadius > 0,
        customTheme: state.eventThemeColor || '#8B5CF6',
        coverImage: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=300&fit=crop',
        isFeatured: Math.random() > 0.7, // 30% chance of being featured
        geofenceRadius: parseInt(geofenceRadius)
    };
    
    state.events.push(newEvent);
    closeEventWizard();
    showNotification(`Event "${name}" created successfully!`, 'success');
    
    // Auto-create a ticket for the organizer
    const ticket = {
        id: Date.now(),
        eventId: newEvent.id,
        eventName: newEvent.name,
        purchaseDate: new Date().toISOString(),
        price: 0,
        currency: state.currency,
        qrCode: newEvent.qrCode + '_ORG',
        status: 'active'
    };
    
    state.tickets.push(ticket);
    
    saveState();
    
    // Refresh events page
    if (state.currentPage === 'events') {
        renderPage();
    }
}

// ===== SEARCH FUNCTIONALITY =====
function initEventSearch() {
    const searchInput = document.getElementById('eventSearchInput');
    if (searchInput) {
        searchInput.focus();
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleEventSearch(e);
            }
        });
    }
}

function initMapSearch() {
    const mapSearch = document.getElementById('mapSearchInput');
    if (mapSearch) {
        mapSearch.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleMapSearch(e);
            }
        });
    }
}

function handleEventSearch(event) {
    state.eventSearchQuery = event.target.value;
    renderPage();
    saveState();
}

function handleMapSearch(event) {
    const query = event.target.value;
    if (!query || !state.map) return;
    
    // Use Mapbox geocoding (simulated for demo)
    const geocodingUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${MAPBOX_TOKEN}&country=NA&limit=5`;
    
    // For demo, simulate with Namibia locations
    const namibiaPlaces = {
        'windhoek': NAMIBIA_COORDINATES.windhoek,
        'swakopmund': NAMIBIA_COORDINATES.swakopmund,
        'walvis bay': NAMIBIA_COORDINATES.walvisBay,
        'rundu': NAMIBIA_COORDINATES.rundu,
        'katima mulilo': NAMIBIA_COORDINATES.katimaMulilo
    };
    
    const lowerQuery = query.toLowerCase();
    if (namibiaPlaces[lowerQuery]) {
        state.map.flyTo({
            center: [namibiaPlaces[lowerQuery].lng, namibiaPlaces[lowerQuery].lat],
            zoom: 14,
            essential: true
        });
        showNotification(`Searching near ${query}`, 'info');
    } else {
        // Default to Windhoek
        state.map.flyTo({
            center: [NAMIBIA_COORDINATES.windhoek.lng, NAMIBIA_COORDINATES.windhoek.lat],
            zoom: 12,
            essential: true
        });
    }
}

function filterEventsBySearch() {
    if (!state.eventSearchQuery) return state.events;
    
    const query = state.eventSearchQuery.toLowerCase();
    return state.events.filter(event => 
        event.name.toLowerCase().includes(query) ||
        event.location.toLowerCase().includes(query) ||
        event.description.toLowerCase().includes(query) ||
        event.tags.some(tag => tag.toLowerCase().includes(query))
    );
}

function clearEventSearch() {
    state.eventSearchQuery = '';
    renderPage();
    saveState();
}

function clearMapSearch() {
    const input = document.getElementById('mapSearchInput');
    if (input) input.value = '';
}

// ===== CAROUSEL FUNCTIONALITY =====
function initCarousel() {
    const carousel = document.getElementById('featuredEventsCarousel');
    if (!carousel) return;
    
    let isDown = false;
    let startX;
    let scrollLeft;
    
    carousel.addEventListener('mousedown', (e) => {
        isDown = true;
        startX = e.pageX - carousel.offsetLeft;
        scrollLeft = carousel.scrollLeft;
    });
    
    carousel.addEventListener('mouseleave', () => {
        isDown = false;
    });
    
    carousel.addEventListener('mouseup', () => {
        isDown = false;
    });
    
    carousel.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - carousel.offsetLeft;
        const walk = (x - startX) * 2;
        carousel.scrollLeft = scrollLeft - walk;
    });
    
    // Touch support
    carousel.addEventListener('touchstart', (e) => {
        isDown = true;
        startX = e.touches[0].pageX - carousel.offsetLeft;
        scrollLeft = carousel.scrollLeft;
    });
    
    carousel.addEventListener('touchend', () => {
        isDown = false;
    });
    
    carousel.addEventListener('touchmove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.touches[0].pageX - carousel.offsetLeft;
        const walk = (x - startX) * 2;
        carousel.scrollLeft = scrollLeft - walk;
    });
}

// ===== CHAT SYSTEM =====
function openChatModal(matchId) {
    const match = state.matches.find(m => m.matchId === matchId);
    const profile = MOCK_PROFILES.find(p => p.id === matchId);
    
    if (!match || !profile) return;
    
    state.currentMatch = match;
    state.previousPage = state.currentPage;
    
    // Mark as read
    match.unread = false;
    
    const modal = document.getElementById('chatModal');
    const header = document.getElementById('chatHeader');
    const messages = document.getElementById('chatMessages');
    
    if (!modal || !header || !messages) return;
    
    header.innerHTML = `
        <button class="back-btn" onclick="closeChatModal()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="chat-avatar" style="background-image: url('${profile.livePhoto}');"></div>
        <div class="flex-1">
            <h4>${profile.name}</h4>
            <p class="text-gray-400 text-sm">${profile.online ? 'Online' : 'Offline'}</p>
        </div>
        <button class="btn btn-outline btn-small" onclick="reportUser(${matchId})">
            <i class="fas fa-flag"></i>
        </button>
    `;
    
    // Load messages
    const chatId = `${state.currentUser.id}_${matchId}`;
    if (!state.chatMessages[chatId]) {
        state.chatMessages[chatId] = [
            {
                id: 1,
                sender: 'match',
                text: 'Hey! Loved your profile. Are you enjoying the event?',
                time: '7:45 PM',
                read: true
            },
            {
                id: 2,
                sender: 'user',
                text: 'Yes, it\'s amazing! The speakers are incredible.',
                time: '7:46 PM',
                read: true
            }
        ];
    }
    
    messages.innerHTML = state.chatMessages[chatId].map(msg => `
        <div class="message ${msg.sender === 'user' ? 'sent' : 'received'}">
            <div class="message-text">${msg.text}</div>
            <div class="message-time">${msg.time}</div>
        </div>
    `).join('');
    
    messages.scrollTop = messages.scrollHeight;
    modal.style.display = 'flex';
    
    saveState();
}

function closeChatModal() {
    const modal = document.getElementById('chatModal');
    if (modal) {
        modal.style.display = 'none';
    }
    state.currentMatch = null;
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function sendMessage() {
    const input = document.getElementById('messageInput');
    if (!input || !input.value.trim() || !state.currentMatch) return;
    
    const chatId = `${state.currentUser.id}_${state.currentMatch.matchId}`;
    if (!state.chatMessages[chatId]) {
        state.chatMessages[chatId] = [];
    }
    
    const newMessage = {
        id: state.chatMessages[chatId].length + 1,
        sender: 'user',
        text: input.value,
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
        read: true
    };
    
    state.chatMessages[chatId].push(newMessage);
    
    // Update match last message
    const match = state.matches.find(m => m.id === state.currentMatch.id);
    if (match) {
        match.lastMessage = input.value;
        match.lastMessageTime = 'Just now';
        match.unread = false;
    }
    
    input.value = '';
    
    // Simulate reply
    setTimeout(() => {
        const replyMessage = {
            id: state.chatMessages[chatId].length + 1,
            sender: 'match',
            text: getRandomReply(),
            time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
            read: true
        };
        
        state.chatMessages[chatId].push(replyMessage);
        
        // Update UI if chat is open
        const messages = document.getElementById('chatMessages');
        if (messages) {
            messages.innerHTML = state.chatMessages[chatId].map(msg => `
                <div class="message ${msg.sender === 'user' ? 'sent' : 'received'}">
                    <div class="message-text">${msg.text}</div>
                    <div class="message-time">${msg.time}</div>
                </div>
            `).join('');
            
            messages.scrollTop = messages.scrollHeight;
        }
        
        saveState();
    }, 1000);
    
    saveState();
    
    // Update messages page
    if (state.currentPage === 'matches') {
        renderPage();
    }
}

function getRandomReply() {
    const replies = [
        'That sounds amazing!',
        'Tell me more about that!',
        'I completely agree!',
        'Would love to continue this conversation in person!',
        'What are you up to now?'
    ];
    return replies[Math.floor(Math.random() * replies.length)];
}

// ===== PROFILE MANAGEMENT =====
function saveProfile(event) {
    event.preventDefault();
    
    const form = event.target;
    const name = form.querySelector('input[type="text"]').value;
    const age = form.querySelector('input[type="number"]').value;
    const occupation = form.querySelectorAll('input[type="text"]')[1]?.value;
    const company = form.querySelectorAll('input[type="text"]')[2]?.value;
    const bio = form.querySelector('#bioTextarea').value;
    
    state.userProfile.name = name;
    state.userProfile.age = parseInt(age);
    state.userProfile.occupation = occupation;
    state.userProfile.company = company;
    state.userProfile.bio = bio;
    
    showNotification('Profile updated successfully!', 'success');
    setTimeout(() => navigateTo('profile'), 1000);
    saveState();
}

function addInterest() {
    const input = document.getElementById('newInterest');
    if (!input) return;
    
    const interest = input.value.trim();
    
    if (interest && !state.userProfile.interests.includes(interest)) {
        state.userProfile.interests.push(interest);
        renderEditProfilePage(document.getElementById('content'));
        input.value = '';
        saveState();
    }
}

function removeInterest(interest) {
    state.userProfile.interests = state.userProfile.interests.filter(i => i !== interest);
    renderEditProfilePage(document.getElementById('content'));
    saveState();
}

function uploadProfilePhoto() {
    // In a real app, this would use the camera or file picker
    showNotification('Profile photo upload coming soon!', 'info');
}

function changeProfilePhoto() {
    uploadProfilePhoto();
}

function updatePrivacySetting(setting, value) {
    state.userProfile[setting] = value;
    showNotification('Privacy settings updated', 'success');
    saveState();
}

// ===== TICKET SYSTEM =====
function showTicketModal() {
    const modal = document.getElementById('ticketModal');
    if (!modal) return;
    
    // Load active tickets
    const activeTicketsList = document.getElementById('activeTicketsList');
    if (activeTicketsList) {
        const activeTickets = state.tickets.filter(t => t.status === 'active');
        activeTicketsList.innerHTML = activeTickets.map(ticket => `
            <div class="ticket-card">
                <div class="ticket-header">
                    <div>
                        <h4>${ticket.eventName}</h4>
                        <p class="text-gray-400">Purchased: ${new Date(ticket.purchaseDate).toLocaleDateString()}</p>
                    </div>
                    <div class="ticket-qr">
                        ${ticket.qrCode}
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-gradient font-bold">${formatCurrency(ticket.price, ticket.currency)}</p>
                    <button class="btn btn-outline btn-small mt-2" onclick="shareTicket('${ticket.qrCode}')">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    modal.style.display = 'flex';
    state.previousPage = state.currentPage;
}

function closeTicketModal() {
    const modal = document.getElementById('ticketModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function switchTicketTab(tab) {
    // Update tab buttons
    ['Active', 'Purchase', 'History'].forEach(tabName => {
        const btn = document.getElementById(`ticket${tabName}Tab`);
        if (btn) {
            btn.classList.toggle('active', tabName.toLowerCase() === tab);
        }
    });
    
    // Update tab content
    ['activeTickets', 'purchaseTickets', 'ticketHistory'].forEach(tabId => {
        const pane = document.getElementById(`${tabId}Tab`);
        if (pane) {
            pane.classList.toggle('active', tabId.includes(tab));
        }
    });
    
    // Load content for the tab
    if (tab === 'purchase') {
        loadAvailableTickets();
    } else if (tab === 'history') {
        loadTicketHistory();
    }
}

function loadAvailableTickets() {
    const list = document.getElementById('availableTicketsList');
    if (!list) return;
    
    list.innerHTML = state.events.map(event => `
        <div class="ticket-card">
            <h4 class="mb-2">${event.name}</h4>
            <p class="text-gray-400 mb-3">${event.date}  ${event.location}</p>
            <div class="flex justify-between items-center">
                <div>
                    <p class="text-gradient font-bold">${formatCurrency(event.price, event.currency)}</p>
                    <p class="text-sm text-gray-400">${event.attendees} attending</p>
                </div>
                <button class="btn btn-primary" onclick="showTicketPurchaseModal(${event.id})">
                    Get Ticket
                </button>
            </div>
        </div>
    `).join('');
}

function loadTicketHistory() {
    const list = document.getElementById('ticketHistoryList');
    if (!list) return;
    
    const allTickets = [...state.tickets];
    list.innerHTML = allTickets.map(ticket => `
        <div class="ticket-card">
            <div class="flex justify-between items-start">
                <div>
                    <h4>${ticket.eventName}</h4>
                    <p class="text-gray-400">${new Date(ticket.purchaseDate).toLocaleDateString()}</p>
                </div>
                <span class="status-badge ${ticket.status}">${ticket.status}</span>
            </div>
            <div class="mt-3">
                <p class="text-gradient font-bold">${formatCurrency(ticket.price, ticket.currency)}</p>
            </div>
        </div>
    `).join('');
}

function showTicketPurchaseModal(eventId) {
    const event = state.events.find(e => e.id === eventId);
    if (!event) return;
    
    state.currentEvent = event;
    state.previousPage = 'ticketModal';
    
    const modal = document.getElementById('ticketPurchaseModal');
    const details = document.getElementById('ticketPurchaseDetails');
    
    if (!modal || !details) return;
    
    details.innerHTML = `
        <h3 class="mb-2">${event.name}</h3>
        <p class="text-gray-400 mb-4">${event.date}  ${event.location}</p>
        <div class="price-display">
            <span>Price:</span>
            <span class="text-gradient font-bold text-xl">${formatCurrency(event.price, event.currency)}</span>
        </div>
    `;
    
    modal.style.display = 'flex';
}

function closeTicketPurchaseModal() {
    const modal = document.getElementById('ticketPurchaseModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage === 'ticketModal') {
        showTicketModal();
        state.previousPage = null;
    }
}

function updateTicketQuantity(change) {
    const input = document.getElementById('ticketQuantity');
    if (!input) return;
    
    let quantity = parseInt(input.value) + change;
    quantity = Math.max(1, Math.min(10, quantity));
    input.value = quantity;
    
    updateTicketTotal();
}

function updateTicketTotal() {
    const quantity = parseInt(document.getElementById('ticketQuantity')?.value || 1);
    const event = state.currentEvent;
    
    if (!event) return;
    
    const total = event.price * quantity;
    const totalElement = document.getElementById('ticketTotalPrice');
    
    if (totalElement) {
        totalElement.textContent = formatCurrency(total, event.currency);
    }
}

function processTicketPayment() {
    const quantity = parseInt(document.getElementById('ticketQuantity')?.value || 1);
    const event = state.currentEvent;
    
    if (!event) return;
    
    const ticket = {
        id: Date.now(),
        eventId: event.id,
        eventName: event.name,
        purchaseDate: new Date().toISOString(),
        price: event.price * quantity,
        currency: event.currency,
        qrCode: `AMPS_${event.id}_${Date.now()}`,
        status: 'active'
    };
    
    state.tickets.push(ticket);
    
    // Update event attendance
    event.attendees += quantity;
    
    showNotification(`Ticket purchased successfully!`, 'success');
    closeTicketPurchaseModal();
    
    // Update ticket box
    showTicketModal();
    switchTicketTab('active');
    
    saveState();
}

function shareTicket(qrCode) {
    // In a real app, this would use the Web Share API
    showNotification('Ticket QR code copied to clipboard!', 'success');
    navigator.clipboard.writeText(qrCode);
}

// ===== SETTINGS =====
function showSettingsModal() {
    const modal = document.getElementById('settingsModal');
    if (modal) {
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeSettingsModal() {
    const modal = document.getElementById('settingsModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function showCurrencySelector() {
    const modal = document.getElementById('currencyModal');
    const list = document.getElementById('currencyList');
    
    if (!modal || !list) return;
    
    list.innerHTML = CURRENCIES.map(currency => `
        <div class="currency-option ${state.currency === currency.code ? 'selected' : ''}" 
             onclick="selectCurrency('${currency.code}')">
            <div class="currency-info">
                <span class="currency-symbol">${currency.symbol}</span>
                <div>
                    <span class="currency-name">${currency.name}</span>
                    <span class="currency-code">${currency.code}</span>
                </div>
            </div>
            ${state.currency === currency.code ? '<i class="fas fa-check"></i>' : ''}
        </div>
    `).join('');
    
    modal.style.display = 'flex';
    state.previousPage = 'settingsModal';
}

function closeCurrencyModal() {
    const modal = document.getElementById('currencyModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage === 'settingsModal') {
        showSettingsModal();
        state.previousPage = null;
    }
}

function selectCurrency(code) {
    state.currency = code;
    showNotification(`Currency changed to ${code}`, 'success');
    closeCurrencyModal();
    saveState();
}

// ===== SAFETY FEATURES =====
function setupEmergencyContact() {
    const modal = document.getElementById('emergencyModal');
    if (modal) {
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeEmergencyModal() {
    const modal = document.getElementById('emergencyModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function saveEmergencyContact() {
    const name = document.getElementById('emergencyName')?.value;
    const phone = document.getElementById('emergencyPhone')?.value;
    const relationship = document.getElementById('emergencyRelationship')?.value;
    
    if (!name || !phone) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    state.userProfile.emergencyContact = { name, phone, relationship };
    showNotification('Emergency contact saved', 'success');
    closeEmergencyModal();
    saveState();
}

function reportUser(userId) {
    state.reportingUserId = userId;
    const modal = document.getElementById('reportModal');
    if (modal) {
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeReportModal() {
    const modal = document.getElementById('reportModal');
    if (modal) {
        modal.style.display = 'none';
    }
    state.reportingUserId = null;
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function submitReport() {
    const reason = document.getElementById('reportReason')?.value;
    const details = document.getElementById('reportDetails')?.value;
    
    if (!reason) {
        showNotification('Please select a reason for reporting', 'error');
        return;
    }
    
    const report = {
        id: Date.now(),
        userId: state.reportingUserId,
        reason: reason,
        details: details,
        timestamp: new Date().toISOString(),
        status: 'pending'
    };
    
    if (!state.userProfile.reports) {
        state.userProfile.reports = [];
    }
    
    state.userProfile.reports.push(report);
    
    showNotification('Report submitted. Our team will review it shortly.', 'success');
    closeReportModal();
    saveState();
}

function showBlockedUsers() {
    const blockedUsers = state.userProfile.blockedUsers || [];
    
    if (blockedUsers.length === 0) {
        showNotification('No blocked users', 'info');
    } else {
        alert(`Blocked users:\n${blockedUsers.map(id => `User ${id}`).join('\n')}`);
    }
}

function showReportHistory() {
    const reports = state.userProfile.reports || [];
    
    if (reports.length === 0) {
        showNotification('No reports submitted', 'info');
    } else {
        alert(`Report history:\n${reports.map(r => `Report #${r.id}: ${r.reason} (${r.status})`).join('\n')}`);
    }
}

// ===== ANALYTICS =====
function showAnalyticsModal() {
    if (!state.isPro && !state.isMax) {
        showProModal();
        return;
    }
    
    const modal = document.getElementById('analyticsModal');
    if (modal) {
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeAnalyticsModal() {
    const modal = document.getElementById('analyticsModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

// ===== UPGRADE SYSTEM =====
function showProModal() {
    const modal = document.getElementById('proModal');
    if (modal) {
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeProModal() {
    const modal = document.getElementById('proModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function upgradeToPro() {
    state.isPro = true;
    state.isMax = false;
    state.dailyLikes = Infinity;
    state.superLikes = 5;
    state.rewindCount = Infinity;
    
    showNotification('Pro upgrade successful! Welcome to Amps Pro ', 'success');
    closeProModal();
    
    // Refresh page to update UI
    renderPage();
    saveState();
}

function upgradeToMax() {
    state.isPro = true;
    state.isMax = true;
    state.dailyLikes = Infinity;
    state.superLikes = 10;
    state.rewindCount = Infinity;
    
    showNotification('Max upgrade successful! Welcome to Amps Max ', 'success');
    closeProModal();
    
    // Refresh page to update UI
    renderPage();
    saveState();
}

// ===== NOTIFICATIONS =====
function showNotifications() {
    const dropdown = document.getElementById('notificationsDropdown');
    const list = document.getElementById('notificationsList');
    
    if (dropdown && list) {
        list.innerHTML = state.notifications.map(notification => `
            <div class="notification-item">
                <div class="notification-avatar" style="background-image: url('${notification.avatar || ''}');"></div>
                <div class="notification-content">
                    <div class="font-semibold">${notification.message}</div>
                    <div class="notification-time">${notification.time}</div>
                </div>
                ${!notification.read ? '<div class="w-2 h-2 bg-primary rounded-full"></div>' : ''}
            </div>
        `).join('');
        
        dropdown.style.display = 'flex';
    }
}

function closeNotifications() {
    const dropdown = document.getElementById('notificationsDropdown');
    if (dropdown) {
        dropdown.style.display = 'none';
    }
}

function markAllAsRead() {
    state.notifications.forEach(n => n.read = true);
    closeNotifications();
    saveState();
}

// ===== CAMERA FUNCTIONS =====
function takePhoto() {
    // Simulate photo capture
    showNotification('Photo captured!', 'success');
    closeCamera();
}

function switchCamera() {
    state.facingMode = state.facingMode === 'user' ? 'environment' : 'user';
    showNotification(`Switched to ${state.facingMode === 'user' ? 'front' : 'rear'} camera`, 'info');
}

function closeCamera() {
    const modal = document.getElementById('cameraModal');
    if (modal) modal.style.display = 'none';
    
    // Stop camera stream if exists
    if (state.cameraStream) {
        state.cameraStream.getTracks().forEach(track => track.stop());
        state.cameraStream = null;
    }
    
    // If we were in check-in flow, cancel it
    if (state.checkInFlow.active) {
        state.checkInFlow.active = false;
        showNotification('Check-in cancelled', 'info');
    }
}

// ===== MODAL ENHANCEMENTS =====
function closeAllModals() {
    const modals = document.querySelectorAll('.pro-modal, .match-modal, .filters-modal, .ticket-modal, .event-wizard-modal, .chat-modal, .settings-modal, .currency-modal, .ticket-purchase-modal, .emergency-modal, .report-modal, .analytics-modal, .camera-modal');
    modals.forEach(modal => {
        modal.style.display = 'none';
    });
    
    // Also close any dynamically created modals
    const dynamicModals = document.querySelectorAll('.privacy-choice-modal, .event-detail-modal');
    dynamicModals.forEach(modal => {
        modal.remove();
    });
    
    state.previousPage = null;
}

// ===== UTILITY FUNCTIONS =====
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    
    const icon = type === 'success' ? 'fa-check-circle' : 
                type === 'error' ? 'fa-exclamation-circle' : 
                type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
    
    notification.innerHTML = `
        <i class="fas ${icon}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.opacity = '0';
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }
    }, 3000);
}

function formatCurrency(amount, currency) {
    const currencyObj = CURRENCIES.find(c => c.code === currency) || CURRENCIES[0];
    const convertedAmount = amount * currencyObj.conversionRate;
    
    switch(currency) {
        case 'NAD':
            return `N$${convertedAmount.toFixed(2)}`;
        case 'USD':
            return `$${convertedAmount.toFixed(2)}`;
        case 'EUR':
            return `${convertedAmount.toFixed(2)}`;
        case 'GBP':
            return `${convertedAmount.toFixed(2)}`;
        case 'ZAR':
            return `R${convertedAmount.toFixed(2)}`;
        default:
            return `N$${convertedAmount.toFixed(2)}`;
    }
}

function calculateEndTime(startTime, duration) {
    const [hours, minutes] = startTime.split(':').map(Number);
    const endHours = hours + parseInt(duration);
    return `${endHours % 24}:${minutes.toString().padStart(2, '0')}`;
}

function addScrollbarStyles() {
    const style = document.createElement('style');
    style.textContent = `
        /* Enhanced scrollbar styling */
        .events-list {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }
        
        .events-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .events-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .events-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .events-list:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }
        
        .chat-messages, .notifications-list {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-light) transparent;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 9999;
            max-width: 300px;
            box-shadow: var(--shadow-lg);
            animation: slideInFromRight 0.3s ease;
            transition: opacity 0.3s ease;
        }
        
        .notification i {
            font-size: 20px;
        }
        
        .notification-success i {
            color: var(--accent-green);
        }
        
        .notification-error i {
            color: var(--accent-red);
        }
        
        .notification-warning i {
            color: var(--accent-yellow);
        }
        
        .notification-info i {
            color: var(--accent-blue);
        }
    `;
    document.head.appendChild(style);
}

// ===== EVENT HANDLERS =====
function updateDistanceValue(value) {
    const display = document.getElementById('distanceValue');
    if (display) {
        display.textContent = `${value} km`;
    }
}

function updateAgeRange() {
    const min = document.getElementById('ageMin')?.value || 18;
    const max = document.getElementById('ageMax')?.value || 35;
    const display = document.getElementById('ageValue');
    if (display) {
        display.textContent = `${min}-${max}`;
    }
}

function toggleFilter(type, value) {
    if (type === 'gender') {
        state.filters.gender = value;
        // Update UI
        ['All', 'Male', 'Female'].forEach(gender => {
            const btn = document.getElementById(`gender${gender}`);
            if (btn) {
                btn.classList.toggle('active', value === gender.toLowerCase());
            }
        });
    }
}

function toggleInterest(interest) {
    const element = event.target;
    const index = state.filters.interests.indexOf(interest);
    
    if (index > -1) {
        state.filters.interests.splice(index, 1);
        element.classList.remove('selected');
    } else {
        state.filters.interests.push(interest);
        element.classList.add('selected');
    }
}

function applyFilters() {
    showNotification('Filters applied', 'success');
    closeFilters();
    saveState();
}

function closeFilters() {
    const modal = document.getElementById('filtersModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function showMatchModal() {
    const modal = document.getElementById('matchModal');
    const matchAvatar = document.getElementById('matchAvatar');
    const userAvatar = document.getElementById('userAvatar');
    const matchMessage = document.getElementById('matchMessage');
    
    if (modal && state.lastMatch) {
        if (matchAvatar) matchAvatar.style.backgroundImage = `url('${state.lastMatch.livePhoto}')`;
        if (userAvatar) userAvatar.style.backgroundImage = `url('${state.userProfile.profilePhoto}')`;
        if (matchMessage) matchMessage.textContent = `You and ${state.lastMatch.name} liked each other`;
        modal.style.display = 'flex';
        state.previousPage = state.currentPage;
    }
}

function closeMatchModal() {
    const modal = document.getElementById('matchModal');
    if (modal) {
        modal.style.display = 'none';
    }
    if (state.previousPage) {
        navigateTo(state.previousPage);
        state.previousPage = null;
    }
}

function startChat() {
    closeMatchModal();
    if (state.lastMatch) {
        const matchId = state.lastMatch.id;
        openChatModal(matchId);
    }
}

// ===== INITIALIZE APP =====
document.addEventListener('DOMContentLoaded', init);

// Add CSS for notification badge and other UI elements
const style = document.createElement('style');
style.textContent = `
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--accent-red);
        color: white;
        font-size: 10px;
        min-width: 16px;
        height: 16px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 4px;
    }
    
    .event-detail-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .event-detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .close-btn {
        background: none;
        border: none;
        color: var(--white);
        font-size: 20px;
        cursor: pointer;
    }
    
    .event-detail-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: var(--radius-lg);
        margin-bottom: 20px;
    }
    
    .event-detail-info {
        margin-bottom: 20px;
    }
    
    .event-detail-info p {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .event-detail-description {
        margin-bottom: 20px;
    }
    
    .event-detail-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 20px;
    }
    
    .tag {
        background: var(--bg-tertiary);
        padding: 4px 12px;
        border-radius: var(--radius-full);
        font-size: 12px;
    }
    
    .currency-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: background var(--transition);
    }
    
    .currency-option:hover {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .currency-option.selected {
        background: rgba(139, 92, 246, 0.1);
    }
    
    .currency-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .currency-symbol {
        font-size: 24px;
        font-weight: bold;
    }
    
    .currency-name {
        display: block;
        font-weight: 500;
    }
    
    .currency-code {
        display: block;
        font-size: 12px;
        color: var(--gray-400);
    }
    
    .price-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        margin-bottom: 20px;
    }
    
    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .quantity-btn {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-full);
        background: var(--bg-tertiary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--white);
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .total-price {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        font-size: 18px;
        font-weight: bold;
    }
    
    .status-badge {
        padding: 4px 12px;
        border-radius: var(--radius-full);
        font-size: 12px;
        font-weight: 600;
    }
    
    .status-badge.active {
        background: var(--accent-green);
        color: white;
    }
    
    .status-badge.used {
        background: var(--gray-600);
        color: white;
    }
    
    .status-badge.cancelled {
        background: var(--accent-red);
        color: white;
    }
    
    @keyframes slideInFromRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);
    </script>
   </body>
</html>
